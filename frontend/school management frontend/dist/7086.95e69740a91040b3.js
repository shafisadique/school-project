"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[7086],{3891:(M,f,l)=>{l.d(f,{e:()=>b});var m=l(1626),r=l(2525),p=l(4438);let b=(()=>{class h{constructor(t){this.http=t,this.apiUrl=r.c.apiUrl}getClassesBySchool(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${t}`)}getStudentsByClass(t,d){const g=`${this.apiUrl}/api/students/get-student-by-class/${t}`,u=(new m.Nl).set("academicYearId",d);return this.http.get(g,{params:u})}assignRollNumbers(t){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${t}`,{})}assignRollNumbersAlphabetically(t){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${t}`,{})}assignRollNumberToStudent(t,d){return this.http.put(`${this.apiUrl}/api/students/${t}/assign-roll-number`,{rollNo:d})}createClass(t){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,t)}deleteAssignment(t){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:t})}createSubject(t){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,t)}getSubjects(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${t}`)}getTeachers(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${t}`)}getCombinedAssignments(t,d){const g=(new m.Nl).set("academicYearId",d);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${t}`,{params:g})}assignSubjectToClass(t,d,g,u){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:t,subjectId:d,teacherId:g,academicYearId:u})}updateAssignment(t){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,t)}getAssignmentsByTeacher(t,d,g){let u=(new m.Nl).set("academicYearId",d);return g&&(u=u.set("date",g)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${t}`,{params:u})}updateAttendanceTeachers(t,d,g){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:t,attendanceTeacher:d,substituteAttendanceTeachers:g})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(d){return new(d||h)(p.KVO(m.Qq))}}static{this.\u0275prov=p.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},7086:(M,f,l)=>{l.r(f),l.d(f,{AttendanceComponent:()=>L});var m=l(467),r=l(9417),p=l(177),b=l(8652),h=l(1413),C=l(6977),t=l(4438),d=l(2866),g=l(3891),u=l(5794),O=l(749);const v=()=>({standalone:!0});function x(o,i){1&o&&(t.j41(0,"div",9)(1,"div",10)(2,"span",11),t.EFF(3,"Loading..."),t.k0s()()())}function I(o,i){if(1&o&&(t.j41(0,"option",32),t.EFF(1),t.k0s()),2&o){const n=i.$implicit,a=t.XpG(2);t.Y8G("value",n._id),t.R7$(),t.Lme(" ",n.name," (",a.getSubjectNames(n.taughtSubjects),") ")}}function F(o,i){if(1&o&&(t.j41(0,"option",32),t.EFF(1),t.k0s()),2&o){const n=i.$implicit;t.Y8G("value",n._id),t.R7$(),t.JRh(n.name)}}function k(o,i){1&o&&(t.j41(0,"div",33),t.EFF(1," Only today's date is allowed "),t.k0s())}function j(o,i){1&o&&(t.j41(0,"div",34),t.nrm(1,"i",35),t.EFF(2," You are not authorized to mark attendance for this class. "),t.k0s())}function y(o,i){if(1&o){const n=t.RV6();t.j41(0,"tr",50)(1,"td",51),t.EFF(2),t.k0s(),t.j41(3,"td",52)(4,"div",53)(5,"div",54)(6,"img",55),t.bIt("error",function(e){const s=t.eBV(n).$implicit,c=t.XpG(4);return t.Njj(c.handleImageError(e,s))}),t.k0s(),t.j41(7,"span",56),t.EFF(8),t.k0s()(),t.j41(9,"div",57),t.EFF(10),t.k0s()()(),t.j41(11,"td",58),t.EFF(12),t.k0s(),t.j41(13,"td",59)(14,"select",60),t.bIt("change",function(e){const s=t.eBV(n).$implicit,c=t.XpG(4);return t.Njj(c.updateAttendanceStatus(s._id,e))}),t.j41(15,"option",61),t.EFF(16,"Present"),t.k0s(),t.j41(17,"option",62),t.EFF(18,"Absent"),t.k0s(),t.j41(19,"option",63),t.EFF(20,"Late"),t.k0s()()()()}if(2&o){const n=i.$implicit,a=i.index,e=t.XpG(4);t.R7$(2),t.JRh(a+1),t.R7$(4),t.FS9("alt",n.name),t.Y8G("src",n.avatarUrl,t.B4B),t.R7$(2),t.SpI(" ",n.initials," "),t.R7$(2),t.JRh(n.name),t.R7$(2),t.JRh(n.rollNo||"\u2014"),t.R7$(2),t.Y8G("value",e.getAttendanceStatus(n._id))("disabled",!e.canMarkAttendance)}}function E(o,i){if(1&o&&(t.j41(0,"div",46)(1,"table",47)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"#"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Student Name"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Roll No"),t.k0s(),t.j41(10,"th",48),t.EFF(11,"Status"),t.k0s()()(),t.j41(12,"tbody"),t.DNE(13,y,21,8,"tr",49),t.k0s()()()),2&o){const n=t.XpG(3);t.R7$(13),t.Y8G("ngForOf",n.studentsWithAvatar)}}function A(o,i){if(1&o){const n=t.RV6();t.j41(0,"div",66)(1,"div",67)(2,"div",68)(3,"div",69)(4,"div",70)(5,"img",55),t.bIt("error",function(e){const s=t.eBV(n).$implicit,c=t.XpG(4);return t.Njj(c.handleImageError(e,s))}),t.k0s(),t.j41(6,"span",56),t.EFF(7),t.k0s()()(),t.j41(8,"div",71)(9,"div",57),t.EFF(10),t.k0s(),t.j41(11,"div",72),t.EFF(12),t.k0s()()(),t.j41(13,"div",73)(14,"label",74),t.EFF(15,"Status:"),t.k0s(),t.j41(16,"select",75),t.bIt("change",function(e){const s=t.eBV(n).$implicit,c=t.XpG(4);return t.Njj(c.updateAttendanceStatus(s._id,e))}),t.j41(17,"option",61),t.EFF(18,"Present"),t.k0s(),t.j41(19,"option",62),t.EFF(20,"Absent"),t.k0s(),t.j41(21,"option",63),t.EFF(22,"Late"),t.k0s()()()()()}if(2&o){const n=i.$implicit,a=t.XpG(4);t.R7$(5),t.FS9("alt",n.name),t.Y8G("src",n.avatarUrl,t.B4B),t.R7$(2),t.SpI(" ",n.initials," "),t.R7$(3),t.JRh(n.name),t.R7$(2),t.SpI("Roll No: ",n.rollNo||"\u2014",""),t.R7$(4),t.Y8G("value",a.getAttendanceStatus(n._id))("disabled",!a.canMarkAttendance)}}function S(o,i){if(1&o&&(t.j41(0,"div",64),t.DNE(1,A,23,7,"div",65),t.k0s()),2&o){const n=t.XpG(3);t.R7$(),t.Y8G("ngForOf",n.studentsWithAvatar)}}function R(o,i){if(1&o&&(t.j41(0,"div",36)(1,"div",37)(2,"h5",38),t.nrm(3,"i",39),t.EFF(4),t.k0s(),t.j41(5,"div",40)(6,"span",41),t.EFF(7,"Present"),t.k0s(),t.j41(8,"span",42),t.EFF(9,"Absent"),t.k0s(),t.j41(10,"span",43),t.EFF(11,"Late"),t.k0s()()(),t.DNE(12,E,14,1,"div",44)(13,S,2,1,"div",45),t.k0s()),2&o){const n=t.XpG(2);t.R7$(4),t.SpI(" Students (",n.students.length,") "),t.R7$(8),t.Y8G("ngIf",n.windowWidth>768),t.R7$(),t.Y8G("ngIf",n.windowWidth<=768)}}function w(o,i){1&o&&t.nrm(0,"span",76)}function $(o,i){1&o&&t.nrm(0,"i",77)}function G(o,i){if(1&o){const n=t.RV6();t.j41(0,"div",12)(1,"form",13),t.bIt("ngSubmit",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.onSubmit())}),t.j41(2,"div",14)(3,"div",15)(4,"label",16),t.EFF(5,"Class "),t.j41(6,"span",17),t.EFF(7,"*"),t.k0s()(),t.j41(8,"select",18),t.bIt("change",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.onClassChange())}),t.j41(9,"option",19),t.EFF(10,"Select Class"),t.k0s(),t.DNE(11,I,2,3,"option",20),t.k0s()(),t.j41(12,"div",15)(13,"label",16),t.EFF(14,"Subject "),t.j41(15,"span",17),t.EFF(16,"*"),t.k0s()(),t.j41(17,"select",21)(18,"option",19),t.EFF(19,"Select Subject"),t.k0s(),t.DNE(20,F,2,2,"option",20),t.k0s()(),t.j41(21,"div",15)(22,"label",16),t.EFF(23,"Date "),t.j41(24,"span",17),t.EFF(25,"*"),t.k0s()(),t.nrm(26,"input",22),t.DNE(27,k,2,0,"div",23),t.k0s()(),t.DNE(28,j,3,0,"div",24)(29,R,14,3,"div",25),t.j41(30,"div",26)(31,"button",27),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.goToMonthlyAttendance())}),t.nrm(32,"i",28),t.EFF(33,"View Monthly "),t.k0s(),t.j41(34,"button",29),t.DNE(35,w,1,0,"span",30)(36,$,1,0,"i",31),t.EFF(37),t.k0s()()()()}if(2&o){let n,a;const e=t.XpG();t.R7$(),t.Y8G("formGroup",e.attendanceForm),t.R7$(10),t.Y8G("ngForOf",e.getClasses()),t.R7$(9),t.Y8G("ngForOf",e.getSubjects()),t.R7$(7),t.Y8G("ngIf",(null==(n=e.attendanceForm.get("date"))?null:n.touched)&&(null==(n=e.attendanceForm.get("date"))||null==n.errors?null:n.errors.notToday)),t.R7$(),t.Y8G("ngIf",(null==(a=e.attendanceForm.get("classId"))?null:a.value)&&!e.canMarkAttendance),t.R7$(),t.Y8G("ngIf",e.students.length>0),t.R7$(2),t.Y8G("disabled",!e.selectedClassId||!e.attendanceForm.value.subjectId),t.R7$(3),t.Y8G("disabled",e.attendanceForm.invalid||e.loading||!e.canMarkAttendance||0===e.students.length),t.R7$(),t.Y8G("ngIf",e.loading),t.R7$(),t.Y8G("ngIf",!e.loading),t.R7$(),t.SpI(" ",e.loading?"Marking Attendance...":"Mark Attendance"," ")}}function T(o,i){if(1&o){const n=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td")(9,"span",86),t.EFF(10),t.k0s()(),t.j41(11,"td")(12,"span",87),t.EFF(13),t.k0s()(),t.j41(14,"td")(15,"span",88),t.EFF(16),t.k0s()(),t.j41(17,"td")(18,"button",89),t.bIt("click",function(){const e=t.eBV(n).$implicit,s=t.XpG(3),c=t.sdS(11);return t.Njj(s.openEditModal(c,e))}),t.nrm(19,"i",90),t.k0s()()()}if(2&o){const n=i.$implicit,a=t.XpG(3);t.R7$(2),t.JRh(t.i5U(3,7,n.date,"dd MMM yyyy")),t.R7$(3),t.JRh(null==n.classId?null:n.classId.name),t.R7$(2),t.JRh(null==n.subjectId?null:n.subjectId.name),t.R7$(3),t.JRh(a.countStatus(n,"Present")),t.R7$(3),t.JRh(a.countStatus(n,"Absent")),t.R7$(3),t.JRh(a.countStatus(n,"Late")),t.R7$(2),t.Y8G("disabled",!a.isToday(n.date)||!a.canMarkAttendance)}}function D(o,i){if(1&o&&(t.j41(0,"div",83)(1,"table",84)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"Date"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Class"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Subject"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Present"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Absent"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Late"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Actions"),t.k0s()()(),t.j41(18,"tbody"),t.DNE(19,T,20,10,"tr",85),t.nI1(20,"slice"),t.k0s()()()),2&o){const n=t.XpG(2);t.R7$(19),t.Y8G("ngForOf",t.brH(20,1,n.attendanceHistory,0,10))}}function N(o,i){if(1&o){const n=t.RV6();t.j41(0,"div",93)(1,"div",94)(2,"div",95)(3,"div",96),t.EFF(4),t.nI1(5,"date"),t.k0s(),t.j41(6,"div",97),t.EFF(7),t.k0s()(),t.j41(8,"div",98),t.EFF(9),t.k0s()(),t.j41(10,"div",99)(11,"div",100)(12,"div",101)(13,"span",102),t.EFF(14,"Present"),t.k0s(),t.j41(15,"span",103),t.EFF(16),t.k0s()(),t.j41(17,"div",101)(18,"span",102),t.EFF(19,"Absent"),t.k0s(),t.j41(20,"span",104),t.EFF(21),t.k0s()(),t.j41(22,"div",101)(23,"span",102),t.EFF(24,"Late"),t.k0s(),t.j41(25,"span",105),t.EFF(26),t.k0s()()(),t.j41(27,"button",106),t.bIt("click",function(){const e=t.eBV(n).$implicit,s=t.XpG(3),c=t.sdS(11);return t.Njj(s.openEditModal(c,e))}),t.nrm(28,"i",90),t.EFF(29," Edit "),t.k0s()()()}if(2&o){const n=i.$implicit,a=t.XpG(3);t.R7$(4),t.JRh(t.i5U(5,7,n.date,"dd MMM yyyy")),t.R7$(3),t.JRh(null==n.classId?null:n.classId.name),t.R7$(2),t.JRh(null==n.subjectId?null:n.subjectId.name),t.R7$(7),t.JRh(a.countStatus(n,"Present")),t.R7$(5),t.JRh(a.countStatus(n,"Absent")),t.R7$(5),t.JRh(a.countStatus(n,"Late")),t.R7$(),t.Y8G("disabled",!a.isToday(n.date)||!a.canMarkAttendance)}}function Y(o,i){if(1&o&&(t.j41(0,"div",91),t.DNE(1,N,30,10,"div",92),t.nI1(2,"slice"),t.k0s()),2&o){const n=t.XpG(2);t.R7$(),t.Y8G("ngForOf",t.brH(2,1,n.attendanceHistory,0,10))}}function U(o,i){if(1&o&&(t.j41(0,"div",78)(1,"div",79),t.nrm(2,"i",80),t.EFF(3,"Recent Attendance Records "),t.k0s(),t.DNE(4,D,21,5,"div",81)(5,Y,3,5,"div",82),t.k0s()),2&o){const n=t.XpG();t.R7$(4),t.Y8G("ngIf",n.windowWidth>768),t.R7$(),t.Y8G("ngIf",n.windowWidth<=768)}}function B(o,i){if(1&o){const n=t.RV6();t.j41(0,"tr")(1,"td",48),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"div",53)(5,"div",123)(6,"span",56),t.EFF(7),t.k0s()(),t.j41(8,"strong"),t.EFF(9),t.k0s()()(),t.j41(10,"td",124),t.EFF(11),t.k0s(),t.j41(12,"td")(13,"select",125),t.mxI("ngModelChange",function(e){const s=t.eBV(n).index,c=t.XpG(2);return t.DH7(c.selectedAttendance.students[s].status,e)||(c.selectedAttendance.students[s].status=e),t.Njj(e)}),t.j41(14,"option",61),t.EFF(15,"Present"),t.k0s(),t.j41(16,"option",62),t.EFF(17,"Absent"),t.k0s(),t.j41(18,"option",63),t.EFF(19,"Late"),t.k0s()()()()}if(2&o){const n=i.$implicit,a=i.index,e=t.XpG(2);t.R7$(2),t.JRh(a+1),t.R7$(5),t.SpI(" ",e.getInitials(null==n.studentId?null:n.studentId.name)," "),t.R7$(2),t.JRh((null==n.studentId?null:n.studentId.name)||"Unknown"),t.R7$(2),t.JRh((null==n.studentId?null:n.studentId.rollNo)||"\u2014"),t.R7$(2),t.R50("ngModel",e.selectedAttendance.students[a].status),t.Y8G("ngModelOptions",t.lJ4(6,v))}}function W(o,i){1&o&&t.nrm(0,"span",76)}function z(o,i){if(1&o){const n=t.RV6();t.j41(0,"div",107)(1,"div",108)(2,"div",109)(3,"div",110)(4,"h5",111),t.EFF(5," Edit Attendance "),t.k0s(),t.j41(6,"button",112),t.bIt("click",function(){const e=t.eBV(n).$implicit;return t.Njj(e.dismiss())}),t.EFF(7," \xd7 "),t.k0s()(),t.j41(8,"div",113)(9,"div",114)(10,"h6")(11,"strong"),t.EFF(12,"Class:"),t.k0s(),t.EFF(13),t.k0s(),t.j41(14,"h6")(15,"strong"),t.EFF(16,"Subject:"),t.k0s(),t.EFF(17),t.k0s(),t.j41(18,"h6")(19,"strong"),t.EFF(20,"Date:"),t.k0s(),t.EFF(21),t.nI1(22,"date"),t.k0s()(),t.j41(23,"div",46)(24,"table",115)(25,"thead",116)(26,"tr")(27,"th",117),t.EFF(28,"#"),t.k0s(),t.j41(29,"th"),t.EFF(30,"Name"),t.k0s(),t.j41(31,"th",118),t.EFF(32,"Roll No"),t.k0s(),t.j41(33,"th",119),t.EFF(34,"Status"),t.k0s()()(),t.j41(35,"tbody"),t.DNE(36,B,20,7,"tr",85),t.k0s()()()(),t.j41(37,"div",120)(38,"button",121),t.bIt("click",function(){const e=t.eBV(n).$implicit;return t.Njj(e.dismiss())}),t.EFF(39," Cancel "),t.k0s(),t.j41(40,"button",122),t.bIt("click",function(){const e=t.eBV(n).$implicit,s=t.XpG();return t.Njj(s.onEditSubmit(e))}),t.DNE(41,W,1,0,"span",30),t.EFF(42," Save Changes "),t.k0s()()()()()}if(2&o){const n=t.XpG();t.R7$(13),t.SpI(" ",null==n.selectedAttendance||null==n.selectedAttendance.classId?null:n.selectedAttendance.classId.name,""),t.R7$(4),t.SpI(" ",null==n.selectedAttendance||null==n.selectedAttendance.subjectId?null:n.selectedAttendance.subjectId.name,""),t.R7$(4),t.SpI(" ",t.i5U(22,6,null==n.selectedAttendance?null:n.selectedAttendance.date,"dd MMM yyyy"),""),t.R7$(15),t.Y8G("ngForOf",null==n.selectedAttendance?null:n.selectedAttendance.students),t.R7$(4),t.Y8G("disabled",n.loading),t.R7$(),t.Y8G("ngIf",n.loading)}}let L=(()=>{class o{onResize(n){this.windowWidth=n.target.innerWidth}constructor(n,a,e,s,c,_){this.fb=n,this.attendanceService=a,this.classSubjectService=e,this.toastr=s,this.router=c,this.modalService=_,this.assignments=[],this.students=[],this.attendanceHistory=[],this.classList=[],this.selectedAcademicYearId="",this.selectedSchoolId="",this.selectedClassId="",this.loading=!1,this.canMarkAttendance=!1,this.selectedAttendance=null,this.teacherClasses=[],this.studentsWithAvatar=[],this.locationError="",this.skipGps=!1,this.windowWidth=window.innerWidth,this.destroy$=new h.B}ngOnInit(){this.selectedSchoolId=localStorage.getItem("schoolId")||"",this.selectedAcademicYearId=localStorage.getItem("activeAcademicYearId")||"",this.validateSession(),this.initForms(),this.loadTeacherAttendanceClasses(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(()=>console.log("GPS permission granted"),n=>console.warn("GPS permission denied early:",n.code),{timeout:5e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}validateSession(){return this.selectedSchoolId&&this.selectedAcademicYearId?localStorage.getItem("token")?void 0:(this.toastr.error("Session expired. Please log in again.","Error"),void this.router.navigate(["/login"])):(this.toastr.error("School ID or active academic year not found. Please log in again.","Error"),void this.router.navigate(["/login"]))}initForms(){this.attendanceForm=this.fb.group({classId:["",r.k0.required],subjectId:["",r.k0.required],date:["",[r.k0.required,this.todayOnlyValidator.bind(this)]],attendanceRecords:[[],r.k0.required]}),this.editForm=this.fb.group({attendanceRecords:[[],r.k0.required]}),this.attendanceForm.get("classId")?.valueChanges.pipe((0,C.Q)(this.destroy$)).subscribe(n=>{this.selectedClassId=n,this.loadStudents(),this.loadAttendanceHistory(),this.updateCanMarkAttendance()}),this.attendanceForm.get("date")?.valueChanges.pipe((0,C.Q)(this.destroy$)).subscribe(()=>{this.loadTeacherAttendanceClasses()})}onClassChange(){}loadTeacherAttendanceClasses(){this.loading=!0,this.classSubjectService.getTeacherAttendanceClasses().subscribe({next:n=>{this.teacherClasses=n,this.loading=!1,0===n.length&&this.toastr.warning("You are not assigned to any class for attendance.","No Classes")},error:n=>{this.loading=!1,this.handleError(n)}})}todayOnlyValidator(n){const a=new Date(n.value),c=new Date((new Date).getTime()+198e5);return a.setHours(0,0,0,0),c.setHours(0,0,0,0),a.getTime()===c.getTime()?null:{notToday:!0}}updateCanMarkAttendance(){const n=this.attendanceForm.get("classId")?.value;if(!n)return void(this.canMarkAttendance=!1);const a=this.teacherClasses.find(_=>_._id===n);if(!a)return void(this.canMarkAttendance=!1);const e=this.getTeacherIdFromToken();if(!e)return void(this.canMarkAttendance=!1);const s=a.attendanceTeacher?._id===e,c=a.substituteAttendanceTeachers?.some(_=>_._id===e);this.canMarkAttendance=s||c,this.canMarkAttendance||this.toastr.warning("You are not authorized to mark attendance for this class.","Warning")}getTeacherIdFromToken(){const n=localStorage.getItem("token");if(!n)return null;try{return JSON.parse(atob(n.split(".")[1])).additionalInfo?.teacherId||null}catch{return null}}loadStudents(){if(!this.selectedClassId)return this.students=[],void(this.studentsWithAvatar=[]);this.loading=!0,this.attendanceService.getStudentsByClass(this.selectedClassId).subscribe({next:n=>{this.students=Array.isArray(n)?n:n?.students||n?.data||[],this.studentsWithAvatar=this.students.map(a=>({...a,avatarUrl:this.computeAvatarUrl(a.profileImage),initials:this.getInitials(a.name)})),0===this.students.length&&this.toastr.warning("No students composed.","Warning"),this.attendanceForm.patchValue({attendanceRecords:this.students.map(a=>({studentId:a._id,status:"Present"}))}),this.loading=!1},error:n=>{this.loading=!1,this.handleError(n)}})}computeAvatarUrl(n){return n&&n.startsWith("http")?n:n?`https://edglobe.vercel.app/api/proxy-image/${encodeURIComponent(n)}`:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNGQ5NGUyIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjNTBjOWMzIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSJ1cmwoI2dyYWQpIiByeD0iMjAiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSIgZmlsbD0iI2ZmZiI+QVQ8L3RleHQ+PC9zdmc+"}getFallbackSvg(){return"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjY2NjIiByeD0iMjAiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxNiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iIGZpbGw9IiM2NjYiPj88L3RleHQ+PC9zdmc+"}handleImageError(n,a){const e=n.target;if(e){const s=this.getFallbackSvg();e.src=s,a.avatarUrl=s}}loadAttendanceHistory(){this.selectedClassId&&this.selectedAcademicYearId?(this.loading=!0,this.attendanceService.getAttendanceHistory(this.selectedClassId,this.selectedAcademicYearId).subscribe({next:n=>{this.attendanceHistory=Array.isArray(n)?n:[],this.loading=!1},error:n=>{this.loading=!1,this.handleError(n)}})):this.attendanceHistory=[]}getAttendanceStatus(n,a=this.attendanceForm){return(a.get("attendanceRecords")?.value||[]).find(c=>c.studentId===n)?.status||"Present"}updateAttendanceStatus(n,a,e=this.attendanceForm){const c=a.target.value,_=[...e.get("attendanceRecords")?.value||[]],P=_.findIndex(H=>H.studentId===n);-1!==P?_[P].status=c:_.push({studentId:n,status:c}),e.patchValue({attendanceRecords:_})}getImageUrl(n){return n?n.startsWith("http")?n:`https://edglobe.vercel.app/api/proxy-image/${encodeURIComponent(n)}`:"assets/avatar-placeholder.png"}getInitials(n){return n?n.trim().split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):"??"}onImageError(n,a){n.target.src="assets/images/avatar-placeholder.png",a.avatarUrl=n.target.src}countStatus(n,a){return n?.students?n.students.filter(e=>e.status===a).length:0}updateEditStatus(n,a){const s=a.target.value;this.selectedAttendance?.students?.[n]&&(this.selectedAttendance.students[n].status=s)}onSubmit(){var n=this;return(0,m.A)(function*(){return n.attendanceForm.invalid||!n.canMarkAttendance||0===n.students.length?(console.log("Early return: Invalid form/canMark/students"),void n.toastr.error("Please complete the form correctly.","Error")):(n.loading=!0,n.locationError="",n.skipGps?(console.log("Skipping GPS \u2013 direct API call"),void n.submitToAPI(null)):navigator.geolocation?void navigator.geolocation.getCurrentPosition(function(){var a=(0,m.A)(function*(e){console.log("GPS success:",e.coords),n.submitToAPI({latitude:e.coords.latitude,longitude:e.coords.longitude})});return function(e){return a.apply(this,arguments)}}(),a=>{console.error("GPS error:",a),n.loading=!1;let e="";switch(a.code){case 1:e='Location permission denied. Enable "Skip GPS" to continue.';break;case 2:e='Location unavailable (no signal). Enable "Skip GPS".';break;case 3:e='Location timeout. Enable "Skip GPS" or retry.';break;default:e='Unknown location error. Enable "Skip GPS".'}n.locationError=e,n.toastr.warning(e,"Location Issue")},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4}):(console.error("Geolocation not supported"),n.locationError="Geolocation not supported",n.toastr.error("Geolocation not supported. Enable skip GPS.","Error"),void(n.loading=!1)))})()}submitToAPI(n){console.log("API call starting with location:",n);const a={classId:this.attendanceForm.value.classId,subjectId:this.attendanceForm.value.subjectId,academicYearId:this.selectedAcademicYearId,date:(new Date).toISOString().split("T")[0],students:this.attendanceForm.value.attendanceRecords,location:n||void 0};console.log("Payload to API:",a),this.attendanceService.markAttendance(a).subscribe({next:e=>{this.toastr.success("Attendance marked successfully!","Success"),this.loadAttendanceHistory(),this.studentsWithAvatar=[],this.attendanceForm.reset(),this.loading=!1},error:e=>{console.error("API error:",e),this.loading=!1,this.toastr.error(e.error?.message||"Failed to mark attendance","Error")}})}isToday(n){const a=new Date(n),c=new Date((new Date).getTime()+198e5);return a.toDateString()===c.toDateString()}openEditModal(n,a){this.selectedAttendance=JSON.parse(JSON.stringify(a)),this.editForm.patchValue({attendanceRecords:a.students.map(e=>({studentId:e.studentId._id||e.studentId,status:e.status}))}),this.modalService.open(n,{size:"xl",centered:!0,scrollable:!0})}onEditSubmit(n){this.loading=!0;const a={attendanceId:this.selectedAttendance._id,academicYearId:this.selectedAcademicYearId,students:this.selectedAttendance.students.map(e=>({studentId:e.studentId._id||e.studentId,status:e.status}))};this.attendanceService.editAttendance(a).subscribe({next:()=>{this.toastr.success("Attendance updated successfully","Success"),this.loadAttendanceHistory(),n.close(),this.loading=!1},error:e=>{this.loading=!1,this.handleError(e)}})}handleError(n){let a=n.error?.message||"An error occurred";401===n.status&&this.router.navigate(["/login"]),this.toastr.error(a,"Error")}getClasses(){return this.teacherClasses}getSubjectNames(n){return n&&0!==n.length?n.map(a=>a.name).join(", "):"No subjects"}getSubjects(){const n=this.attendanceForm.get("classId")?.value;return n&&this.teacherClasses.find(e=>e._id===n)?.taughtSubjects||[]}goToMonthlyAttendance(){this.selectedClassId&&this.attendanceForm.value.subjectId?this.router.navigate(["/attendance/monthly"],{queryParams:{classId:this.selectedClassId,subjectId:this.attendanceForm.value.subjectId,academicYearId:this.selectedAcademicYearId}}):this.toastr.error("Please select class and subject first","Error")}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(r.ok),t.rXU(d.$),t.rXU(g.e),t.rXU(u.tw),t.rXU(O.Ix),t.rXU(b.Bq))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-attendance"]],hostBindings:function(a,e){1&a&&t.bIt("resize",function(c){return e.onResize(c)},!1,t.tSv)},decls:12,vars:3,consts:[["editModal",""],[1,"attendance-container"],[1,"header-section"],[1,"header-card"],[1,"title"],[1,"subtitle"],["class","text-center py-5",4,"ngIf"],["class","controls-card mb-4",4,"ngIf"],["class","history-section",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary","spinner-large"],[1,"visually-hidden"],[1,"controls-card","mb-4"],[3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-group"],[1,"form-label"],[1,"text-danger"],["formControlName","classId",1,"form-select",3,"change"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","subjectId",1,"form-select"],["type","date","formControlName","date",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["class","alert alert-warning alert-modern",4,"ngIf"],["class","table-section mt-4",4,"ngIf"],[1,"action-buttons","mt-4"],["type","button",1,"btn-material","btn-secondary",3,"click","disabled"],[1,"fas","fa-calendar-alt","me-2"],["type","submit",1,"btn-material","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],["class","fas fa-check-circle me-2",4,"ngIf"],[3,"value"],[1,"text-danger","small","mt-1"],[1,"alert","alert-warning","alert-modern"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"table-section","mt-4"],[1,"table-header"],[1,"mb-0"],[1,"fas","fa-users","me-2"],[1,"legend"],[1,"legend-item","present"],[1,"legend-item","absent"],[1,"legend-item","late"],["class","table-responsive",4,"ngIf"],["class","mobile-students-container",4,"ngIf"],[1,"table-responsive"],[1,"table","professional-table","table-hover"],[1,"text-center"],["class","student-row",4,"ngFor","ngForOf"],[1,"student-row"],[1,"index"],[1,"student-name-cell"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-3"],[1,"avatar-img",3,"error","src","alt"],[1,"initials-overlay"],[1,"student-name"],[1,"roll-no","text-center"],[1,"status-cell","text-center"],[1,"form-select","form-select-sm","status-select",3,"change","value","disabled"],["value","Present"],["value","Absent"],["value","Late"],[1,"mobile-students-container"],["class","student-card",4,"ngFor","ngForOf"],[1,"student-card"],[1,"card-content"],[1,"left-section"],[1,"avatar-container"],[1,"avatar-circle"],[1,"name-roll-container"],[1,"roll-no"],[1,"right-section"],[1,"status-label"],[1,"status-dropdown",3,"change","value","disabled"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"fas","fa-check-circle","me-2"],[1,"history-section"],[1,"section-title"],[1,"fas","fa-history","me-2"],["class","history-table-responsive",4,"ngIf"],["class","mobile-history-container",4,"ngIf"],[1,"history-table-responsive"],[1,"table","professional-table","table-sm"],[4,"ngFor","ngForOf"],[1,"badge","bg-success"],[1,"badge","bg-danger"],[1,"badge","bg-warning","text-dark"],[1,"btn","btn-sm","btn-outline-info",3,"click","disabled"],[1,"fas","fa-edit"],[1,"mobile-history-container"],["class","history-card",4,"ngFor","ngForOf"],[1,"history-card"],[1,"card-header"],[1,"date-class"],[1,"record-date"],[1,"record-class"],[1,"record-subject"],[1,"card-body"],[1,"stats-grid"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value","bg-success"],[1,"stat-value","bg-danger"],[1,"stat-value","bg-warning","text-dark"],[1,"edit-btn",3,"click","disabled"],[1,"custom-modal-container"],[1,"custom-modal-dialog"],[1,"custom-modal"],[1,"custom-modal-header"],[1,"custom-modal-title"],[1,"custom-modal-close",3,"click"],[1,"custom-modal-body"],[1,"mb-4","text-center"],[1,"table","table-bordered","align-middle"],[1,"table-primary"],["width","60"],["width","100"],["width","140"],[1,"custom-modal-footer"],[1,"btn-close-modal","btn-secondary",3,"click"],[1,"btn-close-modal","btn-primary",3,"click","disabled"],[1,"avatar-sm","me-2"],[1,"text-center","fw-bold"],[1,"form-select","form-select-sm",3,"ngModelChange","ngModel","ngModelOptions"]],template:function(a,e){1&a&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),t.EFF(4,"Mark Attendance"),t.k0s(),t.j41(5,"p",5),t.EFF(6,"Take daily attendance quickly and efficiently for your classes."),t.k0s()()(),t.DNE(7,x,4,0,"div",6)(8,G,38,11,"div",7)(9,U,6,2,"div",8),t.k0s(),t.DNE(10,z,43,9,"ng-template",null,0,t.C5r)),2&a&&(t.R7$(7),t.Y8G("ngIf",e.loading),t.R7$(),t.Y8G("ngIf",!e.loading),t.R7$(),t.Y8G("ngIf",e.attendanceHistory.length>0))},dependencies:[r.X1,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.j4,r.JD,p.MD,p.Sq,p.bT,p.P9,p.vh,b.XZ,r.YN,r.vS],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap";.attendance-container[_ngcontent-%COMP%]{padding:16px;font-family:Poppins,sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;max-width:1400px;margin:0 auto}.attendance-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]{margin-bottom:24px}.attendance-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]{background:#fffffff2;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);border-radius:16px;padding:24px;text-align:center;box-shadow:0 4px 12px #00000014;border:1px solid #e2e8f0}.attendance-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;background:linear-gradient(135deg,#4a90e2,#50c9c3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:0 0 8px}.attendance-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#64748b;font-size:.95rem}.attendance-container[_ngcontent-%COMP%]   .controls-card[_ngcontent-%COMP%]{background:#fffffff7;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px);border-radius:16px;padding:24px;box-shadow:0 4px 12px #00000014;border:1px solid #e2e8f0}.attendance-container[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin-bottom:20px}.attendance-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:600;color:#374151;font-size:.95rem;margin-bottom:8px;display:block}.attendance-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%], .attendance-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border:1.5px solid #cbd5e0;border-radius:12px;padding:10px 14px;font-size:.95rem;transition:all .25s ease}.attendance-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus, .attendance-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e226}.attendance-container[_ngcontent-%COMP%]   .alert-modern[_ngcontent-%COMP%]{background:#fed7aa40;border:1px solid #fdba74;color:#c2410c;border-radius:12px;padding:14px;font-weight:500}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:12px}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#1e293b;font-weight:600}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:.85rem}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item.present[_ngcontent-%COMP%]:before{content:"";width:10px;height:10px;background:#10b981;border-radius:50%}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item.absent[_ngcontent-%COMP%]:before{content:"";width:10px;height:10px;background:#ef4444;border-radius:50%}.attendance-container[_ngcontent-%COMP%]   .table-section[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item.late[_ngcontent-%COMP%]:before{content:"";width:10px;height:10px;background:#f59e0b;border-radius:50%}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]{font-size:.9rem}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;font-weight:600;text-transform:uppercase;font-size:.75rem;letter-spacing:.5px;padding:14px 12px}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:14px 12px;vertical-align:middle}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   .student-name-cell[_ngcontent-%COMP%]{font-weight:500;min-width:180px}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{width:38px;height:38px;border-radius:50%;overflow:hidden;background:linear-gradient(135deg,#4a90e2,#50c9c3);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.8rem;flex-shrink:0}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.attendance-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   .status-select[_ngcontent-%COMP%]{max-width:120px;margin:0 auto;font-size:.85rem;padding:6px 10px}.attendance-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;flex-wrap:wrap}.attendance-container[_ngcontent-%COMP%]   .history-section[_ngcontent-%COMP%]{margin-top:32px}.attendance-container[_ngcontent-%COMP%]   .history-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1e293b;padding-bottom:12px;border-bottom:2px solid #e2e8f0;margin-bottom:20px}.attendance-container[_ngcontent-%COMP%]   .btn-material[_ngcontent-%COMP%]{border-radius:30px;padding:10px 20px;font-weight:600;font-size:.9rem;box-shadow:0 4px 12px #00000014;transition:all .3s ease}.attendance-container[_ngcontent-%COMP%]   .btn-material.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4a90e2,#50c9c3);color:#fff;border:none}.attendance-container[_ngcontent-%COMP%]   .btn-material.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#64748b,#475569);color:#fff}.attendance-container[_ngcontent-%COMP%]   .btn-material[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 25px #0000001f}.attendance-container[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%], .attendance-container[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]{position:relative;width:40px;height:40px;border-radius:50%;overflow:hidden;background:linear-gradient(135deg,#4a90e2,#50c9c3);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:14px}.attendance-container[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%], .attendance-container[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]   .avatar-img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.attendance-container[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]   .initials-overlay[_ngcontent-%COMP%], .attendance-container[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]   .initials-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;pointer-events:none;z-index:1}@media (max-width: 768px){.attendance-container[_ngcontent-%COMP%]{padding:12px}.attendance-container[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.attendance-container[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}.attendance-container[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:flex-start}.attendance-container[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{display:none}.attendance-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{flex-direction:column}.attendance-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .btn-material[_ngcontent-%COMP%]{width:100%}.attendance-container[_ngcontent-%COMP%]   .mobile-students-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #f97316;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px #00000014;transition:all .2s ease}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #0000001f;transform:translateY(-1px)}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:16px;gap:12px}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .left-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:8px;flex:1}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .avatar-container[_ngcontent-%COMP%]{align-self:flex-start}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .name-roll-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .student-name[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;color:#1e293b;line-height:1.2}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .roll-no[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b;font-weight:500}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .right-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:4px;min-width:120px}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .status-label[_ngcontent-%COMP%]{font-weight:600;color:#64748b;font-size:.85rem;white-space:nowrap}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .status-dropdown[_ngcontent-%COMP%]{width:100px;border:none;border-radius:8px;padding:4px 8px;font-size:.9rem;background:#fff;color:#374151;box-shadow:0 1px 3px #0000001a}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .status-dropdown[_ngcontent-%COMP%]:focus{outline:none;background:#dbeafe;box-shadow:0 0 0 2px #3b82f6}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .status-dropdown[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]:checked{background-color:#3b82f6;color:#fff}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .status-dropdown[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{background:#fff;color:#374151;padding:4px}.attendance-container[_ngcontent-%COMP%]   .student-card[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]{width:48px;height:48px;font-size:16px}.attendance-container[_ngcontent-%COMP%]   .history-table-responsive[_ngcontent-%COMP%]{display:none}.attendance-container[_ngcontent-%COMP%]   .history-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:16px}.attendance-container[_ngcontent-%COMP%]   .mobile-history-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 12px #00000014;transition:all .2s ease;border:1px solid #e2e8f0}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #0000001f;transform:translateY(-1px)}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;gap:8px}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .date-class[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;flex:1}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .date-class[_ngcontent-%COMP%]   .record-date[_ngcontent-%COMP%]{font-weight:600;font-size:1rem;color:#1e293b}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .date-class[_ngcontent-%COMP%]   .record-class[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .record-subject[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem;color:#374151;white-space:nowrap}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:8px}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 4px}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.75rem;color:#64748b;text-align:center}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem;padding:4px 8px;border-radius:6px;min-width:24px;text-align:center}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{align-self:flex-end;background:transparent;border:1px solid #3b82f6;color:#3b82f6;padding:6px 12px;border-radius:6px;font-size:.85rem;font-weight:500;transition:all .2s ease}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover:not([disabled]){background:#3b82f6;color:#fff}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.attendance-container[_ngcontent-%COMP%]   .history-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:4px}}.attendance-container[_ngcontent-%COMP%]   .professional-table.table-sm[_ngcontent-%COMP%]{font-size:.8rem}.attendance-container[_ngcontent-%COMP%]   .professional-table.table-sm[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .attendance-container[_ngcontent-%COMP%]   .professional-table.table-sm[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 6px;white-space:nowrap}.attendance-container[_ngcontent-%COMP%]   .professional-table.table-sm[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.7rem;padding:4px 6px}']})}}return o})()}}]);