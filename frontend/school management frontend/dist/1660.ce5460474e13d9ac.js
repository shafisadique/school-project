"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[1660],{1660:(_,c,a)=>{a.r(c),a.d(c,{RouteRoutes:()=>k});var d=a(177),u=a(9417),t=a(4438),p=a(3338),m=a(6561),h=a(5794);function R(r,l){if(1&r){const o=t.RV6();t.j41(0,"button",48),t.bIt("click",function(){t.eBV(o);const e=t.XpG().index,i=t.XpG();return t.Njj(i.removePickupPoint(e))}),t.EFF(1,"Remove"),t.k0s()}}function g(r,l){if(1&r){const o=t.RV6();t.j41(0,"div",45)(1,"input",46),t.mxI("ngModelChange",function(e){const i=t.eBV(o).index,n=t.XpG();return t.DH7(n.currentRoute.pickupPoints[i],e)||(n.currentRoute.pickupPoints[i]=e),t.Njj(e)}),t.k0s(),t.DNE(2,R,2,0,"button",47),t.k0s()}if(2&r){const o=l.index,s=t.XpG();t.R7$(),t.Mz_("name","pickupPoints_",o,""),t.R50("ngModel",s.currentRoute.pickupPoints[o]),t.R7$(),t.Y8G("ngIf",o>0||s.currentRoute.pickupPoints.length>1)}}function b(r,l){if(1&r){const o=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td")(14,"button",49),t.bIt("click",function(){const e=t.eBV(o).$implicit,i=t.XpG();return t.Njj(i.editRoute(e))}),t.nrm(15,"i",50),t.EFF(16," Edit "),t.k0s(),t.j41(17,"button",51),t.bIt("click",function(){const e=t.eBV(o).$implicit,i=t.XpG();return t.Njj(i.deleteRoute(e._id))}),t.nrm(18,"i",52),t.EFF(19," Delete "),t.k0s()()()}if(2&r){const o=l.$implicit;t.R7$(2),t.JRh(o.name),t.R7$(2),t.JRh(o.distance),t.R7$(2),t.JRh(o.feeAmount),t.R7$(2),t.JRh(o.frequency),t.R7$(2),t.JRh(o.pickupPoints.join(", ")),t.R7$(2),t.JRh(o.status?"Active":"Inactive")}}function f(r,l){if(1&r&&(t.j41(0,"option",53),t.EFF(1),t.k0s()),2&r){const o=l.$implicit;t.Y8G("value",o._id),t.R7$(),t.JRh(o.name)}}function F(r,l){if(1&r&&(t.j41(0,"option",53),t.EFF(1),t.k0s()),2&r){const o=l.$implicit;t.Y8G("value",o),t.R7$(),t.JRh(o.name)}}const k=[{path:"route-transportation",component:(()=>{class r{constructor(o,s,e){this.routeService=o,this.authService=s,this.toastr=e,this.routes=[],this.newRoute={name:"",pickupPoints:["Default Point"],distance:null,feeAmount:null,frequency:"Monthly"},this.selectedRoute=null,this.editMode=!1,this.students=[],this.selectedStudentId=null,this.schoolId=null,this.currentRoute=this.newRoute}ngOnInit(){this.schoolId=this.authService.getUserSchoolId(),this.schoolId?this.loadRoutes():this.toastr.error("School ID not found. Please log in again.","Error")}loadRoutes(){this.routeService.getRoutes().subscribe({next:o=>{this.routes=o.data,console.log(this.routes)},error:o=>this.toastr.error("Failed to load routes","Error")})}addPickupPoint(){this.currentRoute.pickupPoints.push("")}removePickupPoint(o){this.currentRoute.pickupPoints.length>1?this.currentRoute.pickupPoints.splice(o,1):this.toastr.warning("At least one pickup point is required","Warning")}createRoute(){if(!this.currentRoute.name||!this.currentRoute.pickupPoints.length||null===this.currentRoute.distance||null===this.currentRoute.feeAmount)return void this.toastr.warning("All fields are required","Warning");if(!this.authService.getUserId())return void this.toastr.error("User ID not found. Please log in again.","Error");const s={...this.currentRoute,pickupPoints:this.currentRoute.pickupPoints.filter(e=>e.trim().length>0),schoolId:this.schoolId};0!==s.pickupPoints.length?(console.log("Sending payload:",s),this.routeService.createRoute(s).subscribe({next:()=>{this.toastr.success("Route created successfully","Success"),this.resetForm(),this.loadRoutes()},error:e=>this.toastr.error(`Failed to create route: ${e.message}`,"Error")})):this.toastr.warning("At least one valid pickup point is required","Warning")}editRoute(o){this.selectedRoute={...o},this.currentRoute=this.selectedRoute,this.editMode=!0}updateRoute(){if(!this.currentRoute._id||!this.currentRoute.name||!this.currentRoute.pickupPoints.length||null===this.currentRoute.distance||null===this.currentRoute.feeAmount)return void this.toastr.warning("All fields are required","Warning");const o={...this.currentRoute,pickupPoints:this.currentRoute.pickupPoints.filter(s=>s.trim().length>0)};0!==o.pickupPoints.length?this.routeService.updateRoute(this.currentRoute._id,o).subscribe({next:()=>{this.toastr.success("Route updated successfully","Success"),this.editMode=!1,this.selectedRoute=null,this.currentRoute=this.newRoute,this.loadRoutes()},error:s=>this.toastr.error(`Failed to update route: ${s.message}`,"Error")}):this.toastr.warning("At least one valid pickup point is required","Warning")}deleteRoute(o){confirm("Are you sure you want to delete this route?")&&this.routeService.deleteRoute(o).subscribe({next:()=>{this.toastr.success("Route deleted successfully","Success"),this.loadRoutes()},error:s=>this.toastr.error("Failed to delete route (possibly due to assigned students)","Error")})}assignRoute(){this.selectedStudentId?this.routeService.assignRoute(this.selectedStudentId,this.selectedRoute?this.selectedRoute._id:null).subscribe({next:()=>{this.toastr.success("Route assigned to student successfully","Success"),this.selectedStudentId=null,this.selectedRoute=null},error:s=>this.toastr.error("Failed to assign route","Error")}):this.toastr.warning("Please select a student","Warning")}resetForm(){this.newRoute={name:"",pickupPoints:["Default Point"],distance:null,feeAmount:null,frequency:"Monthly"},this.currentRoute=this.newRoute,this.editMode=!1,this.selectedRoute=null}isFormInvalid(){return!this.currentRoute.name||this.currentRoute.pickupPoints.some(o=>!o.trim())||null===this.currentRoute.distance||null===this.currentRoute.feeAmount}static{this.\u0275fac=function(s){return new(s||r)(t.rXU(p.v),t.rXU(m.u),t.rXU(h.tw))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-route-transportation"]],decls:101,vars:13,consts:[[1,"container","mt-4"],[1,"card","mb-4","shadow"],[1,"card-body"],[3,"ngSubmit"],[1,"form-section"],[1,"row"],[1,"col-md-4","col-12"],[1,"form-group"],["type","text","name","name","required","",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],["type","number","name","distance","min","0","required","",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],["type","number","name","feeAmount","min","0","required","",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],["name","frequency","required","",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],["value","Monthly"],["value","Quarterly"],["value","Yearly"],[1,"col-md-8","col-12"],["class","pickup-points mb-2",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-outline-secondary","mt-2",3,"click"],[1,"mt-3"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"bi","bi-save","me-2"],[1,"card","shadow"],[1,"card-header","bg-secondary","text-white"],[1,"mb-0"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","mb-0"],[1,"table-light"],[4,"ngFor","ngForOf"],["id","assignRouteModal","tabindex","-1","aria-labelledby","assignRouteModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","assignRouteModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["name","studentId",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["name","routeId",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],["data-bs-toggle","modal","data-bs-target","#assignRouteModal",1,"btn","btn-success","mt-3"],[1,"bi","bi-person-plus"],[1,"pickup-points","mb-2"],["type","text","required","",1,"form-control","form-control-sm","shadow-sm",3,"ngModelChange","ngModel","name"],["type","button","class","btn btn-danger btn-sm",3,"click",4,"ngIf"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"btn","btn-sm","btn-warning","me-2",3,"click"],[1,"bi","bi-pencil"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"bi","bi-trash"],[3,"value"]],template:function(s,e){1&s&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),t.bIt("ngSubmit",function(){return e.editMode?e.updateRoute():e.createRoute()}),t.j41(4,"fieldset",4)(5,"legend"),t.EFF(6),t.k0s(),t.j41(7,"div",5)(8,"div",6)(9,"div",7)(10,"label"),t.EFF(11,"Route Name:"),t.k0s(),t.j41(12,"input",8),t.mxI("ngModelChange",function(n){return t.DH7(e.currentRoute.name,n)||(e.currentRoute.name=n),n}),t.k0s()()(),t.j41(13,"div",6)(14,"div",7)(15,"label"),t.EFF(16,"Distance (km):"),t.k0s(),t.j41(17,"input",9),t.mxI("ngModelChange",function(n){return t.DH7(e.currentRoute.distance,n)||(e.currentRoute.distance=n),n}),t.k0s()()(),t.j41(18,"div",6)(19,"div",7)(20,"label"),t.EFF(21,"Fee Amount:"),t.k0s(),t.j41(22,"input",10),t.mxI("ngModelChange",function(n){return t.DH7(e.currentRoute.feeAmount,n)||(e.currentRoute.feeAmount=n),n}),t.k0s()()()(),t.j41(23,"div",5)(24,"div",6)(25,"div",7)(26,"label"),t.EFF(27,"Frequency:"),t.k0s(),t.j41(28,"select",11),t.mxI("ngModelChange",function(n){return t.DH7(e.currentRoute.frequency,n)||(e.currentRoute.frequency=n),n}),t.j41(29,"option",12),t.EFF(30,"Monthly"),t.k0s(),t.j41(31,"option",13),t.EFF(32,"Quarterly"),t.k0s(),t.j41(33,"option",14),t.EFF(34,"Yearly"),t.k0s()()()(),t.j41(35,"div",15)(36,"div",7)(37,"label"),t.EFF(38,"Pickup Points:"),t.k0s(),t.DNE(39,g,3,4,"div",16),t.j41(40,"button",17),t.bIt("click",function(){return e.addPickupPoint()}),t.EFF(41,"Add Pickup Point"),t.k0s()()()()(),t.j41(42,"div",18)(43,"button",19),t.nrm(44,"i",20),t.EFF(45),t.k0s()()()()(),t.j41(46,"div",21)(47,"div",22)(48,"h3",23),t.EFF(49,"Transportation Routes"),t.k0s()(),t.j41(50,"div",24)(51,"div",25)(52,"table",26)(53,"thead",27)(54,"tr")(55,"th"),t.EFF(56,"Name"),t.k0s(),t.j41(57,"th"),t.EFF(58,"Distance (km)"),t.k0s(),t.j41(59,"th"),t.EFF(60,"Fee Amount"),t.k0s(),t.j41(61,"th"),t.EFF(62,"Frequency"),t.k0s(),t.j41(63,"th"),t.EFF(64,"Pickup Points"),t.k0s(),t.j41(65,"th"),t.EFF(66,"Status"),t.k0s(),t.j41(67,"th"),t.EFF(68,"Actions"),t.k0s()()(),t.j41(69,"tbody"),t.DNE(70,b,20,6,"tr",28),t.k0s()()()()(),t.j41(71,"div",29)(72,"div",30)(73,"div",31)(74,"div",32)(75,"h5",33),t.EFF(76,"Assign Route to Student"),t.k0s(),t.nrm(77,"button",34),t.k0s(),t.j41(78,"div",35)(79,"div",7)(80,"label"),t.EFF(81,"Select a Student:"),t.k0s(),t.j41(82,"select",36),t.mxI("ngModelChange",function(n){return t.DH7(e.selectedStudentId,n)||(e.selectedStudentId=n),n}),t.j41(83,"option",37),t.EFF(84,"Select a Student"),t.k0s(),t.DNE(85,f,2,2,"option",38),t.k0s()(),t.j41(86,"div",7)(87,"label"),t.EFF(88,"Select Route:"),t.k0s(),t.j41(89,"select",39),t.mxI("ngModelChange",function(n){return t.DH7(e.selectedRoute,n)||(e.selectedRoute=n),n}),t.j41(90,"option",37),t.EFF(91,"No Route"),t.k0s(),t.DNE(92,F,2,2,"option",38),t.k0s()()(),t.j41(93,"div",40)(94,"button",41),t.EFF(95,"Close"),t.k0s(),t.j41(96,"button",42),t.bIt("click",function(){return e.assignRoute()}),t.EFF(97,"Assign"),t.k0s()()()()(),t.j41(98,"button",43),t.nrm(99,"i",44),t.EFF(100," Assign Route to Student "),t.k0s()()),2&s&&(t.R7$(6),t.JRh(e.editMode?"Edit Route":"Create New Route"),t.R7$(6),t.R50("ngModel",e.currentRoute.name),t.R7$(5),t.R50("ngModel",e.currentRoute.distance),t.R7$(5),t.R50("ngModel",e.currentRoute.feeAmount),t.R7$(6),t.R50("ngModel",e.currentRoute.frequency),t.R7$(11),t.Y8G("ngForOf",e.currentRoute.pickupPoints),t.R7$(4),t.Y8G("disabled",e.isFormInvalid()),t.R7$(2),t.SpI("",e.editMode?"Update Route":"Create Route"," "),t.R7$(25),t.Y8G("ngForOf",e.routes),t.R7$(12),t.R50("ngModel",e.selectedStudentId),t.R7$(3),t.Y8G("ngForOf",e.students),t.R7$(4),t.R50("ngModel",e.selectedRoute),t.R7$(3),t.Y8G("ngForOf",e.routes))},dependencies:[d.MD,d.Sq,d.bT,u.YN,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,u.YS,u.VZ,u.vS,u.cV],encapsulation:2})}}return r})()}]}}]);