"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[1150],{3891:(C,_,l)=>{l.d(_,{e:()=>b});var d=l(1626),g=l(2525),t=l(4438);let b=(()=>{class h{constructor(e){this.http=e,this.apiUrl=g.c.apiUrl}getClassesBySchool(e){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${e}`)}getStudentsByClass(e,a){const i=`${this.apiUrl}/api/students/get-student-by-class/${e}`,f=(new d.Nl).set("academicYearId",a);return this.http.get(i,{params:f})}assignRollNumbers(e){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${e}`,{})}assignRollNumbersAlphabetically(e){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${e}`,{})}assignRollNumberToStudent(e,a){return this.http.put(`${this.apiUrl}/api/students/${e}/assign-roll-number`,{rollNo:a})}createClass(e){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,e)}deleteAssignment(e){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:e})}createSubject(e){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,e)}getSubjects(e){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${e}`)}getTeachers(e){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${e}`)}getCombinedAssignments(e,a){const i=(new d.Nl).set("academicYearId",a);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${e}`,{params:i})}assignSubjectToClass(e,a,i,f){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:e,subjectId:a,teacherId:i,academicYearId:f})}updateAssignment(e){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,e)}getAssignmentsByTeacher(e,a,i){let f=(new d.Nl).set("academicYearId",a);return i&&(f=f.set("date",i)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${e}`,{params:f})}updateAttendanceTeachers(e,a,i){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:e,attendanceTeacher:a,substituteAttendanceTeachers:i})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(a){return new(a||h)(t.KVO(d.Qq))}}static{this.\u0275prov=t.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},1150:(C,_,l)=>{l.r(_),l.d(_,{CashReportComponent:()=>O});var d=l(177),g=l(9417),t=l(4438),b=l(2329),h=l(3891),v=l(6561);const e=(r,p,n)=>({"method-badge cash-badge":r,"method-badge cheque-badge":p,"method-badge online-badge":n});function a(r,p){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const n=p.$implicit;t.Y8G("value",n.value),t.R7$(),t.JRh(n.label)}}function i(r,p){if(1&r&&(t.j41(0,"option",18),t.EFF(1),t.k0s()),2&r){const n=p.$implicit;t.Y8G("ngValue",n),t.R7$(),t.JRh(n.name)}}function f(r,p){if(1&r&&(t.j41(0,"option",17),t.EFF(1),t.k0s()),2&r){const n=p.$implicit;t.Y8G("value",n),t.R7$(),t.JRh(n)}}function M(r,p){1&r&&(t.j41(0,"div",19)(1,"div",20)(2,"span",21),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p"),t.EFF(5,"Loading report data..."),t.k0s()())}function F(r,p){if(1&r&&(t.j41(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25),t.EFF(4,"Total Transactions"),t.k0s(),t.j41(5,"div",26),t.EFF(6),t.k0s()(),t.j41(7,"div",24)(8,"div",25),t.EFF(9,"Total Amount"),t.k0s(),t.j41(10,"div",26),t.EFF(11),t.nI1(12,"number"),t.k0s()(),t.j41(13,"div",24)(14,"div",25),t.EFF(15,"Cash"),t.k0s(),t.j41(16,"div",26),t.EFF(17),t.nI1(18,"number"),t.k0s()(),t.j41(19,"div",24)(20,"div",25),t.EFF(21,"Cheque"),t.k0s(),t.j41(22,"div",26),t.EFF(23),t.nI1(24,"number"),t.k0s()(),t.j41(25,"div",24)(26,"div",25),t.EFF(27,"Online"),t.k0s(),t.j41(28,"div",26),t.EFF(29),t.nI1(30,"number"),t.k0s()()()()),2&r){const n=t.XpG();t.R7$(6),t.JRh(n.reportData.summary.transactionCount),t.R7$(5),t.SpI("\u20b9",t.bMT(12,5,n.reportData.summary.total),""),t.R7$(6),t.SpI("\u20b9",t.bMT(18,7,n.reportData.summary.cashTotal),""),t.R7$(6),t.SpI("\u20b9",t.bMT(24,9,n.reportData.summary.chequeTotal),""),t.R7$(6),t.SpI("\u20b9",t.bMT(30,11,n.reportData.summary.onlineTotal),"")}}function y(r,p){if(1&r){const n=t.RV6();t.j41(0,"div",27)(1,"button",28),t.bIt("click",function(){t.eBV(n);const s=t.XpG();return t.Njj(s.exportToCSV())}),t.nrm(2,"i",29),t.EFF(3," Export to CSV "),t.k0s()()}}function E(r,p){if(1&r&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.nI1(14,"number"),t.k0s(),t.j41(15,"td")(16,"span",34),t.EFF(17),t.k0s()(),t.j41(18,"td"),t.EFF(19),t.k0s(),t.j41(20,"td"),t.EFF(21),t.k0s()()),2&r){const n=p.$implicit;t.R7$(2),t.JRh(t.i5U(3,10,n.date,"dd/MM/yyyy")),t.R7$(3),t.JRh(n.student.name),t.R7$(2),t.JRh(n.student.admissionNo),t.R7$(2),t.JRh(n.student.className),t.R7$(2),t.JRh(n.student.section),t.R7$(2),t.SpI("\u20b9",t.bMT(14,13,n.amount),""),t.R7$(3),t.Y8G("ngClass",t.sMw(15,e,"Cash"===n.method,"Cheque"===n.method,"Online"===n.method)),t.R7$(),t.SpI(" ",n.method," "),t.R7$(2),t.JRh(n.processedBy||"System"),t.R7$(2),t.JRh(n.invoiceMonth)}}function R(r,p){1&r&&(t.j41(0,"div",35),t.nrm(1,"i",36),t.j41(2,"h5"),t.EFF(3,"No transactions found for the selected filters"),t.k0s()())}function P(r,p){if(1&r&&(t.j41(0,"div",30)(1,"table",31)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"Date"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Student"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Admission No"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Class"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Section"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Amount"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Method"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Processed By"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Invoice Month"),t.k0s()()(),t.j41(22,"tbody"),t.DNE(23,E,22,19,"tr",32),t.k0s()(),t.DNE(24,R,4,0,"div",33),t.k0s()),2&r){const n=t.XpG();t.R7$(23),t.Y8G("ngForOf",n.reportData.transactions),t.R7$(),t.Y8G("ngIf",0===n.reportData.transactions.length)}}let O=(()=>{class r{constructor(n,c,s,m){this.feeService=n,this.classService=c,this.authService=s,this.datePipe=m,this.reportData=null,this.filters={method:"Cash",startDate:"",endDate:"",classId:"",section:""},this.isLoading=!1,this.classes=[],this.sections=[],this.paymentMethods=[{value:"Cash",label:"Cash"},{value:"Cheque",label:"Cheque"},{value:"Online",label:"Online"},{value:"",label:"All Methods"}]}ngOnInit(){const n=this.authService.getSchoolId();this.classService.getClassesBySchool(n).subscribe({next:s=>{this.classes=s},error:s=>console.error("Failed to load classes",s)});const c=new Date;this.filters.startDate=this.datePipe.transform(new Date(c.getFullYear(),c.getMonth(),1),"yyyy-MM-dd"),this.filters.endDate=this.datePipe.transform(c,"yyyy-MM-dd")}onClassChange(){this.sections=[],this.filters.classId&&this.filters.classId.sections&&(this.sections=this.filters.classId.sections)}generateReport(){this.isLoading=!0,this.reportData=null;const n={...this.filters,classId:"object"==typeof this.filters.classId?this.filters.classId._id:this.filters.classId};this.feeService.getFeeCollectionReport(n).subscribe({next:c=>{console.log(c),this.reportData=c.data,this.isLoading=!1},error:c=>{console.error("Error loading report:",c),this.isLoading=!1}})}exportToCSV(){if(!this.reportData)return;const c=this.reportData.transactions.map(u=>[this.datePipe.transform(u.date,"dd/MM/yyyy"),u.student.name,u.student.admissionNo,u.student.className,u.student.section,u.amount,u.method,u.processedBy,u.invoiceMonth]);let s="data:text/csv;charset=utf-8,";s+=["Date","Student Name","Admission No","Class","Section","Amount","Payment Method","Processed By","Invoice Month"].join(",")+"\n",c.forEach(u=>{s+=u.join(",")+"\n"});const m=encodeURI(s),o=document.createElement("a");o.setAttribute("href",m),o.setAttribute("download",`cash-payments-${(new Date).toISOString()}.csv`),document.body.appendChild(o),o.click(),document.body.removeChild(o)}static{this.\u0275fac=function(c){return new(c||r)(t.rXU(b.G),t.rXU(h.e),t.rXU(v.u),t.rXU(d.vh))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-cash-report"]],features:[t.Jv_([d.vh])],decls:37,vars:12,consts:[[1,"container-fluid"],[1,"report-card"],[1,"filter-row"],[1,"filter-group"],[1,"filter-label"],[1,"filter-control","form-select-sm",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","date",1,"filter-control","form-select-sm",3,"ngModelChange","ngModel"],[1,"filter-control","form-select-sm",3,"ngModelChange","change","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf"],[1,"filter-btn","btn-sm",3,"click"],[1,"fas","fa-filter"],["class","loading-container",4,"ngIf"],["class","summary-card",4,"ngIf"],["class","export-container",4,"ngIf"],["class","table-container",4,"ngIf"],[3,"value"],[3,"ngValue"],[1,"loading-container"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"summary-card"],[1,"summary-grid"],[1,"summary-item"],[1,"summary-label"],[1,"summary-value"],[1,"export-container"],[1,"export-btn",3,"click"],[1,"fas","fa-file-csv"],[1,"table-container"],[1,"report-table","table-sm"],[4,"ngFor","ngForOf"],["class","no-data",4,"ngIf"],[3,"ngClass"],[1,"no-data"],[1,"fas","fa-file-excel"]],template:function(c,s){1&c&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),t.EFF(5,"Payment Method"),t.k0s(),t.j41(6,"select",5),t.mxI("ngModelChange",function(o){return t.DH7(s.filters.method,o)||(s.filters.method=o),o}),t.DNE(7,a,2,2,"option",6),t.k0s()(),t.j41(8,"div",3)(9,"label",4),t.EFF(10,"Start Date"),t.k0s(),t.j41(11,"input",7),t.mxI("ngModelChange",function(o){return t.DH7(s.filters.startDate,o)||(s.filters.startDate=o),o}),t.k0s()(),t.j41(12,"div",3)(13,"label",4),t.EFF(14,"End Date"),t.k0s(),t.j41(15,"input",7),t.mxI("ngModelChange",function(o){return t.DH7(s.filters.endDate,o)||(s.filters.endDate=o),o}),t.k0s()(),t.j41(16,"div",3)(17,"label",4),t.EFF(18,"Class"),t.k0s(),t.j41(19,"select",8),t.mxI("ngModelChange",function(o){return t.DH7(s.filters.classId,o)||(s.filters.classId=o),o}),t.bIt("change",function(){return s.onClassChange()}),t.j41(20,"option",9),t.EFF(21,"All Classes"),t.k0s(),t.DNE(22,i,2,2,"option",10),t.k0s()(),t.j41(23,"div",3)(24,"label",4),t.EFF(25,"Section"),t.k0s(),t.j41(26,"select",5),t.mxI("ngModelChange",function(o){return t.DH7(s.filters.section,o)||(s.filters.section=o),o}),t.j41(27,"option",9),t.EFF(28,"All Sections"),t.k0s(),t.DNE(29,f,2,2,"option",6),t.k0s()(),t.j41(30,"button",11),t.bIt("click",function(){return s.generateReport()}),t.nrm(31,"i",12),t.EFF(32," Apply Filters "),t.k0s()(),t.DNE(33,M,6,0,"div",13)(34,F,31,13,"div",14)(35,y,4,0,"div",15)(36,P,25,2,"div",16),t.k0s()()),2&c&&(t.R7$(6),t.R50("ngModel",s.filters.method),t.R7$(),t.Y8G("ngForOf",s.paymentMethods),t.R7$(4),t.R50("ngModel",s.filters.startDate),t.R7$(4),t.R50("ngModel",s.filters.endDate),t.R7$(4),t.R50("ngModel",s.filters.classId),t.R7$(3),t.Y8G("ngForOf",s.classes),t.R7$(4),t.R50("ngModel",s.filters.section),t.R7$(3),t.Y8G("ngForOf",s.sections),t.R7$(4),t.Y8G("ngIf",s.isLoading),t.R7$(),t.Y8G("ngIf",s.reportData&&!s.isLoading),t.R7$(),t.Y8G("ngIf",s.reportData&&!s.isLoading),t.R7$(),t.Y8G("ngIf",s.reportData&&!s.isLoading))},dependencies:[d.MD,d.YU,d.Sq,d.bT,d.QX,d.vh,g.YN,g.xH,g.y7,g.me,g.wz,g.BC,g.vS],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap";@import"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css";@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary: #2C3E50;--secondary: #3498DB;--success: #27AE60;--warning: #F39C12;--danger: #E74C3C;--light: #F8F9FA;--dark: #212529;--gray: #6C757D;--light-gray: #E9ECEF;--border-radius: 8px;--shadow: 0 4px 6px rgba(0, 0, 0, .1)}.container-fluid[_ngcontent-%COMP%]{max-width:1500px;margin:0 auto;padding:0 10px;font-family:Poppins,sans-serif}.header[_ngcontent-%COMP%]{background:linear-gradient(120deg,var(--primary),#1A2A3A);color:#fff;padding:20px 25px;border-radius:var(--border-radius) var(--border-radius) 0 0;box-shadow:var(--shadow);margin-bottom:25px}.breadcrumb[_ngcontent-%COMP%]{background:#ffffff1a;padding:8px 15px;border-radius:30px;margin-top:10px}.breadcrumb[_ngcontent-%COMP%]   .breadcrumb-item[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#d6e4f0;text-decoration:none;font-size:.9rem}.breadcrumb[_ngcontent-%COMP%]   .breadcrumb-item.active[_ngcontent-%COMP%]{color:#fff;font-weight:500}.page-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.8rem;margin-bottom:0}.report-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);padding:25px;box-shadow:var(--shadow);margin-bottom:25px}.filter-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:25px;align-items:center}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:140px}.filter-label[_ngcontent-%COMP%]{font-weight:600;color:var(--primary);margin-bottom:6px;font-size:.9rem}.filter-control[_ngcontent-%COMP%]{border:1px solid #CED4DA;border-radius:var(--border-radius);background:#fff;font-family:Poppins,sans-serif;font-size:.95rem}.filter-btn[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border:none;border-radius:var(--border-radius);padding:10px;font-weight:600;cursor:pointer;transition:background .3s;display:flex;align-items:center;gap:8px;align-self:flex-end;margin-top:24px}.filter-btn[_ngcontent-%COMP%]:hover{background:#1a252f}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:40px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:15px;color:var(--gray)}.summary-card[_ngcontent-%COMP%]{background:#e8f4fe;border-radius:var(--border-radius);padding:20px;margin-bottom:25px}.summary-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px}.summary-item[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);padding:15px;box-shadow:0 2px 4px #0000000d;text-align:center}.summary-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:var(--primary);margin:10px 0}.summary-label[_ngcontent-%COMP%]{color:var(--gray);font-size:.9rem}.export-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:20px}.export-btn[_ngcontent-%COMP%]{background:var(--success);color:#fff;border:none;border-radius:var(--border-radius);padding:10px 20px;font-weight:600;cursor:pointer;transition:background .3s;display:flex;align-items:center;gap:8px}.export-btn[_ngcontent-%COMP%]:hover{background:#219653}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.report-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border-radius:var(--border-radius);overflow:hidden;box-shadow:var(--shadow)}.report-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--primary);color:#fff;text-align:left;padding:10px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.report-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;border-bottom:1px solid var(--light-gray);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.report-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.report-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9fbfd}.report-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#eff7ff}.method-badge[_ngcontent-%COMP%]{padding:5px 12px;border-radius:20px;font-size:.85rem;font-weight:500;display:inline-block}.cash-badge[_ngcontent-%COMP%]{background:#e8f5e9;color:var(--success)}.cheque-badge[_ngcontent-%COMP%]{background:#e3f2fd;color:var(--secondary)}.online-badge[_ngcontent-%COMP%]{background:#fff8e1;color:var(--warning)}.no-data[_ngcontent-%COMP%]{text-align:center;padding:40px;color:var(--gray);font-weight:500}.no-data[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:15px;color:#cfd8dc}']})}}return r})()},2329:(C,_,l)=>{l.d(_,{G:()=>b});var d=l(2525),g=l(4438),t=l(1626);let b=(()=>{class h{constructor(e){this.http=e,this.apiUrl=d.c.apiUrl}getFeeStructures(e){return this.http.get(`${this.apiUrl}/api/fees/structures`,{params:{schoolId:e}})}getStudentInvoices(e,a){const i={};return a&&(i.academicYearId=a),this.http.get(`${this.apiUrl}/api/fees/invoices/student/${e}`,{params:i})}searchInvoiceStudents(e,a){return this.http.get(`${this.apiUrl}/api/fees/search`,{params:{q:e,schoolId:a}})}createFeeStructure(e){return this.http.post(`${this.apiUrl}/api/fees/structures`,e)}updateFeeStructure(e,a){return this.http.put(`${this.apiUrl}/api/fees/structures/${e}`,a)}deleteFeeStructure(e){return this.http.delete(`${this.apiUrl}/api/fees/structures/${e}`)}generateInvoices(e){return this.http.post(`${this.apiUrl}/api/fees/generate`,e)}getStudentFeeSummary(e){return this.http.get(`${this.apiUrl}/api/fees/students/${e}/summary`)}getInvoiceById(e){return this.http.get(`${this.apiUrl}/api/fees/invoices/${e}`)}generateAdvanceInvoices(e){return this.http.post(`${this.apiUrl}/api/fees/invoices/advance`,e)}processPayment(e,a){return this.http.post(`${this.apiUrl}/api/fees/students/${e}/payments`,a)}getFeeCollectionReport(e){return this.http.get(`${this.apiUrl}/api/fees/reports/collection-details`,{params:e})}generateClassReceipts(e){return this.http.post(`${this.apiUrl}/api/fees/receipts`,e,{responseType:"blob"})}getPaidInvoiceList(e){return this.http.get(`${this.apiUrl}/api/fees/paid-invoices`,{params:e})}getInvoicesByClassAndMonth(e,a,i){return this.http.get(`${this.apiUrl}/api/fees/invoices`,{params:{classId:e,month:a,academicYearId:i}})}getStudentPaymentHistory(e){return this.http.get(`${this.apiUrl}/api/fees/students/${e}/payment-history`)}downloadInvoicePDF(e){return this.http.get(`${this.apiUrl}/api/fees/invoices/${e}/pdf`,{responseType:"blob"})}downloadReceiptPDF(e){return this.http.get(`${this.apiUrl}/api/fees/receipts/${e}/pdf`,{responseType:"blob"})}notifyParents(e,a,i){return this.http.post(`${this.apiUrl}/api/fees/notify-parents`,{classId:e,month:a,academicYearId:i})}static{this.\u0275fac=function(a){return new(a||h)(g.KVO(t.Qq))}}static{this.\u0275prov=g.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()}}]);