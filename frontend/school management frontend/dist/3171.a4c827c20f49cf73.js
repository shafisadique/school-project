"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[3171],{3171:($,h,m)=>{m.r(h),m.d(h,{HolidayCalendarComponent:()=>N});var c=m(9417),_=m(177),t=m(4438),g=m(1964),p=m(6561),u=m(8652),f=m(5794);function y(a,r){1&a&&(t.j41(0,"div",27)(1,"div",28)(2,"span",29),t.EFF(3,"Loading..."),t.k0s()()())}function v(a,r){if(1&a&&(t.j41(0,"div",30),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.SpI(" ",e.error," ")}}function C(a,r){if(1&a){const e=t.RV6();t.j41(0,"tr")(1,"td"),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td",19)(9,"button",31),t.bIt("click",function(){const n=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.deleteHoliday(n._id))}),t.nrm(10,"i",32),t.k0s(),t.j41(11,"button",33),t.bIt("click",function(){const n=t.eBV(e).$implicit,o=t.XpG(),s=t.sdS(40);return t.Njj(o.openModal(s,n))}),t.nrm(12,"i",34),t.k0s()()()}if(2&a){const e=r.$implicit;t.R7$(2),t.JRh(t.i5U(3,3,e.date,"mediumDate")),t.R7$(3),t.JRh(e.title),t.R7$(2),t.JRh(e.description||"-")}}function F(a,r){1&a&&(t.j41(0,"tr")(1,"td",35),t.nrm(2,"i",36),t.j41(3,"p"),t.EFF(4,"No holidays found"),t.k0s()()())}function b(a,r){if(1&a){const e=t.RV6();t.j41(0,"li",38)(1,"a",39),t.bIt("click",function(){const n=t.eBV(e).$implicit,o=t.XpG(2);return t.Njj(o.goToPage(n))}),t.EFF(2),t.k0s()()}if(2&a){const e=r.$implicit,i=t.XpG(2);t.AVh("active",e===i.currentPage),t.R7$(2),t.JRh(e)}}function j(a,r){if(1&a){const e=t.RV6();t.j41(0,"nav")(1,"ul",37)(2,"li",38)(3,"a",39),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.prevPage())}),t.EFF(4,"Previous"),t.k0s()(),t.DNE(5,b,3,3,"li",40),t.j41(6,"li",38)(7,"a",39),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.nextPage())}),t.EFF(8,"Next"),t.k0s()()()()}if(2&a){const e=t.XpG();t.R7$(2),t.AVh("disabled",1===e.currentPage),t.R7$(3),t.Y8G("ngForOf",e.getPageNumbers()),t.R7$(),t.AVh("disabled",e.currentPage===e.totalPages)}}function H(a,r){1&a&&(t.j41(0,"div"),t.EFF(1,"Title is required"),t.k0s())}function k(a,r){1&a&&(t.j41(0,"div"),t.EFF(1,"Title must be less than 100 characters"),t.k0s())}function E(a,r){if(1&a&&(t.j41(0,"div",58),t.DNE(1,H,2,0,"div",21)(2,k,2,0,"div",21),t.k0s()),2&a){let e,i;const n=t.XpG(2);t.R7$(),t.Y8G("ngIf",null==(e=n.holidayForm.get("title"))?null:e.errors.required),t.R7$(),t.Y8G("ngIf",null==(i=n.holidayForm.get("title"))?null:i.errors.maxlength)}}function D(a,r){1&a&&(t.j41(0,"div"),t.EFF(1,"Date is required"),t.k0s())}function T(a,r){if(1&a&&(t.j41(0,"div",58),t.DNE(1,D,2,0,"div",21),t.k0s()),2&a){let e;const i=t.XpG(2);t.R7$(),t.Y8G("ngIf",null==(e=i.holidayForm.get("date"))?null:e.errors.required)}}function I(a,r){1&a&&(t.j41(0,"div"),t.EFF(1,"Description must be less than 500 characters"),t.k0s())}function P(a,r){if(1&a&&(t.j41(0,"div",58),t.DNE(1,I,2,0,"div",21),t.k0s()),2&a){let e;const i=t.XpG(2);t.R7$(),t.Y8G("ngIf",null==(e=i.holidayForm.get("description"))?null:e.errors.maxlength)}}function R(a,r){if(1&a){const e=t.RV6();t.j41(0,"div",41)(1,"h5",42),t.EFF(2),t.k0s(),t.j41(3,"button",43),t.bIt("click",function(){const n=t.eBV(e).$implicit;return t.Njj(n.dismiss())}),t.k0s()(),t.j41(4,"div",44)(5,"form",45),t.bIt("ngSubmit",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveHoliday())}),t.j41(6,"div",46)(7,"label",47),t.EFF(8,"Title "),t.j41(9,"span",48),t.EFF(10,"*"),t.k0s()(),t.nrm(11,"input",49),t.DNE(12,E,3,2,"div",50),t.k0s(),t.j41(13,"div",46)(14,"label",51),t.EFF(15,"Date "),t.j41(16,"span",48),t.EFF(17,"*"),t.k0s()(),t.nrm(18,"input",52),t.DNE(19,T,2,1,"div",50),t.k0s(),t.j41(20,"div",46)(21,"label",53),t.EFF(22,"Description"),t.k0s(),t.nrm(23,"textarea",54),t.DNE(24,P,2,1,"div",50),t.k0s(),t.j41(25,"div",55)(26,"button",56),t.bIt("click",function(){const n=t.eBV(e).$implicit;return t.Njj(n.dismiss())}),t.EFF(27,"Cancel"),t.k0s(),t.j41(28,"button",57),t.EFF(29),t.k0s()()()()}if(2&a){let e,i,n,o,s,l;const d=t.XpG();t.R7$(2),t.JRh(d.isEditing?"Edit Holiday":"Add New Holiday"),t.R7$(3),t.Y8G("formGroup",d.holidayForm),t.R7$(6),t.AVh("is-invalid",(null==(e=d.holidayForm.get("title"))?null:e.invalid)&&(null==(e=d.holidayForm.get("title"))?null:e.touched)),t.R7$(),t.Y8G("ngIf",(null==(i=d.holidayForm.get("title"))?null:i.touched)&&(null==(i=d.holidayForm.get("title"))?null:i.errors)),t.R7$(6),t.AVh("is-invalid",(null==(n=d.holidayForm.get("date"))?null:n.invalid)&&(null==(n=d.holidayForm.get("date"))?null:n.touched)),t.R7$(),t.Y8G("ngIf",(null==(o=d.holidayForm.get("date"))?null:o.touched)&&(null==(o=d.holidayForm.get("date"))?null:o.errors)),t.R7$(4),t.AVh("is-invalid",(null==(s=d.holidayForm.get("description"))?null:s.invalid)&&(null==(s=d.holidayForm.get("description"))?null:s.touched)),t.R7$(),t.Y8G("ngIf",(null==(l=d.holidayForm.get("description"))?null:l.touched)&&(null==(l=d.holidayForm.get("description"))?null:l.errors)),t.R7$(4),t.Y8G("disabled",d.holidayForm.invalid||d.loading),t.R7$(),t.SpI(" ",d.isEditing?"Update":"Add"," Holiday ")}}function M(a,r){if(1&a&&(t.j41(0,"div",59)(1,"div",60)(2,"h6",61),t.EFF(3),t.k0s(),t.j41(4,"small"),t.EFF(5),t.k0s()(),t.j41(6,"p",61)(7,"small"),t.EFF(8),t.nI1(9,"date"),t.k0s()(),t.j41(10,"small",62),t.EFF(11),t.k0s()()),2&a){const e=r.$implicit,i=t.XpG();t.R7$(3),t.JRh(e.title),t.R7$(2),t.SpI("",i.daysUntil(e.date)," days"),t.R7$(3),t.JRh(t.i5U(9,4,e.date,"mediumDate")),t.R7$(3),t.JRh(e.description||"No description")}}function x(a,r){1&a&&(t.j41(0,"div",63),t.EFF(1," No upcoming holidays "),t.k0s())}let N=(()=>{class a{constructor(e,i,n,o,s,l){this.holidayService=e,this.authService=i,this.fb=n,this.modalService=o,this.toastr=s,this.datePipe=l,this.holidays=[],this.filteredHolidays=[],this.upcomingHolidays=[],this.loading=!1,this.error=null,this.currentPage=1,this.itemsPerPage=10,this.totalItems=0,this.searchTerm="",this.startDate=null,this.endDate=null,this.isEditing=!1,this.selectedHolidayId=null,this.holidayForm=this.fb.group({title:["",[c.k0.required,c.k0.maxLength(100)]],date:["",c.k0.required],description:["",c.k0.maxLength(500)]})}ngOnInit(){this.loadHolidays()}loadHolidays(){this.loading=!0,this.error=null;const e=this.authService.getSchoolId();if(!e)return this.error="School ID not found",this.toastr.error(this.error),void(this.loading=!1);const i={};this.startDate&&(i.startDate=this.startDate),this.endDate&&(i.endDate=this.endDate),this.holidayService.getHolidays(e,i).subscribe({next:n=>{this.holidays=n.map(o=>({...o,date:this.formatDate(new Date(o.date))})),this.filterHolidays(),this.getUpcomingHolidays(),this.loading=!1},error:n=>{this.error="Failed to load holidays. Please try again.",this.toastr.error(this.error),this.loading=!1,console.error(n)}})}filterHolidays(){let e=[...this.holidays];if(this.searchTerm){const i=this.searchTerm.toLowerCase();e=e.filter(n=>n.title.toLowerCase().includes(i)||n.description&&n.description.toLowerCase().includes(i))}this.startDate&&(e=e.filter(i=>i.date>=this.startDate)),this.endDate&&(e=e.filter(i=>i.date<=this.endDate)),this.filteredHolidays=e,e.sort((i,n)=>new Date(i.date).getTime()-new Date(n.date).getTime()),this.totalItems=e.length,this.currentPage=1}getUpcomingHolidays(){const e=this.formatDate(new Date);this.upcomingHolidays=this.holidays.filter(i=>i.date>=e).sort((i,n)=>new Date(i.date).getTime()-new Date(n.date).getTime()).slice(0,5)}daysUntil(e){const i=new Date,o=new Date(e).getTime()-i.getTime();return Math.ceil(o/864e5)}formatDate(e){return this.datePipe.transform(e,"yyyy-MM-dd")||e.toISOString().split("T")[0]}openModal(e,i){i?(this.isEditing=!0,this.selectedHolidayId=i._id,this.holidayForm.patchValue({title:i.title,date:i.date,description:i.description})):(this.isEditing=!1,this.selectedHolidayId=null,this.holidayForm.reset()),this.modalService.open(e,{ariaLabelledBy:"modal-basic-title"})}saveHoliday(){if(this.holidayForm.invalid)return void this.holidayForm.markAllAsTouched();const e=this.authService.getSchoolId();if(!e)return void this.toastr.error("School ID not found");const i={...this.holidayForm.value,schoolId:e};this.loading=!0,(this.isEditing&&this.selectedHolidayId?this.holidayService.updateHoliday(this.selectedHolidayId,i):this.holidayService.addHoliday(i)).subscribe({next:()=>{this.toastr.success(this.isEditing?"Holiday updated successfully":"Holiday added successfully"),this.loadHolidays(),this.modalService.dismissAll(),this.loading=!1},error:o=>{this.error=this.isEditing?"Failed to update holiday":"Failed to add holiday",this.toastr.error(this.error),this.loading=!1,console.error(o)}})}deleteHoliday(e){confirm("Are you sure you want to delete this holiday?")&&(this.loading=!0,this.holidayService.deleteHoliday(e).subscribe({next:()=>{this.toastr.success("Holiday deleted successfully"),this.loadHolidays(),this.loading=!1},error:i=>{this.error="Failed to delete holiday",this.toastr.error(this.error),this.loading=!1,console.error(i)}}))}get paginatedHolidays(){const e=(this.currentPage-1)*this.itemsPerPage;return this.filteredHolidays.slice(e,e+this.itemsPerPage)}get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)}getPageNumbers(){const e=[];for(let i=1;i<=this.totalPages;i++)e.push(i);return e}prevPage(){this.currentPage>1&&this.currentPage--}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}goToPage(e){e>=1&&e<=this.totalPages&&(this.currentPage=e)}static{this.\u0275fac=function(i){return new(i||a)(t.rXU(g._),t.rXU(p.u),t.rXU(c.ok),t.rXU(u.Bq),t.rXU(f.tw),t.rXU(_.vh))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-holiday-calendar"]],features:[t.Jv_([_.vh])],decls:49,vars:10,consts:[["addEditModal",""],[1,"card"],[1,"card-header","bg-primary","text-white","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"btn","btn-light","btn-sm",3,"click"],[1,"fa","fa-plus","me-1"],[1,"card-body"],["class","text-center my-4",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"row","mb-3"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-text"],[1,"fa","fa-calendar"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Search holidays...",1,"form-control",3,"ngModelChange","ngModel"],[1,"table-responsive"],[1,"table","table-striped","table-hover"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card","mt-4"],[1,"card-header","bg-info","text-white"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],["class","list-group-item text-center text-muted",4,"ngIf"],[1,"text-center","my-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["role","alert",1,"alert","alert-danger"],[1,"btn","btn-sm","btn-danger","me-1",3,"click"],[1,"fa","fa-trash"],[1,"btn","btn-sm","btn-info",3,"click"],[1,"fa","fa-edit"],["colspan","4",1,"text-center","text-muted","py-4"],[1,"fa","fa-calendar-times","fa-2x","mb-2"],[1,"pagination","justify-content-end"],[1,"page-item"],["href","javascript:void(0)",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"modal-header","bg-primary","text-white"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","title",1,"form-label"],[1,"text-danger"],["type","text","id","title","formControlName","title",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","date",1,"form-label"],["type","date","id","date","formControlName","date",1,"form-control"],["for","description",1,"form-label"],["id","description","rows","3","formControlName","description",1,"form-control"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"invalid-feedback"],[1,"list-group-item"],[1,"d-flex","w-100","justify-content-between"],[1,"mb-1"],[1,"text-muted"],[1,"list-group-item","text-center","text-muted"]],template:function(i,n){if(1&i){const o=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"h4",3),t.EFF(3,"Holiday Calendar"),t.k0s(),t.j41(4,"button",4),t.bIt("click",function(){t.eBV(o);const l=t.sdS(40);return t.Njj(n.openModal(l))}),t.nrm(5,"i",5),t.EFF(6," Add Holiday "),t.k0s()(),t.j41(7,"div",6),t.DNE(8,y,4,0,"div",7)(9,v,2,1,"div",8),t.j41(10,"div",9)(11,"div",10)(12,"div",11)(13,"span",12),t.nrm(14,"i",13),t.k0s(),t.j41(15,"input",14),t.mxI("ngModelChange",function(l){return t.eBV(o),t.DH7(n.startDate,l)||(n.startDate=l),t.Njj(l)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.filterHolidays())}),t.k0s()()(),t.j41(16,"div",10)(17,"div",11)(18,"span",12),t.nrm(19,"i",13),t.k0s(),t.j41(20,"input",14),t.mxI("ngModelChange",function(l){return t.eBV(o),t.DH7(n.endDate,l)||(n.endDate=l),t.Njj(l)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.filterHolidays())}),t.k0s()()(),t.j41(21,"div",10)(22,"input",15),t.mxI("ngModelChange",function(l){return t.eBV(o),t.DH7(n.searchTerm,l)||(n.searchTerm=l),t.Njj(l)}),t.bIt("ngModelChange",function(){return t.eBV(o),t.Njj(n.filterHolidays())}),t.k0s()()(),t.j41(23,"div",16)(24,"table",17)(25,"thead",18)(26,"tr")(27,"th"),t.EFF(28,"Date"),t.k0s(),t.j41(29,"th"),t.EFF(30,"Title"),t.k0s(),t.j41(31,"th"),t.EFF(32,"Description"),t.k0s(),t.j41(33,"th",19),t.EFF(34,"Actions"),t.k0s()()(),t.j41(35,"tbody"),t.DNE(36,C,13,6,"tr",20)(37,F,5,0,"tr",21),t.k0s()()(),t.DNE(38,j,9,5,"nav",21),t.k0s()(),t.DNE(39,R,30,13,"ng-template",null,0,t.C5r),t.j41(41,"div",22)(42,"div",23)(43,"h5",3),t.EFF(44,"Upcoming Holidays"),t.k0s()(),t.j41(45,"div",6)(46,"div",24),t.DNE(47,M,12,7,"div",25)(48,x,2,0,"div",26),t.k0s()()()}2&i&&(t.R7$(8),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("ngIf",n.error&&!n.loading),t.R7$(6),t.R50("ngModel",n.startDate),t.R7$(5),t.R50("ngModel",n.endDate),t.R7$(2),t.R50("ngModel",n.searchTerm),t.R7$(14),t.Y8G("ngForOf",n.paginatedHolidays),t.R7$(),t.Y8G("ngIf",0===n.filteredHolidays.length&&!n.loading),t.R7$(),t.Y8G("ngIf",n.filteredHolidays.length>0),t.R7$(9),t.Y8G("ngForOf",n.upcomingHolidays),t.R7$(),t.Y8G("ngIf",0===n.upcomingHolidays.length))},dependencies:[_.MD,_.Sq,_.bT,_.vh,c.X1,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.YN,c.vS],styles:[".card-header[_ngcontent-%COMP%]{padding:1rem 1.25rem}.list-group-item[_ngcontent-%COMP%]{transition:all .2s}.list-group-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;transform:translateY(-2px);box-shadow:0 2px 5px #0000001a}.modal-header[_ngcontent-%COMP%]{padding:1rem 1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:500}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600}.pagination[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{cursor:pointer}.upcoming-holiday-badge[_ngcontent-%COMP%]{background-color:#e9f7ef;color:#28a745;padding:.25rem .5rem;border-radius:.25rem;font-size:.85rem}"]})}}return a})()}}]);