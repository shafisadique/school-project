"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[6005],{6005:(I,b,l)=>{l.r(b),l.d(b,{AssignmentCreateComponent:()=>T});var h=l(177),o=l(9417),v=l(8359),e=l(4438),p=l(5794),F=l(6561),t=l(2867),r=l(3891),d=l(998);const u=["fileInput"];function C(a,g){1&a&&(e.j41(0,"div",8)(1,"div",9)(2,"span",10),e.EFF(3,"Loading..."),e.k0s()()())}function f(a,g){1&a&&(e.j41(0,"div",34),e.EFF(1," Title is required (max 100 characters) "),e.k0s())}function j(a,g){1&a&&(e.j41(0,"div",34),e.EFF(1," Please select a valid future date "),e.k0s())}function E(a,g){1&a&&(e.j41(0,"div",34),e.EFF(1," Description is required (max 500 characters) "),e.k0s())}function x(a,g){if(1&a&&(e.j41(0,"option",35),e.EFF(1),e.k0s()),2&a){const s=g.$implicit;e.Y8G("value",s._id),e.R7$(),e.JRh(s.name)}}function O(a,g){1&a&&(e.j41(0,"div",34),e.EFF(1," Class is required "),e.k0s())}function A(a,g){if(1&a&&(e.j41(0,"option",35),e.EFF(1),e.k0s()),2&a){const s=g.$implicit;e.Y8G("value",s._id),e.R7$(),e.JRh(s.name)}}function S(a,g){1&a&&(e.j41(0,"div",34),e.EFF(1," Subject is required "),e.k0s())}function M(a,g){if(1&a&&(e.j41(0,"option",35),e.EFF(1),e.k0s()),2&a){const s=g.$implicit;e.Y8G("value",s._id),e.R7$(),e.Lme(" ",s.name," - ",s.admissionNo," ")}}function P(a,g){if(1&a){const s=e.RV6();e.j41(0,"li"),e.EFF(1),e.j41(2,"button",40),e.bIt("click",function(){const n=e.eBV(s).index,m=e.XpG(3);return e.Njj(m.removeFile(n))}),e.EFF(3,"Remove"),e.k0s()()}if(2&a){const s=g.$implicit;e.R7$(),e.SpI(" ",s.name," ")}}function D(a,g){if(1&a&&(e.j41(0,"div",36)(1,"div",37)(2,"strong"),e.EFF(3,"Selected Files:"),e.k0s(),e.j41(4,"ul",38),e.DNE(5,P,4,1,"li",39),e.k0s()()()),2&a){const s=e.XpG(2);e.R7$(5),e.Y8G("ngForOf",s.fileList)}}function $(a,g){1&a&&e.nrm(0,"span",41)}function k(a,g){if(1&a){const s=e.RV6();e.j41(0,"div",11)(1,"form",12),e.bIt("ngSubmit",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.handleUpload())}),e.j41(2,"fieldset",13)(3,"legend"),e.EFF(4,"Assignment Details"),e.k0s(),e.j41(5,"div",14)(6,"div",15)(7,"label",16),e.EFF(8,"Title "),e.j41(9,"span",17),e.EFF(10,"*"),e.k0s()(),e.nrm(11,"input",18),e.DNE(12,f,2,0,"div",19),e.k0s(),e.j41(13,"div",15)(14,"label",16),e.EFF(15,"Due Date "),e.j41(16,"span",17),e.EFF(17,"*"),e.k0s()(),e.nrm(18,"input",20),e.DNE(19,j,2,0,"div",19),e.k0s(),e.j41(20,"div",21)(21,"label",16),e.EFF(22,"Description "),e.j41(23,"span",17),e.EFF(24,"*"),e.k0s()(),e.nrm(25,"textarea",22),e.DNE(26,E,2,0,"div",19),e.k0s()()(),e.j41(27,"fieldset",13)(28,"legend"),e.EFF(29,"Class & Subject"),e.k0s(),e.j41(30,"div",14)(31,"div",15)(32,"label",16),e.EFF(33,"Class "),e.j41(34,"span",17),e.EFF(35,"*"),e.k0s()(),e.j41(36,"select",23),e.bIt("change",function(){e.eBV(s);const n=e.XpG();return e.Njj(n.onClassChange())}),e.j41(37,"option",24),e.EFF(38,"Select Class"),e.k0s(),e.DNE(39,x,2,2,"option",25),e.k0s(),e.DNE(40,O,2,0,"div",19),e.k0s(),e.j41(41,"div",15)(42,"label",16),e.EFF(43,"Subject "),e.j41(44,"span",17),e.EFF(45,"*"),e.k0s()(),e.j41(46,"select",26)(47,"option",24),e.EFF(48,"Select Subject"),e.k0s(),e.DNE(49,A,2,2,"option",25),e.k0s(),e.DNE(50,S,2,0,"div",19),e.k0s()()(),e.j41(51,"fieldset",13)(52,"legend"),e.EFF(53,"Assign To"),e.k0s(),e.j41(54,"div",14)(55,"div",21)(56,"label",16),e.EFF(57,"Students (Optional)"),e.k0s(),e.j41(58,"select",27),e.DNE(59,M,2,3,"option",25),e.k0s(),e.j41(60,"small",28),e.EFF(61,"Leave empty to assign to all students in class"),e.k0s()()()(),e.j41(62,"fieldset",13)(63,"legend"),e.EFF(64,"Attachments (Optional)"),e.k0s(),e.j41(65,"div",14)(66,"div",21)(67,"input",29,0),e.bIt("change",function(n){e.eBV(s);const m=e.XpG();return e.Njj(m.onFileChange(n))}),e.k0s(),e.DNE(69,D,6,1,"div",30),e.k0s()()(),e.j41(70,"div",31)(71,"button",32),e.DNE(72,$,1,0,"span",33),e.EFF(73),e.k0s()()()()}if(2&a){let s,i,n,m,_;const c=e.XpG();e.R7$(),e.Y8G("formGroup",c.assignmentForm),e.R7$(11),e.Y8G("ngIf",(null==(s=c.assignmentForm.get("title"))?null:s.invalid)&&(null==(s=c.assignmentForm.get("title"))?null:s.touched)),e.R7$(6),e.Y8G("min",c.today),e.R7$(),e.Y8G("ngIf",(null==(i=c.assignmentForm.get("dueDate"))?null:i.invalid)&&(null==(i=c.assignmentForm.get("dueDate"))?null:i.touched)),e.R7$(7),e.Y8G("ngIf",(null==(n=c.assignmentForm.get("description"))?null:n.invalid)&&(null==(n=c.assignmentForm.get("description"))?null:n.touched)),e.R7$(13),e.Y8G("ngForOf",c.classes),e.R7$(),e.Y8G("ngIf",(null==(m=c.assignmentForm.get("classId"))?null:m.invalid)&&(null==(m=c.assignmentForm.get("classId"))?null:m.touched)),e.R7$(9),e.Y8G("ngForOf",c.selectedSubjects),e.R7$(),e.Y8G("ngIf",(null==(_=c.assignmentForm.get("subjectId"))?null:_.invalid)&&(null==(_=c.assignmentForm.get("subjectId"))?null:_.touched)),e.R7$(9),e.Y8G("ngForOf",c.students),e.R7$(10),e.Y8G("ngIf",c.fileList.length>0),e.R7$(2),e.Y8G("disabled",c.assignmentForm.invalid||c.isLoading),e.R7$(),e.Y8G("ngIf",c.isLoading),e.R7$(),e.SpI(" ",c.isLoading?"Creating Assignment...":"Create Assignment"," ")}}let T=(()=>{class a{constructor(s,i,n,m,_,c){this.fb=s,this.toasterService=i,this.authService=n,this.assignmentService=m,this.classSubjectService=_,this.studentService=c,this.fileList=[],this.classes=[],this.students=[],this.selectedClassId=null,this.isLoading=!1,this.selectedSubjects=[],this.today=(new Date).toISOString().split("T")[0],this.subscriptions=new v.yU,this.assignments=[],this.assignmentForm=this.fb.group({title:["",[o.k0.required,o.k0.maxLength(100)]],description:["",[o.k0.required,o.k0.maxLength(500)]],dueDate:[null,[o.k0.required]],classId:[null,[o.k0.required]],subjectId:[null,[o.k0.required]],assignedTo:[[]]})}ngOnInit(){const s=this.authService.getSchoolId(),i=this.authService.getActiveAcademicYearId(),n=localStorage.getItem("teacherId");console.log("Init - schoolId:",s,"academicYearId:",i,"teacherId:",n),s&&i&&n?this.loadClassesAndSubjects(n,i):this.toasterService.error("Missing school, year, or teacher info. Check your login!")}ngOnDestroy(){this.subscriptions.unsubscribe()}loadClassesAndSubjects(s,i){this.isLoading=!0,this.subscriptions.add(this.classSubjectService.getAssignmentsByTeacher(s,i).subscribe({next:n=>{console.log("Assignments response:",n),this.assignments=Array.isArray(n)?n:[],this.classes=this.extractUniqueClasses(this.assignments),this.selectedSubjects=this.extractUniqueSubjects(this.assignments),console.log("Extracted classes:",this.classes),console.log("Extracted subjects:",this.selectedSubjects),this.isLoading=!1,0===this.classes.length&&this.toasterService.warning("No classes assigned to you. Check your assignments."),0===this.selectedSubjects.length&&this.toasterService.warning("No subjects assigned to you. Check your assignments.")},error:n=>{this.toasterService.error("Failed to load your classes or subjects. Try again! Error:",n.message),console.error("Error details:",n),this.isLoading=!1}}))}extractUniqueClasses(s){const i=new Map;return s.forEach(n=>{console.log("Processing class item:",n.classId),n.classId&&n.classId._id&&n.classId.name&&!i.has(n.classId._id)?i.set(n.classId._id,{_id:n.classId._id,name:n.classId.name}):console.warn("Invalid class data:",n)}),Array.from(i.values())}extractUniqueSubjects(s){const i=new Map;return s.forEach(n=>{console.log("Processing subject item:",n.subjectId),n.subjectId&&n.subjectId._id&&n.subjectId.name&&!i.has(n.subjectId._id)?i.set(n.subjectId._id,{_id:n.subjectId._id,name:n.subjectId.name}):console.warn("Invalid subject data:",n)}),Array.from(i.values())}onClassChange(){const s=this.assignmentForm.get("classId")?.value;if(s){this.selectedClassId=s;const i=this.authService.getActiveAcademicYearId();i?(this.loadStudents(s,i),this.updateSubjectsForSelectedClass()):this.toasterService.error("Academic year not found.")}else this.students=[],this.assignmentForm.get("assignedTo")?.setValue([]),this.selectedSubjects=[],this.assignmentForm.get("subjectId")?.setValue(null)}updateSubjectsForSelectedClass(){const s=this.assignmentForm.get("classId")?.value;s&&this.assignments&&(this.selectedSubjects=[...new Map(this.assignments.filter(i=>i.classId._id===s).map(i=>[i.subjectId._id,{_id:i.subjectId._id,name:i.subjectId.name}])).values()],console.log("Filtered subjects for class",s,":",this.selectedSubjects),this.assignmentForm.get("subjectId")?.setValue(this.selectedSubjects.length>0?this.selectedSubjects[0]._id:null))}loadStudents(s,i){this.subscriptions.add(this.studentService.getStudentsByClass(s,i).subscribe({next:n=>{this.students=n.students||[],0===this.students.length&&this.toasterService.warning("No students in this class.")},error:n=>{this.toasterService.error("Failed to load students. Try again!"),console.error("Error:",n)}}))}onFileChange(s){const i=s.target;i.files&&(this.fileList=Array.from(i.files)),this.fileInput.nativeElement.value=""}removeFile(s){this.fileList.splice(s,1)}handleUpload(){if(this.assignmentForm.invalid)return void this.toasterService.warning("Please fill all required fields correctly!");this.isLoading=!0;const s=this.assignmentForm.value,i=this.fileList,n=localStorage.getItem("teacherId")||"";let m=new Date(s.dueDate);if(isNaN(m.getTime()))return this.toasterService.error("Invalid due date. Please select a valid date."),void(this.isLoading=!1);this.subscriptions.add(this.assignmentService.createAssignment({title:s.title,description:s.description,dueDate:m.toISOString(),classId:s.classId,subjectId:s.subjectId,assignedTo:s.assignedTo},i,n).subscribe({next:_=>{this.toasterService.success("Assignment created! \u{1f389}"),this.resetForm()},error:_=>{this.toasterService.error("Oops! Couldn\u2019t create assignment. "+(_.error?.message||"")),console.error("Error creating assignment:",_)}}).add(()=>{this.isLoading=!1}))}resetForm(){this.assignmentForm.reset({title:"",description:"",dueDate:null,classId:null,subjectId:null,assignedTo:[]}),this.fileList=[],this.students=[],this.selectedClassId=null,this.selectedSubjects=[]}static{this.\u0275fac=function(i){return new(i||a)(e.rXU(o.ok),e.rXU(p.tw),e.rXU(F.u),e.rXU(t.h),e.rXU(r.e),e.rXU(d.b))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-assignment-create"]],viewQuery:function(i,n){if(1&i&&e.GBs(u,5),2&i){let m;e.mGM(m=e.lsd())&&(n.fileInput=m.first)}},decls:9,vars:2,consts:[["fileInput",""],[1,"assignment-create-container"],[1,"header-section"],[1,"header-card"],[1,"title"],[1,"subtitle"],["class","text-center py-5",4,"ngIf"],["class","controls-card",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary","spinner-large"],[1,"visually-hidden"],[1,"controls-card"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","title","placeholder","e.g. Math Worksheet Chapter 5",1,"form-control","form-control-lg"],["class","text-danger small mt-1",4,"ngIf"],["type","date","formControlName","dueDate",1,"form-control","form-control-lg",3,"min"],[1,"col-12"],["rows","4","formControlName","description","placeholder","Explain what students need to do...",1,"form-control"],["formControlName","classId",1,"form-select","form-select-lg",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","subjectId",1,"form-select","form-select-lg"],["formControlName","assignedTo","multiple","","size","6",1,"form-select","form-select-lg"],[1,"text-muted"],["type","file","multiple","","accept",".pdf,.doc,.docx,.png,.jpg,.jpeg",1,"form-control","form-control-lg",3,"change"],["class","mt-3",4,"ngIf"],[1,"d-flex","justify-content-end","mt-4"],["type","submit",1,"btn-material","btn-primary","btn-lg",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"text-danger","small","mt-1"],[3,"value"],[1,"mt-3"],[1,"alert","alert-info"],[1,"mb-0","mt-2"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-sm","btn-danger","ms-2",3,"click"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,n){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),e.EFF(4,"Create Assignment"),e.k0s(),e.j41(5,"p",5),e.EFF(6,"Assign homework, worksheets, or projects to your students"),e.k0s()()(),e.DNE(7,C,4,0,"div",6)(8,k,74,14,"div",7),e.k0s()),2&i&&(e.R7$(7),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading))},dependencies:[h.MD,h.Sq,h.bT,o.X1,o.qT,o.xH,o.y7,o.me,o.wz,o.W0,o.BC,o.cb,o.j4,o.JD],styles:[".assignment-create-container[_ngcontent-%COMP%]{padding:16px;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;font-family:Poppins,sans-serif}.assignment-create-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]{margin-bottom:24px}.assignment-create-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]{background:#fffffff7;border-radius:20px;padding:32px;text-align:center;box-shadow:0 10px 30px #0000001a;-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px)}.assignment-create-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:2.2rem;font-weight:700;background:linear-gradient(135deg,#4a90e2,#50c9c3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0}.assignment-create-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#64748b;font-size:1.1rem;margin-top:10px}.assignment-create-container[_ngcontent-%COMP%]   .controls-card[_ngcontent-%COMP%]{background:#fff;border-radius:24px;padding:32px;box-shadow:0 15px 40px #0000001f;border:1px solid #e2e8f0}.assignment-create-container[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{border:1.5px solid #e2e8f0;border-radius:16px;padding:24px;margin-bottom:28px;background:#fafbfe}.assignment-create-container[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:1rem;font-weight:600;padding:10px 20px;border-radius:12px;width:auto;float:none;margin-bottom:16px}.assignment-create-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .assignment-create-container[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{border-radius:14px;padding:14px 16px;font-size:1rem;border:2px solid #cbd5e0}.assignment-create-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus, .assignment-create-container[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus{border-color:#4a90e2;box-shadow:0 0 0 4px #4a90e233}.assignment-create-container[_ngcontent-%COMP%]   .btn-material[_ngcontent-%COMP%]{border-radius:30px;padding:16px 32px;font-weight:600;background:linear-gradient(135deg,#4a90e2,#50c9c3);border:none;box-shadow:0 8px 25px #4a90e266}.assignment-create-container[_ngcontent-%COMP%]   .btn-material[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-4px);box-shadow:0 12px 35px #4a90e280}"]})}}return a})()},2867:(I,b,l)=>{l.d(b,{h:()=>e});var h=l(2525),o=l(4438),v=l(1626);let e=(()=>{class p{constructor(t){this.http=t,this.apiUrl=h.c.apiUrl}createAssignment(t,r,d){const u=new FormData;u.append("title",t.title||""),u.append("description",t.description||""),u.append("dueDate",t.dueDate||""),u.append("classId",t.classId||""),u.append("subjectId",t.subjectId||""),t.assignedTo&&Array.isArray(t.assignedTo)&&t.assignedTo.forEach((f,j)=>{u.append(`assignedTo[${j}]`,f)}),r&&Array.isArray(r)&&r.forEach(f=>{u.append("attachments",f)});const C=`${this.apiUrl}/api/assignments/create?teacherId=${encodeURIComponent(d||"")}`;return console.log(C),this.http.post(C,u)}logManualSubmission(t,r){return this.http.post(`${this.apiUrl}/api/assignments/${t}/log-submission`,{studentId:r})}gradeAssignment(t,r,d,u,C){return this.http.put(`${this.apiUrl}/api/assignments/${t}/grade`,{studentId:r,grade:d,comments:u})}bulkGradeAssignment(t,r){return this.http.put(`${this.apiUrl}/api/assignments/${t}/bulk-grade`,{grades:r})}getTeacherAssignments(t){return this.http.get(`${this.apiUrl}/api/assignments/teacher/${t}`)}getAssignmentDetails(t){return this.http.get(`${this.apiUrl}/api/assignments/${t}/details`)}getStudentAssignments(){return this.http.get(`${this.apiUrl}/api/assignments/student`)}getStudentAssignmentDetails(t){return this.http.get(`${this.apiUrl}/api/assignments/my-assignment/${t}`)}static{this.\u0275fac=function(r){return new(r||p)(o.KVO(v.Qq))}}static{this.\u0275prov=o.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},3891:(I,b,l)=>{l.d(b,{e:()=>e});var h=l(1626),o=l(2525),v=l(4438);let e=(()=>{class p{constructor(t){this.http=t,this.apiUrl=o.c.apiUrl}getClassesBySchool(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${t}`)}getStudentsByClass(t,r){const d=`${this.apiUrl}/api/students/get-student-by-class/${t}`,u=(new h.Nl).set("academicYearId",r);return this.http.get(d,{params:u})}assignRollNumbers(t){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${t}`,{})}assignRollNumbersAlphabetically(t){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${t}`,{})}assignRollNumberToStudent(t,r){return this.http.put(`${this.apiUrl}/api/students/${t}/assign-roll-number`,{rollNo:r})}createClass(t){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,t)}deleteAssignment(t){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:t})}createSubject(t){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,t)}getSubjects(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${t}`)}getTeachers(t){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${t}`)}getCombinedAssignments(t,r){const d=(new h.Nl).set("academicYearId",r);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${t}`,{params:d})}assignSubjectToClass(t,r,d,u){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:t,subjectId:r,teacherId:d,academicYearId:u})}updateAssignment(t){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,t)}getAssignmentsByTeacher(t,r,d){let u=(new h.Nl).set("academicYearId",r);return d&&(u=u.set("date",d)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${t}`,{params:u})}updateAttendanceTeachers(t,r,d){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:t,attendanceTeacher:r,substituteAttendanceTeachers:d})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(r){return new(r||p)(v.KVO(h.Qq))}}static{this.\u0275prov=v.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()}}]);