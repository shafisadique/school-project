"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[3158],{965:(h,_,s)=>{s.d(_,{y:()=>d});var e=s(2525),m=s(4438),g=s(1626);let d=(()=>{class p{constructor(a){this.http=a,this.baseUrl=`${e.c.apiUrl}/api/academicyear`}createAcademicYear(a){return this.http.post(`${this.baseUrl}/create`,a)}editAcademicYear(a){return this.http.put(`${this.baseUrl}/edit`,a)}getActiveAcademicYear(a){return this.http.get(`${this.baseUrl}/active/${a}`)}getAllAcademicYears(a){return this.http.get(`${this.baseUrl}/${a}`)}activateAcademicYear(a,l){return this.http.post(`${this.baseUrl}/activate/${l}`,{academicYearId:a})}setActiveAcademicYear(a,l){return this.http.post(`${this.baseUrl}/set`,{schoolId:a,academicYearId:l})}getNextAcademicYear(a,l){return this.http.get(`${this.baseUrl}/next/${a}?schoolId=${l}`)}static{this.\u0275fac=function(l){return new(l||p)(m.KVO(g.Qq))}}static{this.\u0275prov=m.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},3158:(h,_,s)=>{s.r(_),s.d(_,{AcademicYearComponent:()=>P});var e=s(4438),m=s(9079),g=s(177),d=s(9417),p=s(5794),b=s(6561),a=s(965);function l(i,f){if(1&i){const t=e.RV6();e.j41(0,"button",32),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.cancelEdit())}),e.nrm(1,"i",33),e.EFF(2," Cancel "),e.k0s()}}function M(i,f){if(1&i&&(e.j41(0,"div",34)(1,"div",35),e.nrm(2,"i",36),e.EFF(3," Current Active Session "),e.k0s(),e.j41(4,"div",37)(5,"h3",38),e.EFF(6),e.k0s(),e.j41(7,"p",39),e.nrm(8,"i",40),e.EFF(9),e.nI1(10,"date"),e.nI1(11,"date"),e.k0s()()()),2&i){const t=e.XpG();e.R7$(6),e.JRh(t.currentAcademicYear.name),e.R7$(3),e.Lme(" ",e.i5U(10,3,t.currentAcademicYear.startDate,"mediumDate")," \u2192 ",e.i5U(11,6,t.currentAcademicYear.endDate,"mediumDate")," ")}}function C(i,f){1&i&&(e.j41(0,"div",41),e.nrm(1,"i",42),e.j41(2,"p"),e.EFF(3,"No active academic session"),e.k0s()())}function O(i,f){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td",43),e.EFF(2),e.k0s(),e.j41(3,"td")(4,"span",44),e.EFF(5),e.nI1(6,"date"),e.nI1(7,"date"),e.k0s()(),e.j41(8,"td")(9,"span",45),e.EFF(10),e.k0s()(),e.j41(11,"td",29)(12,"div",46)(13,"button",47),e.bIt("click",function(){const n=e.eBV(t).$implicit,c=e.XpG();return e.Njj(c.activateYear(n._id))}),e.nrm(14,"i",48),e.k0s(),e.j41(15,"button",49),e.bIt("click",function(){const n=e.eBV(t).$implicit,c=e.XpG();return e.Njj(c.editYear(n))}),e.nrm(16,"i",50),e.k0s()()()()}if(2&i){const t=f.$implicit,r=e.XpG();e.R7$(2),e.JRh(t.name),e.R7$(3),e.Lme(" ",e.i5U(6,6,t.startDate,"dd MMM yyyy")," - ",e.i5U(7,9,t.endDate,"dd MMM yyyy")," "),e.R7$(4),e.Y8G("ngClass",t._id===(null==r.currentAcademicYear?null:r.currentAcademicYear._id)?"badge-success":"badge-secondary"),e.R7$(),e.SpI(" ",t._id===(null==r.currentAcademicYear?null:r.currentAcademicYear._id)?"Active":"Inactive"," "),e.R7$(3),e.Y8G("disabled",t._id===(null==r.currentAcademicYear?null:r.currentAcademicYear._id))}}function Y(i,f){1&i&&(e.j41(0,"tr")(1,"td",51),e.nrm(2,"i",52),e.j41(3,"p"),e.EFF(4,"No academic sessions created yet"),e.k0s()()())}let P=(()=>{class i{constructor(){this.destroyRef=(0,e.WQX)(e.abz),this.authService=(0,e.WQX)(b.u),this.academicYearService=(0,e.WQX)(a.y),this.toastr=(0,e.WQX)(p.tw),this.newAcademicYear={academicYearId:"",name:"",startDate:"",endDate:""},this.isEditMode=!1,this.loading=!1,this.availableYears=[],this.currentAcademicYear=null,this.schoolId=null}ngOnInit(){this.schoolId=this.authService.currentSchoolId(),this.schoolId?this.loadAcademicYears():this.toastr.error("School session expired. Please login again.","Error")}loadAcademicYears(){this.schoolId&&(this.academicYearService.getActiveAcademicYear(this.schoolId).pipe((0,m.pQ)(this.destroyRef)).subscribe({next:t=>this.currentAcademicYear=t,error:()=>this.toastr.error("Failed to load active session")}),this.academicYearService.getAllAcademicYears(this.schoolId).pipe((0,m.pQ)(this.destroyRef)).subscribe({next:t=>this.availableYears=t,error:()=>this.toastr.error("Failed to load academic sessions")}))}createAcademicYear(){if(this.loading)return;const{name:t,startDate:r,endDate:n}=this.newAcademicYear;if(!t?.trim()||!r||!n)return void this.toastr.warning("Please fill all fields");if(new Date(r)>=new Date(n))return void this.toastr.error("End date must be after start date");this.loading=!0;const c={name:t.trim(),startDate:new Date(r).toISOString(),endDate:new Date(n).toISOString()};(this.isEditMode?this.academicYearService.editAcademicYear({...c,academicYearId:this.newAcademicYear.academicYearId}):this.academicYearService.createAcademicYear(c)).pipe((0,m.pQ)(this.destroyRef)).subscribe({next:()=>{this.toastr.success(this.isEditMode?"Session updated!":"Session created!"),this.resetForm(),this.loadAcademicYears()},error:o=>{this.loading=!1,this.toastr.error(o.error?.message||"Operation failed. Please try again.")},complete:()=>this.loading=!1})}editYear(t){this.newAcademicYear={academicYearId:t._id,name:t.name,startDate:t.startDate.split("T")[0],endDate:t.endDate.split("T")[0]},this.isEditMode=!0}cancelEdit(){this.resetForm()}resetForm(){this.newAcademicYear={academicYearId:"",name:"",startDate:"",endDate:""},this.isEditMode=!1,this.loading=!1}activateYear(t){!this.schoolId||t===this.currentAcademicYear?._id||this.academicYearService.activateAcademicYear(t,this.schoolId).pipe((0,m.pQ)(this.destroyRef)).subscribe({next:()=>{this.toastr.success("Active session updated!"),this.loadAcademicYears()},error:()=>this.toastr.error("Failed to activate session")})}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-academic-year"]],decls:63,vars:10,consts:[["noActiveSession",""],[1,"container-fluid","py-3","py-md-4"],[1,"row","justify-content-center"],[1,"col-12","col-lg-11","col-xl-11"],[1,"header-section","mb-4"],[1,"header-card"],[1,"title"],[1,"subtitle"],[1,"form-section"],[1,"form-card"],[1,"fas","fa-calendar-plus","me-2"],[1,"row","g-3",3,"ngSubmit"],[1,"col-12","col-md-4"],[1,"form-label"],[1,"text-danger"],["type","text","name","name","placeholder","e.g., 2025-2026","required","",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","date","name","startDate","required","",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],["type","date","name","endDate","required","",1,"form-control","form-control-sm",3,"ngModelChange","ngModel"],[1,"col-12","mt-4"],["type","submit",1,"btn-material","btn-success","me-2"],[1,"fas","fa-save","me-2"],["type","button","class","btn-material btn-secondary",3,"click",4,"ngIf"],["class","current-session-card mb-4",4,"ngIf","ngIfElse"],[1,"table-section"],[1,"table-card"],[1,"table-header"],[1,"fas","fa-list-alt","me-2"],[1,"table-responsive"],[1,"table","table-striped","table-hover","professional-table"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],["type","button",1,"btn-material","btn-secondary",3,"click"],[1,"fas","fa-times","me-2"],[1,"current-session-card","mb-4"],[1,"current-session-header"],[1,"fas","fa-check-circle"],[1,"current-session-body"],[1,"session-name"],[1,"session-dates"],[1,"fas","fa-calendar-alt","me-2"],[1,"alert","alert-info","text-center","mb-4"],[1,"fas","fa-info-circle","fa-2x","mb-3"],[1,"fw-bold"],[1,"text-muted","small"],[1,"badge",3,"ngClass"],[1,"btn-group","btn-group-sm"],["title","Set as Active",1,"btn","btn-outline-success","btn-sm",3,"click","disabled"],[1,"fas","fa-check"],["title","Edit Session",1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"fas","fa-edit"],["colspan","4",1,"text-center","py-5","text-muted"],[1,"fas","fa-calendar-times","fa-3x","mb-3"]],template:function(r,n){if(1&r){const c=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h1",6),e.EFF(6,"Academic Session Management"),e.k0s(),e.j41(7,"p",7),e.EFF(8,"Create and manage academic years for your school"),e.k0s()()(),e.j41(9,"div",8)(10,"div",9)(11,"fieldset")(12,"legend"),e.nrm(13,"i",10),e.EFF(14),e.k0s(),e.j41(15,"form",11),e.bIt("ngSubmit",function(){return e.eBV(c),e.Njj(n.createAcademicYear())}),e.j41(16,"div",12)(17,"label",13),e.EFF(18,"Session Name "),e.j41(19,"span",14),e.EFF(20,"*"),e.k0s()(),e.j41(21,"input",15),e.mxI("ngModelChange",function(o){return e.eBV(c),e.DH7(n.newAcademicYear.name,o)||(n.newAcademicYear.name=o),e.Njj(o)}),e.k0s()(),e.j41(22,"div",12)(23,"label",13),e.EFF(24,"Start Date "),e.j41(25,"span",14),e.EFF(26,"*"),e.k0s()(),e.j41(27,"input",16),e.mxI("ngModelChange",function(o){return e.eBV(c),e.DH7(n.newAcademicYear.startDate,o)||(n.newAcademicYear.startDate=o),e.Njj(o)}),e.k0s()(),e.j41(28,"div",12)(29,"label",13),e.EFF(30,"End Date "),e.j41(31,"span",14),e.EFF(32,"*"),e.k0s()(),e.j41(33,"input",17),e.mxI("ngModelChange",function(o){return e.eBV(c),e.DH7(n.newAcademicYear.endDate,o)||(n.newAcademicYear.endDate=o),e.Njj(o)}),e.k0s()(),e.j41(34,"div",18)(35,"button",19),e.nrm(36,"i",20),e.EFF(37),e.k0s(),e.DNE(38,l,3,0,"button",21),e.k0s()()()()(),e.DNE(39,M,12,9,"div",22)(40,C,4,0,"ng-template",null,0,e.C5r),e.j41(42,"div",23)(43,"div",24)(44,"div",25)(45,"h3"),e.nrm(46,"i",26),e.EFF(47," All Academic Sessions"),e.k0s()(),e.j41(48,"div",27)(49,"table",28)(50,"thead")(51,"tr")(52,"th"),e.EFF(53,"Session Name"),e.k0s(),e.j41(54,"th"),e.EFF(55,"Duration"),e.k0s(),e.j41(56,"th"),e.EFF(57,"Status"),e.k0s(),e.j41(58,"th",29),e.EFF(59,"Actions"),e.k0s()()(),e.j41(60,"tbody"),e.DNE(61,O,17,12,"tr",30)(62,Y,5,0,"tr",31),e.k0s()()()()()()()()}if(2&r){const c=e.sdS(41);e.R7$(14),e.SpI(" ",n.isEditMode?"Edit Academic Session":"Create New Academic Session"," "),e.R7$(7),e.R50("ngModel",n.newAcademicYear.name),e.R7$(6),e.R50("ngModel",n.newAcademicYear.startDate),e.R7$(6),e.R50("ngModel",n.newAcademicYear.endDate),e.R7$(4),e.SpI(" ",n.isEditMode?"Update Session":"Create Session"," "),e.R7$(),e.Y8G("ngIf",n.isEditMode),e.R7$(),e.Y8G("ngIf",n.currentAcademicYear)("ngIfElse",c),e.R7$(22),e.Y8G("ngForOf",n.availableYears),e.R7$(),e.Y8G("ngIf",0===n.availableYears.length)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.vh,d.YN,d.qT,d.me,d.BC,d.cb,d.YS,d.vS,d.cV],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap";@import"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css";@charset "UTF-8";.container-fluid[_ngcontent-%COMP%]{padding:16px;font-family:Poppins,sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh}.header-section[_ngcontent-%COMP%]{margin-bottom:24px}.header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]{background:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:12px;padding:28px;box-shadow:0 2px 4px -1px #00000014,0 1px 2px -1px #0000000a;border:1px solid #e5e7eb;text-align:center}.header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.9rem;font-weight:600;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:0 0 8px}.header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#6b7280;margin:0}.form-section[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%], .current-session-card[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%], .current-session-card[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%], .table-section[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%], .table-section[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%]{background:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:12px;box-shadow:0 2px 4px -1px #00000014,0 1px 2px -1px #0000000a;border:1px solid #e5e7eb;padding:0 10px 10px;overflow:hidden}.form-section[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:1.05rem;font-weight:600;text-transform:uppercase;letter-spacing:1px;padding:.7rem 1.6rem;border-radius:10px;float:none;width:auto;margin:0 0 1.5rem 1.5rem;box-shadow:0 4px 15px #667eea4d}.current-session-card[_ngcontent-%COMP%]   .current-session-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:1rem 1.5rem;font-weight:600;font-size:1.1rem;display:flex;align-items:center;gap:10px}.current-session-card[_ngcontent-%COMP%]   .current-session-body[_ngcontent-%COMP%]{padding:1.8rem;background:#fff}.current-session-card[_ngcontent-%COMP%]   .current-session-body[_ngcontent-%COMP%]   .session-name[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;color:#1f2937;margin:0 0 8px}.current-session-card[_ngcontent-%COMP%]   .current-session-body[_ngcontent-%COMP%]   .session-dates[_ngcontent-%COMP%]{font-size:1rem;color:#6b7280;margin:0}.table-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;padding:1rem 1.5rem;font-weight:600}.table-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem}.professional-table[_ngcontent-%COMP%]{margin:0;font-size:.92rem}.professional-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:#f8f9fa}.professional-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#4c1d95;padding:14px;font-size:.9rem}.professional-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#667eea0d}.professional-table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:6px 14px;border-radius:20px;font-size:.8rem;font-weight:500}.professional-table[_ngcontent-%COMP%]   .badge.badge-success[_ngcontent-%COMP%]{background:#10b98126;color:#059669;border:1px solid rgba(16,185,129,.3)}.professional-table[_ngcontent-%COMP%]   .badge.badge-secondary[_ngcontent-%COMP%]{background:#6b728026;color:#6b7280;border:1px solid rgba(107,114,128,.3)}.btn-material[_ngcontent-%COMP%]{padding:10px 22px;border:none;border-radius:50px;font-weight:600;font-size:.95rem;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all .3s ease;box-shadow:0 2px 4px -1px #00000014,0 1px 2px -1px #0000000a}.btn-material.btn-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff}.btn-material.btn-success[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #667eea26}.btn-material.btn-secondary[_ngcontent-%COMP%]{background:#95a5a6;color:#fff}@media (max-width: 768px){.container-fluid[_ngcontent-%COMP%]{padding:12px}.header-card[_ngcontent-%COMP%], .form-card[_ngcontent-%COMP%], .table-card[_ngcontent-%COMP%]{padding:16px}legend[_ngcontent-%COMP%]{font-size:.95rem;padding:.6rem 1.2rem;margin-left:0}.current-session-body[_ngcontent-%COMP%]{padding:1.2rem}.session-name[_ngcontent-%COMP%]{font-size:1.4rem}}']})}}return i})()}}]);