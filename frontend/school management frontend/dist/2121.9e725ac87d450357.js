"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[2121],{2121:(k,v,g)=>{g.r(v),g.d(v,{teacherRoutes:()=>pe});var b=g(4249),s=g(9417),h=g(177),m=g(9969),e=g(4438),C=g(2525),_=g(1626);let M=(()=>{class a{constructor(t){this.http=t,this.apiUrl=C.c.apiUrl+"/api/teacher-absences"}getAbsences(t){const{schoolId:o,...n}=t;return this.http.get(`${this.apiUrl}/list/${o}`,{params:n})}addAbsence(t){return this.http.post(`${this.apiUrl}/add`,t)}updateAbsence(t,o){return this.http.put(`${this.apiUrl}/update/${t}`,o)}deleteAbsence(t,o){return this.http.delete(`${this.apiUrl}/delete/${t}`,{body:{schoolId:o}})}checkHoliday(t,o){return this.http.get(`${C.c.apiUrl}/api/holidays/check/${t}`,{params:{date:o}})}getPendingAbsences(t,o,n,r){let i={schoolId:t};return o&&(i.startDate=o),n&&(i.endDate=n),r&&(i.teacherId=r),this.http.get(`${this.apiUrl}/pending-applications`,{params:i})}getPendingAutoAbsences(t,o,n,r){let i={schoolId:t};return o&&(i.startDate=o),n&&(i.endDate=n),r&&(i.teacherId=r),this.http.get(`${this.apiUrl}/pending-auto-absences`,{params:i})}static{this.\u0275fac=function(o){return new(o||a)(e.KVO(_.Qq))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var l=g(7917),p=g(6561),f=g(1375),y=g(5794);function O(a,d){1&a&&(e.j41(0,"div",32),e.nrm(1,"div",33),e.k0s())}function F(a,d){if(1&a&&(e.j41(0,"div",34),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",t.error," ")}}function A(a,d){if(1&a&&(e.j41(0,"div",35)(1,"span"),e.EFF(2),e.k0s()()),2&a){const t=e.XpG();e.R7$(2),e.SpI("Remaining Leave: ",t.leaveBalance," days")}}function w(a,d){1&a&&(e.j41(0,"div",36),e.EFF(1,"Date is required"),e.k0s())}function T(a,d){1&a&&(e.j41(0,"div",36),e.EFF(1,"Reason is required"),e.k0s())}function I(a,d){1&a&&(e.j41(0,"div",36),e.EFF(1,"Reason must be at least 5 characters"),e.k0s())}function j(a,d){1&a&&e.nrm(0,"span",33)}let E=(()=>{class a{constructor(t,o,n,r,i,c,u){this.fb=t,this.teacherAbsenceService=o,this.teacherService=n,this.authService=r,this.schoolService=i,this.toastr=c,this.datePipe=u,this.loading=!1,this.error=null,this.leaveBalance=null,this.userTeacherId=null,this.weeklyHolidayDay="Sunday",this.schoolId=null,this.absenceForm=this.fb.group({date:["",s.k0.required],reason:["",[s.k0.required,s.k0.minLength(5)]]})}ngOnInit(){if(this.userTeacherId=this.authService.getTeacherId(),this.schoolId=this.authService.getSchoolId(),!this.userTeacherId||!this.schoolId)return this.error="Teacher ID or School ID not found",void this.toastr.error(this.error);this.loadLeaveBalance(),this.loadWeeklyHolidayDay()}loadLeaveBalance(){this.teacherService.getTeacherById(this.userTeacherId).subscribe({next:t=>{this.leaveBalance=t.data.leaveBalance||0},error:t=>{this.error="Failed to load leave balance",this.toastr.error(this.error),console.error(t)}})}loadWeeklyHolidayDay(){this.schoolId&&this.schoolService.loadWeeklyHolidayDay(this.schoolId).subscribe({next:t=>{this.weeklyHolidayDay=t},error:t=>{this.error=t.message||"Error loading weekly holiday day",this.toastr.error(this.error)}})}openConfirmModal(){if(this.absenceForm.invalid)return this.absenceForm.markAllAsTouched(),void this.toastr.error("Please fill out all required fields correctly");new Date(this.absenceForm.value.date).toLocaleDateString("en-US",{weekday:"long"})!==this.weeklyHolidayDay?new window.bootstrap.Modal(document.getElementById("confirmLeaveModal")).show():this.toastr.error(`Cannot apply for leave on ${this.weeklyHolidayDay} as it is a weekly holiday`)}submitLeave(){if(!this.schoolId||!this.userTeacherId)return void this.toastr.error("School ID or Teacher ID not found");const t=new Date(this.absenceForm.value.date),o=this.datePipe.transform(t,"yyyy-MM-dd");this.teacherAbsenceService.checkHoliday(this.schoolId,o).subscribe({next:n=>{n.length>0?this.toastr.error("Cannot apply for leave on a holiday"):(this.loading=!0,this.teacherAbsenceService.addAbsence({teacherId:this.userTeacherId,schoolId:this.schoolId,date:t,reason:this.absenceForm.value.reason,substituteTeacherId:null,status:"Pending",isTeacherApplied:!0}).subscribe({next:()=>{this.toastr.success("Leave applied successfully"),this.absenceForm.reset(),this.loading=!1,window.bootstrap.Modal.getInstance(document.getElementById("confirmLeaveModal")).hide()},error:i=>{this.error=i.error?.message||"Failed to apply for leave",this.toastr.error(this.error),this.loading=!1,console.error(i)}}))},error:n=>{this.toastr.error("Failed to check holiday status"),console.error(n)}})}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(s.ok),e.rXU(M),e.rXU(l.O),e.rXU(p.u),e.rXU(f.g),e.rXU(y.tw),e.rXU(h.vh))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-teacher-apply-leave"]],features:[e.Jv_([h.vh])],decls:55,vars:19,consts:[[1,"container-fluid","py-6","bg-gray-50","min-h-screen"],[1,"row","justify-content-center"],[1,"col-12","col-lg-12"],[1,"card","bg-white","shadow-xl","rounded-xl","overflow-hidden"],[1,"card-header","bg-gradient-to-r","from-blue-600","to-blue-800","text-white","p-2"],[1,"text-xl","font-semibold",2,"color","whitesmoke"],[1,"card-body","p-6"],["class","loading-overlay",4,"ngIf"],["class","alert alert-danger mb-4","role","alert",4,"ngIf"],["class","mb-4 text-gray-700",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["for","date",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-danger"],[1,"custom-input-wrapper"],["type","date","id","date","formControlName","date",1,"custom-input"],["class","invalid-feedback",4,"ngIf"],["for","reason",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","reason","formControlName","reason",1,"custom-input"],[1,"text-center"],["type","submit",1,"btn-primary",3,"disabled"],["id","confirmLeaveModal","tabindex","-1","aria-labelledby","confirmLeaveModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","rounded-lg","shadow-lg"],[1,"modal-header","bg-blue-600","text-white"],["id","confirmLeaveModalLabel",1,"modal-title","font-semibold"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],[1,"modal-body","text-gray-700"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn-cancel"],["type","button",1,"btn-confirm",3,"click","disabled"],["class","spinner",4,"ngIf"],[1,"loading-overlay"],[1,"spinner"],["role","alert",1,"alert","alert-danger","mb-4"],[1,"mb-4","text-gray-700"],[1,"invalid-feedback"]],template:function(o,n){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e.EFF(6,"Apply for Leave"),e.k0s()(),e.j41(7,"div",6),e.DNE(8,O,2,0,"div",7)(9,F,2,1,"div",8)(10,A,3,1,"div",9),e.j41(11,"form",10),e.bIt("ngSubmit",function(){return n.openConfirmModal()}),e.j41(12,"div",11)(13,"div")(14,"label",12),e.EFF(15,"Date "),e.j41(16,"span",13),e.EFF(17,"*"),e.k0s()(),e.j41(18,"div",14),e.nrm(19,"input",15),e.DNE(20,w,2,0,"div",16),e.k0s()(),e.j41(21,"div")(22,"label",17),e.EFF(23,"Reason "),e.j41(24,"span",13),e.EFF(25,"*"),e.k0s()(),e.j41(26,"div",14),e.nrm(27,"input",18),e.DNE(28,T,2,0,"div",16)(29,I,2,0,"div",16),e.k0s()()(),e.j41(30,"div",19)(31,"button",20),e.EFF(32,"Apply Leave"),e.k0s()()()()()()(),e.j41(33,"div",21)(34,"div",22)(35,"div",23)(36,"div",24)(37,"h5",25),e.EFF(38,"Confirm Leave Application"),e.k0s(),e.nrm(39,"button",26),e.k0s(),e.j41(40,"div",27),e.EFF(41," Are you sure you want to apply for a leave on "),e.j41(42,"strong"),e.EFF(43),e.nI1(44,"date"),e.k0s(),e.EFF(45," for the reason: "),e.j41(46,"strong"),e.EFF(47),e.k0s(),e.EFF(48,"? "),e.k0s(),e.j41(49,"div",28)(50,"button",29),e.EFF(51,"Cancel"),e.k0s(),e.j41(52,"button",30),e.bIt("click",function(){return n.submitLeave()}),e.DNE(53,j,1,0,"span",31),e.EFF(54," Confirm "),e.k0s()()()()()()),2&o){let r,i,c,u,x;e.R7$(8),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.error),e.R7$(),e.Y8G("ngIf",null!==n.leaveBalance),e.R7$(),e.Y8G("formGroup",n.absenceForm),e.R7$(8),e.AVh("is-invalid",(null==(r=n.absenceForm.get("date"))?null:r.invalid)&&(null==(r=n.absenceForm.get("date"))?null:r.touched)),e.R7$(),e.Y8G("ngIf",null==(i=n.absenceForm.get("date"))||null==i.errors?null:i.errors.required),e.R7$(7),e.AVh("is-invalid",(null==(c=n.absenceForm.get("reason"))?null:c.invalid)&&((null==(c=n.absenceForm.get("reason"))?null:c.touched)||(null==(c=n.absenceForm.get("reason"))?null:c.dirty))),e.R7$(),e.Y8G("ngIf",null==(u=n.absenceForm.get("reason"))||null==u.errors?null:u.errors.required),e.R7$(),e.Y8G("ngIf",null==(x=n.absenceForm.get("reason"))||null==x.errors?null:x.errors.minlength),e.R7$(2),e.Y8G("disabled",n.loading||n.absenceForm.invalid),e.R7$(12),e.JRh(e.i5U(44,16,n.absenceForm.value.date,"mediumDate")),e.R7$(4),e.JRh(n.absenceForm.value.reason),e.R7$(5),e.Y8G("disabled",n.loading),e.R7$(),e.Y8G("ngIf",n.loading)}},dependencies:[h.MD,h.bT,h.vh,s.YN,s.qT,s.me,s.BC,s.cb,s.X1,s.j4,s.JD],styles:['@import"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap";.container-fluid[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f5f7fa;padding-top:1.5rem;padding-bottom:1.5rem}.card[_ngcontent-%COMP%]{border:none;border-radius:.75rem;overflow:hidden;box-shadow:0 4px 12px #0000000d;transition:transform .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;background:linear-gradient(90deg,#4a90e2,#63b3ed);color:#fff}.card-body[_ngcontent-%COMP%]{padding:2rem}.custom-input-wrapper[_ngcontent-%COMP%]{position:relative}.custom-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;border:2px solid #e2e8f0;border-radius:.5rem;background:#fff;font-size:.95rem;color:#2d3748;transition:border-color .3s ease,box-shadow .3s ease}.custom-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e233}.custom-input.is-invalid[_ngcontent-%COMP%]{border-color:#e53e3e}.invalid-feedback[_ngcontent-%COMP%]{color:#e53e3e;font-size:.85rem;margin-top:.25rem}.alert-danger[_ngcontent-%COMP%]{background-color:#fef2f2;border-color:#fee2e2;color:#dc2626;padding:.75rem 1.25rem;border-radius:.5rem;margin-bottom:1rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4a90e2,#50c9c3);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#357abd,#4a90e2);transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]:disabled{background:#a0aec0;cursor:not-allowed}.btn-cancel[_ngcontent-%COMP%]{background:#e2e8f0;color:#2d3748;padding:.5rem 1rem;border:none;border-radius:.5rem;font-weight:500;transition:background .3s ease}.btn-cancel[_ngcontent-%COMP%]:hover{background:#cbd5e0}.btn-confirm[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4a90e2,#63b3ed);color:#fff;padding:.5rem 1rem;border:none;border-radius:.5rem;font-weight:500;transition:background .3s ease}.btn-confirm[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#357abd,#4a90e2)}.btn-close-white[_ngcontent-%COMP%]{filter:invert(1)}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000001a;display:flex;justify-content:center;align-items:center;z-index:20}.spinner[_ngcontent-%COMP%]{width:2rem;height:2rem;border:3px solid #f3f3f3;border-top:3px solid #4a90e2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.card-body[_ngcontent-%COMP%]{padding:1.5rem}.btn-primary[_ngcontent-%COMP%]{width:100%;padding:.5rem}}'],data:{animation:[(0,m.hZ)("slideInOut",[(0,m.kY)(":enter",[(0,m.iF)({transform:"translateY(-100%)",opacity:0}),(0,m.i0)("300ms ease-out",(0,m.iF)({transform:"translateY(0)",opacity:1}))]),(0,m.kY)(":leave",[(0,m.i0)("300ms ease-in",(0,m.iF)({transform:"translateY(-100%)",opacity:0}))])])]}})}}return a})();function S(a,d){1&a&&(e.j41(0,"div",29),e.nrm(1,"div",30),e.k0s())}function D(a,d){if(1&a&&(e.j41(0,"div",31),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",t.error," ")}}function R(a,d){if(1&a&&(e.j41(0,"option",32),e.EFF(1),e.k0s()),2&a){const t=d.$implicit;e.Y8G("value",t._id),e.R7$(),e.JRh(t.name)}}function $(a,d){if(1&a){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,r=e.XpG();return e.Njj(r.approveAbsence(n._id))}),e.EFF(1,"Approve"),e.k0s()}}function G(a,d){if(1&a){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,r=e.XpG();return e.Njj(r.rejectAbsence(n._id))}),e.EFF(1,"Reject"),e.k0s()}}function L(a,d){if(1&a){const t=e.RV6();e.j41(0,"tr",33)(1,"td",34),e.EFF(2),e.k0s(),e.j41(3,"td",34),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"td",34),e.EFF(7),e.k0s(),e.j41(8,"td",34),e.EFF(9),e.k0s(),e.j41(10,"td",34),e.EFF(11),e.k0s(),e.j41(12,"td",34),e.DNE(13,$,2,0,"button",35)(14,G,2,0,"button",36),e.j41(15,"button",37),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG();return e.Njj(r.deleteAbsence(n._id))}),e.EFF(16,"Delete"),e.k0s()()()}if(2&a){const t=d.$implicit,o=e.XpG();e.R7$(2),e.JRh(o.getTeacherName(t.teacherId)),e.R7$(2),e.JRh(e.i5U(5,7,t.date,"mediumDate")),e.R7$(3),e.JRh(t.reason),e.R7$(2),e.JRh(t.status),e.R7$(2),e.JRh(o.getTeacherName(t.substituteTeacherId)||"-"),e.R7$(2),e.Y8G("ngIf","Pending"===t.status),e.R7$(),e.Y8G("ngIf","Pending"===t.status)}}function Y(a,d){1&a&&(e.j41(0,"tr",40)(1,"td",41),e.EFF(2,"No absences found"),e.k0s()())}function H(a,d){if(1&a){const t=e.RV6();e.j41(0,"li",44)(1,"a",49),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.goToPage(n))}),e.EFF(2),e.k0s()()}if(2&a){const t=d.$implicit,o=e.XpG(2);e.AVh("active",t===o.currentPage),e.R7$(2),e.JRh(t)}}function U(a,d){if(1&a){const t=e.RV6();e.j41(0,"nav",42)(1,"ul",43)(2,"li",44)(3,"a",45),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.prevPage())}),e.j41(4,"span",46),e.EFF(5,"\xab"),e.k0s()()(),e.DNE(6,H,3,3,"li",47),e.j41(7,"li",44)(8,"a",48),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.nextPage())}),e.j41(9,"span",46),e.EFF(10,"\xbb"),e.k0s()()()()()}if(2&a){const t=e.XpG();e.R7$(2),e.AVh("disabled",1===t.currentPage),e.R7$(4),e.Y8G("ngForOf",t.getPageNumbers()),e.R7$(),e.AVh("disabled",t.currentPage===t.totalPages)}}let N=(()=>{class a{constructor(t,o,n,r,i,c){this.fb=t,this.teacherAbsenceService=o,this.teacherService=n,this.authService=r,this.toastr=i,this.datePipe=c,this.absences=[],this.filteredAbsences=[],this.teachers=[],this.loading=!1,this.error=null,this.currentPage=1,this.itemsPerPage=10,this.totalItems=0,this.filterForm=this.fb.group({startDate:[""],endDate:[""],teacherId:[""]})}ngOnInit(){if(!this.authService.getSchoolId())return this.error="Invalid or missing schoolId",void this.toastr.error(this.error);this.loadTeachers(),this.loadAbsences()}loadTeachers(){this.teacherService.getTeachersBySchool().subscribe({next:t=>{this.teachers=(Array.isArray(t.data)?t.data:t).filter(o=>!0===o.status)},error:t=>{this.error="Failed to load active teachers",this.toastr.error(this.error),console.error(t)}})}loadAbsences(){this.loading=!0,this.error=null;const t=this.authService.getSchoolId();if(!t)return this.error="School ID not found",this.toastr.error(this.error),void(this.loading=!1);const{startDate:o,endDate:n,teacherId:r}=this.filterForm.value;this.teacherAbsenceService.getPendingAbsences(t,o,n,r).subscribe({next:i=>{this.absences=i.data||i,this.filterAbsences(),this.loading=!1,this.absences.length||this.toastr.info("No pending leave applications found.")},error:i=>{this.error=i.error?.message||"Failed to load pending absences",this.toastr.error(this.error),this.loading=!1,console.error(i)}})}filterAbsences(){let t=[...this.absences];const{startDate:o,endDate:n,teacherId:r}=this.filterForm.value;o&&(t=t.filter(i=>new Date(i.date)>=new Date(o))),n&&(t=t.filter(i=>new Date(i.date)<=new Date(n))),r&&(t=t.filter(i=>i.teacherId===r||i.teacherId?._id===r)),this.filteredAbsences=t.sort((i,c)=>new Date(i.date).getTime()-new Date(c.date).getTime()),this.totalItems=t.length,this.currentPage=1}getTeacherName(t){if(!t)return"Not Assigned";if(this.teachers.length&&"string"==typeof t){const o=this.teachers.find(n=>n._id===t);return o?o.name:t}return"string"==typeof t?t:t?.name||"Unknown"}approveAbsence(t){this.updateStatus(t,"Approved")}rejectAbsence(t){this.updateStatus(t,"Rejected")}updateStatus(t,o){const n=this.authService.getSchoolId();return n?(this.loading=!0,this.absences.find(i=>i._id===t)?void this.teacherAbsenceService.updateAbsence(t,{status:o,schoolId:n}).subscribe({next:i=>{this.toastr.success(`Leave ${o.toLowerCase()} successfully`);const c=this.absences.findIndex(u=>u._id===t);-1!==c&&("Approved"===o||"Rejected"===o?this.absences.splice(c,1):this.absences[c]=i),this.filterAbsences(),this.loading=!1},error:i=>{this.error=i.error?.message||`Failed to ${o.toLowerCase()} leave`,this.toastr.error(this.error),this.loading=!1,console.error(i)}}):(this.toastr.error("Absence not found"),void(this.loading=!1))):(this.toastr.error("School ID not found"),void(this.loading=!1))}deleteAbsence(t){if(confirm("Are you sure you want to delete this absence?")){const o=this.authService.getSchoolId();if(!o)return void this.toastr.error("School ID not found");this.loading=!0,this.teacherAbsenceService.deleteAbsence(t,o).subscribe({next:()=>{this.toastr.success("Absence deleted successfully"),this.absences=this.absences.filter(n=>n._id!==t),this.filterAbsences(),this.loading=!1},error:n=>{this.error=n.error?.message||"Failed to delete absence",this.toastr.error(this.error),this.loading=!1,console.error(n)}})}}get paginatedAbsences(){const t=(this.currentPage-1)*this.itemsPerPage;return this.filteredAbsences.slice(t,t+this.itemsPerPage)}get totalPages(){return Math.ceil(this.totalItems/this.itemsPerPage)}getPageNumbers(){const t=[];for(let o=1;o<=this.totalPages;o++)t.push(o);return t}prevPage(){this.currentPage>1&&this.currentPage--}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(s.ok),e.rXU(M),e.rXU(l.O),e.rXU(p.u),e.rXU(y.tw),e.rXU(h.vh))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-admin-approve-leave"]],features:[e.Jv_([h.vh])],decls:52,vars:8,consts:[[1,"container-fluid","py-6","bg-gray-50","min-h-screen"],[1,"row","justify-content-center"],[1,"col-12","col-lg-12"],[1,"card","bg-white","shadow-xl","rounded-xl","overflow-hidden"],[1,"card-header","bg-gradient-to-r","from-blue-700","to-blue-900","text-white","p-2"],[1,"text-xl","font-semibold",2,"color","whitesmoke"],[1,"card-body","p-6"],["class","loading-overlay",4,"ngIf"],["class","alert alert-danger mb-4","role","alert",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6",3,"ngSubmit","formGroup"],["for","startDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"custom-input-wrapper"],["id","startDate","type","date","formControlName","startDate",1,"custom-input"],["for","endDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","endDate","type","date","formControlName","endDate",1,"custom-input"],["for","teacherId",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"custom-select-wrapper"],["id","teacherId","formControlName","teacherId",1,"custom-select"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-span-1","md:col-span-3","text-right"],["type","submit",1,"btn-primary"],[1,"table-responsive"],[1,"data-grid","w-full"],[1,"bg-blue-100","sticky","top-0","z-10"],[1,"p-2","text-left"],["class","hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],["class","text-center",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"loading-overlay"],[1,"spinner"],["role","alert",1,"alert","alert-danger","mb-4"],[3,"value"],[1,"hover:bg-gray-50","transition-colors"],[1,"p-2"],["class","btn-success btn-sm me-2",3,"click",4,"ngIf"],["class","btn-danger btn-sm me-2",3,"click",4,"ngIf"],[1,"btn-danger","btn-sm",3,"click"],[1,"btn-success","btn-sm","me-2",3,"click"],[1,"btn-danger","btn-sm","me-2",3,"click"],[1,"text-center"],["colspan","6",1,"p-4","text-gray-500"],[1,"mt-4"],[1,"pagination","justify-content-center"],[1,"page-item"],["aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],["class","page-item",3,"active",4,"ngFor","ngForOf"],["aria-label","Next",1,"page-link",3,"click"],[1,"page-link",3,"click"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e.EFF(6,"Approve Leaves"),e.k0s()(),e.j41(7,"div",6),e.DNE(8,S,2,0,"div",7)(9,D,2,1,"div",8),e.j41(10,"form",9),e.bIt("ngSubmit",function(){return n.loadAbsences()}),e.j41(11,"div")(12,"label",10),e.EFF(13,"Start Date"),e.k0s(),e.j41(14,"div",11),e.nrm(15,"input",12),e.k0s()(),e.j41(16,"div")(17,"label",13),e.EFF(18,"End Date"),e.k0s(),e.j41(19,"div",11),e.nrm(20,"input",14),e.k0s()(),e.j41(21,"div")(22,"label",15),e.EFF(23,"Teacher"),e.k0s(),e.j41(24,"div",16)(25,"select",17)(26,"option",18),e.EFF(27,"All Teachers"),e.k0s(),e.DNE(28,R,2,2,"option",19),e.k0s()()(),e.j41(29,"div",20)(30,"button",21),e.EFF(31,"Filter"),e.k0s()()(),e.j41(32,"div",22)(33,"table",23)(34,"thead",24)(35,"tr")(36,"th",25),e.EFF(37,"Teacher"),e.k0s(),e.j41(38,"th",25),e.EFF(39,"Date"),e.k0s(),e.j41(40,"th",25),e.EFF(41,"Reason"),e.k0s(),e.j41(42,"th",25),e.EFF(43,"Status"),e.k0s(),e.j41(44,"th",25),e.EFF(45,"Substitute"),e.k0s(),e.j41(46,"th",25),e.EFF(47,"Actions"),e.k0s()()(),e.j41(48,"tbody"),e.DNE(49,L,17,10,"tr",26)(50,Y,3,0,"tr",27),e.k0s()()(),e.DNE(51,U,11,5,"nav",28),e.k0s()()()()()),2&o&&(e.R7$(8),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.error),e.R7$(),e.Y8G("formGroup",n.filterForm),e.R7$(18),e.Y8G("ngForOf",n.teachers),e.R7$(4),e.Y8G("@slideInOut",void 0),e.R7$(17),e.Y8G("ngForOf",n.paginatedAbsences),e.R7$(),e.Y8G("ngIf",0===n.paginatedAbsences.length&&!n.loading),e.R7$(),e.Y8G("ngIf",n.filteredAbsences.length>0))},dependencies:[h.MD,h.Sq,h.bT,h.vh,s.X1,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.j4,s.JD],styles:['@import"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap";.container-fluid[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f5f7fa;padding-top:1.5rem;padding-bottom:1.5rem}.card[_ngcontent-%COMP%]{border:none;border-radius:.75rem;overflow:hidden;box-shadow:0 4px 12px #0000000d;transition:transform .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;background:linear-gradient(90deg,#2c5282,#4a90e2);color:#fff}.card-body[_ngcontent-%COMP%]{padding:2rem}.custom-input-wrapper[_ngcontent-%COMP%]{position:relative}.custom-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;border:2px solid #e2e8f0;border-radius:.5rem;background:#fff;font-size:.95rem;color:#2d3748;transition:border-color .3s ease,box-shadow .3s ease}.custom-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e233}.custom-select-wrapper[_ngcontent-%COMP%]{position:relative}.custom-select[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;border:2px solid #e2e8f0;border-radius:.5rem;background:#fff url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="%234a90e2"><path d="M7.293 4.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 011.414-1.414L6 6.586l2.293-2.293z"/></svg>\') no-repeat right .75rem center;background-size:12px;font-size:.95rem;color:#2d3748;appearance:none;cursor:pointer;transition:border-color .3s ease,box-shadow .3s ease}.custom-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e233}.alert[_ngcontent-%COMP%]{padding:1rem;border-radius:.5rem;font-size:.95rem;margin-bottom:1rem}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4a90e2,#63b3ed);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#357abd,#4a90e2);transform:translateY(-2px)}.btn-success[_ngcontent-%COMP%]{background:linear-gradient(90deg,#28a745,#34c759);color:#fff;padding:.25rem .75rem;border:none;border-radius:.375rem;font-size:.9rem;cursor:pointer;transition:background .3s ease}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#218838,#28a745)}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(90deg,#dc3545,#e4606d);color:#fff;padding:.25rem .75rem;border:none;border-radius:.375rem;font-size:.9rem;cursor:pointer;transition:background .3s ease}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#c82333,#dc3545)}.btn-primary[_ngcontent-%COMP%]:disabled, .btn-success[_ngcontent-%COMP%]:disabled, .btn-danger[_ngcontent-%COMP%]:disabled{background:#a0aec0;cursor:not-allowed;transform:none}.data-grid[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0}.data-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f7fa;color:#2d3748;font-weight:500;padding:.75rem;text-align:left;border-bottom:2px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fafafa}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#edf2f7}.pagination[_ngcontent-%COMP%]{display:flex;list-style:none;padding:0}.page-item[_ngcontent-%COMP%]{margin:0 .25rem}.page-item.disabled[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background:#e2e8f0;color:#a0aec0;cursor:not-allowed}.page-item.active[_ngcontent-%COMP%]   .page-link[_ngcontent-%COMP%]{background:#4a90e2;color:#fff;border-color:#4a90e2}.page-link[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #e2e8f0;border-radius:.375rem;color:#2d3748;text-decoration:none;transition:background .3s ease,color .3s ease}.page-link[_ngcontent-%COMP%]:hover:not(.disabled){background:#e2e8f0;color:#2d3748}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000001a;display:flex;justify-content:center;align-items:center;z-index:20}.spinner[_ngcontent-%COMP%]{width:2rem;height:2rem;border:3px solid #f3f3f3;border-top:3px solid #4a90e2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.grid-cols-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;font-size:.9rem}.btn-primary[_ngcontent-%COMP%]{width:100%;padding:.5rem}}']})}}return a})();var B=g(467),z=g(1964),P=g(749);function X(a,d){if(1&a&&(e.j41(0,"div",38)(1,"div",39),e.nrm(2,"i",40),e.k0s(),e.j41(3,"div",41)(4,"span",42),e.EFF(5,"GPS Active"),e.k0s(),e.j41(6,"span",43),e.EFF(7),e.k0s()()()),2&a){const t=e.XpG();e.R7$(7),e.Lme("",t.currentLocation.lat.toFixed(4),", ",t.currentLocation.lng.toFixed(4),"")}}function V(a,d){1&a&&(e.j41(0,"div",44),e.nrm(1,"i",45),e.EFF(2," Date is required "),e.k0s())}function W(a,d){if(1&a&&(e.j41(0,"option",46),e.nrm(1,"i"),e.EFF(2),e.k0s()),2&a){const t=d.$implicit,o=e.XpG();e.Y8G("value",t),e.R7$(),e.HbH(o.getStatusIcon(t)),e.R7$(),e.SpI(" ",t," ")}}function J(a,d){1&a&&(e.j41(0,"div",44),e.nrm(1,"i",45),e.EFF(2," Status is required "),e.k0s())}function K(a,d){if(1&a&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&a){const t=d.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t||"Unspecified"," ")}}function Q(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",12)(1,"label",13),e.nrm(2,"i",47),e.j41(3,"span"),e.EFF(4,"Leave Type"),e.k0s()(),e.j41(5,"div",21)(6,"select",48),e.mxI("ngModelChange",function(n){e.eBV(t);const r=e.XpG();return e.DH7(r.leaveType,n)||(r.leaveType=n),e.Njj(n)}),e.j41(7,"option",23),e.EFF(8,"Select Leave Type"),e.k0s(),e.DNE(9,K,2,2,"option",24),e.k0s(),e.j41(10,"div",17),e.nrm(11,"i",25),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.leaveType),e.R7$(3),e.Y8G("ngForOf",t.leaveTypes)}}function Z(a,d){if(1&a&&(e.j41(0,"div",49),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",t.remarks.length,"/500 ")}}function q(a,d){1&a&&(e.j41(0,"span",50),e.nrm(1,"i",51),e.EFF(2," Mark Attendance "),e.k0s())}function ee(a,d){1&a&&(e.j41(0,"span",50),e.nrm(1,"i",52),e.EFF(2," Processing... "),e.k0s())}function te(a,d){if(1&a&&(e.j41(0,"div",53)(1,"div",54),e.nrm(2,"i",55),e.k0s(),e.j41(3,"div",56)(4,"h4",57),e.EFF(5,"Holiday Notice"),e.k0s(),e.j41(6,"p",58),e.EFF(7),e.k0s()()()),2&a){const t=e.XpG();e.R7$(7),e.SpI(" Today is a ",t.isHoliday?"holiday":"weekly holiday",'. Please select "Holiday" status to continue. ')}}function ne(a,d){if(1&a&&(e.j41(0,"div",59)(1,"div",60),e.nrm(2,"i",61),e.j41(3,"span"),e.EFF(4),e.k0s()()()),2&a){const t=e.XpG();e.R7$(4),e.JRh(t.successMessage)}}function oe(a,d){if(1&a&&(e.j41(0,"div",62)(1,"div",60),e.nrm(2,"i",63),e.j41(3,"span"),e.EFF(4),e.k0s()()()),2&a){const t=e.XpG();e.R7$(4),e.JRh(t.errorMessage)}}function re(a,d){if(1&a){const t=e.RV6();e.j41(0,"tr",39)(1,"td",37),e.EFF(2),e.k0s(),e.j41(3,"td",37)(4,"div",40)(5,"span",41),e.EFF(6),e.k0s()()(),e.j41(7,"td",37),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td",37),e.EFF(11),e.k0s(),e.j41(12,"td",37),e.EFF(13),e.k0s(),e.j41(14,"td",37),e.EFF(15),e.nI1(16,"date"),e.k0s(),e.j41(17,"td",42)(18,"button",43),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.openConfirmModal(n,"Approved"))}),e.EFF(19,"Approve"),e.k0s(),e.j41(20,"button",44),e.bIt("click",function(){const n=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.openConfirmModal(n,"Rejected"))}),e.EFF(21,"Reject"),e.k0s()()()}if(2&a){const t=d.$implicit,o=d.index;e.R7$(2),e.JRh(o+1),e.R7$(4),e.JRh(t.teacherId.name||t.teacherId),e.R7$(2),e.JRh(e.i5U(9,6,t.date,"mediumDate")),e.R7$(3),e.JRh(t.reason),e.R7$(2),e.JRh(t.isTeacherApplied?"Teacher-Applied":"Auto-Generated"),e.R7$(2),e.JRh(e.i5U(16,9,t.createdAt,"short"))}}function ie(a,d){if(1&a&&(e.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr",36)(4,"th",37),e.EFF(5,"#"),e.k0s(),e.j41(6,"th",37),e.EFF(7,"Teacher"),e.k0s(),e.j41(8,"th",37),e.EFF(9,"Date"),e.k0s(),e.j41(10,"th",37),e.EFF(11,"Reason"),e.k0s(),e.j41(12,"th",37),e.EFF(13,"Type"),e.k0s(),e.j41(14,"th",37),e.EFF(15,"Submitted"),e.k0s(),e.j41(16,"th",37),e.EFF(17,"Actions"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,re,22,12,"tr",38),e.k0s()()()),2&a){const t=e.XpG();e.R7$(19),e.Y8G("ngForOf",t.absences)}}function se(a,d){1&a&&(e.j41(0,"div",45),e.nrm(1,"i",46),e.j41(2,"p"),e.EFF(3,"No pending absence requests at this time."),e.k0s()())}function ce(a,d){1&a&&(e.j41(0,"div",47),e.nrm(1,"div",48),e.k0s())}function de(a,d){if(1&a&&(e.j41(0,"div",49),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",t.errorMessage," ")}}function le(a,d){1&a&&e.nrm(0,"span",48)}const pe=[{path:"",redirectTo:"/teacher/teacher-details",pathMatch:"full"},{path:"teacher-details",loadComponent:()=>Promise.all([g.e(2076),g.e(5640)]).then(g.bind(g,5640)).then(a=>a.TeacherDetailsComponent)},{path:"teacher-create",canActivate:[b.q],data:{roles:["admin"]},loadComponent:()=>Promise.all([g.e(4352),g.e(6532)]).then(g.bind(g,6532)).then(a=>a.TeacherCreateComponent)},{path:"teacher-update/:teacherId",canActivate:[b.q],data:{roles:["admin"]},loadComponent:()=>Promise.all([g.e(4352),g.e(9742)]).then(g.bind(g,9742)).then(a=>a.TeacherUpdateComponent)},{path:"apply-leave",component:E,canActivate:[b.q],data:{roles:["teacher"]}},{path:"attendance",component:(()=>{class a{constructor(t,o,n,r,i,c,u){this.holidayService=t,this.teacherService=o,this.authService=n,this.schoolService=r,this.http=i,this.router=c,this.toastr=u,this.selectedDate=(new Date).toISOString().split("T")[0],this.selectedStatus="Present",this.leaveType=null,this.remarks="",this.errorMessage="",this.successMessage="",this.isHoliday=!1,this.weeklyHolidayDay="Sunday",this.maxDate=(new Date).toISOString().split("T")[0],this.minDate=(new Date).toISOString().split("T")[0],this.statuses=["Present","Absent","On Leave","Holiday"],this.leaveTypes=["Casual","Sick","Unpaid",null],this.currentLocation=null,this.isSubmitting=!1}ngOnInit(){"teacher"!==this.authService.getUserRole()&&this.router.navigate(["/"]),this.loadWeeklyHolidayDay(),this.checkHoliday()}getStatusIcon(t){switch(t){case"Present":return"fas fa-user-check";case"Absent":return"fas fa-user-times";case"On Leave":return"fas fa-umbrella-beach";case"Holiday":return"fas fa-calendar-times";default:return"fas fa-question-circle"}}loadWeeklyHolidayDay(){const t=this.authService.getSchoolId();t?this.schoolService.loadWeeklyHolidayDay(t).subscribe({next:o=>{this.weeklyHolidayDay=o,this.checkHolidayAndWeekly()},error:o=>{this.errorMessage=o.message||"Error loading weekly holiday day",this.toastr.error(this.errorMessage)}}):(this.errorMessage="School ID not found",this.toastr.error(this.errorMessage))}checkHoliday(){const t=this.authService.getSchoolId();this.holidayService.getHolidays(t,this.selectedDate).subscribe(o=>{this.isHoliday=o.isHoliday,this.isHoliday&&"Holiday"!==this.selectedStatus?(this.selectedStatus="Holiday",this.errorMessage='This is a holiday. Please select "Holiday" status or choose a different date.',this.toastr.warning(this.errorMessage)):this.errorMessage=""},o=>{this.errorMessage=o.message||"Error checking holiday status",this.toastr.error(this.errorMessage)})}checkHolidayAndWeekly(){const t=this.authService.getSchoolId(),n=new Date(this.selectedDate).toLocaleDateString("en-US",{weekday:"long"});this.holidayService.getHolidays(t,this.selectedDate).subscribe(r=>{this.isHoliday=r.isHoliday,this.isHoliday&&"Holiday"!==this.selectedStatus?(this.selectedStatus="Holiday",this.errorMessage='This is a holiday. Please select "Holiday" status or choose a different date.',this.toastr.warning(this.errorMessage)):n===this.weeklyHolidayDay&&"Holiday"!==this.selectedStatus?(this.selectedStatus="Holiday",this.errorMessage=`This is a weekly holiday (${this.weeklyHolidayDay}). Please select "Holiday" status or choose a different date.`,this.toastr.warning(this.errorMessage)):this.errorMessage=""},r=>{this.errorMessage=r.message||"Error checking holiday status",this.toastr.error(this.errorMessage)})}onDateChange(){this.checkHolidayAndWeekly()}getCurrentLocation(){return new Promise((t,o)=>{this.schoolService.getMySchoolForTeacher().subscribe({next:n=>{if(n&&n.latitude&&n.longitude)return t({lat:n.latitude,lng:n.longitude});console.warn("School has no lat/lng saved \u2192 falling back to GPS"),this.tryGpsWithSchoolFallback(t,o)},error:n=>{console.warn("Failed to load school \u2192 trying GPS",n),this.tryGpsWithSchoolFallback(t,o)}})})}tryGpsWithSchoolFallback(t,o){if(!navigator.geolocation)return o("Geolocation not supported and school location missing");navigator.geolocation.getCurrentPosition(n=>{n.coords.accuracy<=100?t({lat:n.coords.latitude,lng:n.coords.longitude}):o("Poor GPS accuracy. Please ensure school location is set in admin panel.")},n=>{o("Location access denied or failed. School location must be configured.")},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})}onSubmit(){var t=this;return(0,B.A)(function*(){const o=t.authService.getActiveAcademicYearId();if(!o)return t.errorMessage="No active academic year found. Please contact administrator.",void t.toastr.error(t.errorMessage);if((t.isHoliday||t.isWeeklyHoliday())&&"Holiday"!==t.selectedStatus)return t.errorMessage="Cannot mark attendance as Present/Absent/On Leave on a holiday or weekly holiday.",void t.toastr.error(t.errorMessage);try{const n=yield t.getCurrentLocation();console.log(n);const r={teacherId:t.authService.getUserId(),schoolId:t.authService.getSchoolId(),academicYearId:o,date:t.selectedDate,status:t.selectedStatus,leaveType:"On Leave"===t.selectedStatus?t.leaveType:null,remarks:t.remarks||void 0,lat:n.lat,lng:n.lng};t.teacherService.markAttendance(r).subscribe(i=>{t.successMessage="Attendance marked successfully",t.toastr.success(t.successMessage),t.errorMessage="",setTimeout(()=>t.successMessage="",3e3)},i=>{t.handleServerError(i),t.errorMessage="",t.successMessage=""})}catch(n){t.errorMessage=n,t.toastr.error(t.errorMessage)}})()}isWeeklyHoliday(){return new Date(this.selectedDate).toLocaleDateString("en-US",{weekday:"long"})===this.weeklyHolidayDay}handleServerError(t){let o="An unexpected error occurred.";t.error&&"object"==typeof t.error&&!t.error.success?o=t.error.message||t.error.error||"An error occurred.":t.error&&"string"==typeof t.error?o=t.error:t.message&&(o=t.message),this.toastr.error(o,"Error",{closeButton:!0,progressBar:!0})}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(z._),e.rXU(l.O),e.rXU(p.u),e.rXU(f.g),e.rXU(_.Qq),e.rXU(P.Ix),e.rXU(y.tw))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-teacher-attendance"]],decls:58,vars:19,consts:[["attendanceForm","ngForm"],[1,"attendance-wrapper"],[1,"header-section"],[1,"header-content"],[1,"icon-wrapper"],[1,"fas","fa-user-check"],[1,"header-text"],[1,"title"],[1,"subtitle"],["class","location-status",4,"ngIf"],[1,"form-card"],[3,"ngSubmit"],[1,"form-group"],[1,"form-label"],[1,"fas","fa-calendar-alt"],[1,"input-wrapper"],["type","date","id","date","name","date","required","",1,"form-input",3,"ngModelChange","ngModel","max"],[1,"input-icon"],[1,"fas","fa-calendar"],["class","error-message",4,"ngIf"],[1,"fas","fa-clipboard-check"],[1,"input-wrapper","select-wrapper"],["id","status","name","status","required","",1,"form-input",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],["class","form-group",4,"ngIf"],[1,"fas","fa-comment-dots"],["id","remarks","name","remarks","rows","3","maxlength","500","placeholder","Add any additional comments...",1,"form-input","textarea-input",3,"ngModelChange","ngModel"],[1,"fas","fa-comment"],["class","character-count",4,"ngIf"],["type","submit",1,"submit-btn",3,"disabled"],["class","btn-content",4,"ngIf"],["class","holiday-banner",4,"ngIf"],["class","message success-message",4,"ngIf"],["class","message error-message",4,"ngIf"],[1,"location-notice"],[1,"fas","fa-info-circle"],[1,"location-status"],[1,"location-icon"],[1,"fas","fa-map-marker-alt"],[1,"location-text"],[1,"status-text"],[1,"location-info"],[1,"error-message"],[1,"fas","fa-exclamation-circle"],[3,"value"],[1,"fas","fa-umbrella-beach"],["id","leaveType","name","leaveType","required","",1,"form-input",3,"ngModelChange","ngModel"],[1,"character-count"],[1,"btn-content"],[1,"fas","fa-check"],[1,"fas","fa-spinner","fa-spin"],[1,"holiday-banner"],[1,"banner-icon"],[1,"fas","fa-exclamation-triangle"],[1,"banner-content"],[1,"banner-title"],[1,"banner-text"],[1,"message","success-message"],[1,"message-content"],[1,"fas","fa-check-circle"],[1,"message","error-message"],[1,"fas","fa-times-circle"]],template:function(o,n){if(1&o){const r=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),e.nrm(4,"i",5),e.k0s(),e.j41(5,"div",6)(6,"h2",7),e.EFF(7,"Mark Attendance"),e.k0s(),e.j41(8,"p",8),e.EFF(9,"Record your daily attendance"),e.k0s()()()(),e.DNE(10,X,8,2,"div",9),e.j41(11,"div",10)(12,"form",11,0),e.bIt("ngSubmit",function(){return e.eBV(r),e.Njj(n.onSubmit())}),e.j41(14,"div",12)(15,"label",13),e.nrm(16,"i",14),e.j41(17,"span"),e.EFF(18,"Date"),e.k0s()(),e.j41(19,"div",15)(20,"input",16),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.selectedDate,c)||(n.selectedDate=c),e.Njj(c)}),e.bIt("ngModelChange",function(){return e.eBV(r),e.Njj(n.onDateChange())}),e.k0s(),e.j41(21,"div",17),e.nrm(22,"i",18),e.k0s()(),e.DNE(23,V,3,0,"div",19),e.k0s(),e.j41(24,"div",12)(25,"label",13),e.nrm(26,"i",20),e.j41(27,"span"),e.EFF(28,"Status"),e.k0s()(),e.j41(29,"div",21)(30,"select",22),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.selectedStatus,c)||(n.selectedStatus=c),e.Njj(c)}),e.j41(31,"option",23),e.EFF(32,"Select Status"),e.k0s(),e.DNE(33,W,3,4,"option",24),e.k0s(),e.j41(34,"div",17),e.nrm(35,"i",25),e.k0s()(),e.DNE(36,J,3,0,"div",19),e.k0s(),e.DNE(37,Q,12,2,"div",26),e.j41(38,"div",12)(39,"label",13),e.nrm(40,"i",27),e.j41(41,"span"),e.EFF(42,"Remarks (Optional)"),e.k0s()(),e.j41(43,"div",15)(44,"textarea",28),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.remarks,c)||(n.remarks=c),e.Njj(c)}),e.k0s(),e.j41(45,"div",17),e.nrm(46,"i",29),e.k0s()(),e.DNE(47,Z,2,1,"div",30),e.k0s(),e.j41(48,"button",31),e.DNE(49,q,3,0,"span",32)(50,ee,3,0,"span",32),e.k0s()()(),e.DNE(51,te,8,1,"div",33)(52,ne,5,1,"div",34)(53,oe,5,1,"div",35),e.j41(54,"div",36),e.nrm(55,"i",37),e.j41(56,"span"),e.EFF(57,"GPS location is required to verify you're within school premises."),e.k0s()()()}if(2&o){const r=e.sdS(13);e.R7$(10),e.Y8G("ngIf",n.currentLocation),e.R7$(10),e.R50("ngModel",n.selectedDate),e.Y8G("max",n.maxDate),e.R7$(3),e.Y8G("ngIf",(null==r.controls.date?null:r.controls.date.invalid)&&(null==r.controls.date?null:r.controls.date.touched)),e.R7$(7),e.R50("ngModel",n.selectedStatus),e.Y8G("disabled",(n.isHoliday||n.isWeeklyHoliday())&&"Holiday"!==n.selectedStatus),e.R7$(3),e.Y8G("ngForOf",n.statuses),e.R7$(3),e.Y8G("ngIf",(null==r.controls.status?null:r.controls.status.invalid)&&(null==r.controls.status?null:r.controls.status.touched)),e.R7$(),e.Y8G("ngIf","On Leave"===n.selectedStatus&&!n.isHoliday&&!n.isWeeklyHoliday()),e.R7$(7),e.R50("ngModel",n.remarks),e.R7$(3),e.Y8G("ngIf",n.remarks),e.R7$(),e.AVh("loading",n.isSubmitting),e.Y8G("disabled",!r.valid||n.isSubmitting||(n.isHoliday||n.isWeeklyHoliday())&&"Holiday"!==n.selectedStatus),e.R7$(),e.Y8G("ngIf",!n.isSubmitting),e.R7$(),e.Y8G("ngIf",n.isSubmitting),e.R7$(),e.Y8G("ngIf",n.isHoliday||n.isWeeklyHoliday()),e.R7$(),e.Y8G("ngIf",n.successMessage),e.R7$(),e.Y8G("ngIf",n.errorMessage)}},dependencies:[h.MD,h.Sq,h.bT,s.YN,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.YS,s.tU,s.vS,s.cV],styles:["@import\"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap\";*[_ngcontent-%COMP%]{box-sizing:border-box}.attendance-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);font-family:Poppins,sans-serif;padding:20px;display:flex;flex-direction:column;align-items:center;position:relative}.attendance-wrapper[_ngcontent-%COMP%]:before{content:\"\";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#1e3a8a,#0ea5e9,#1e3a8a);background-size:200% 100%;animation:_ngcontent-%COMP%_gradientShift 3s ease infinite}@keyframes _ngcontent-%COMP%_gradientShift{0%,to{background-position:0% 50%}50%{background-position:100% 50%}}.header-section[_ngcontent-%COMP%]{width:100%;max-width:400px;background:#fff;border-radius:16px;padding:24px;box-shadow:0 4px 20px #00000014;margin-bottom:20px;position:relative;overflow:hidden}.header-section[_ngcontent-%COMP%]:after{content:\"\";position:absolute;top:0;right:0;width:80px;height:80px;background:linear-gradient(135deg,#1e3a8a,#0ea5e9);border-radius:0 16px;opacity:.1}.header-section[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;position:relative;z-index:1}.header-section[_ngcontent-%COMP%]   .icon-wrapper[_ngcontent-%COMP%]{width:56px;height:56px;background:linear-gradient(135deg,#1e3a8a,#0ea5e9);border-radius:16px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.header-section[_ngcontent-%COMP%]   .icon-wrapper[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#fff}.header-section[_ngcontent-%COMP%]   .header-text[_ngcontent-%COMP%]{flex:1}.header-section[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin:0 0 4px;font-size:24px;font-weight:600;color:#1e293b;line-height:1.2}.header-section[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#64748b;font-weight:400}.location-status[_ngcontent-%COMP%]{width:100%;max-width:400px;background:linear-gradient(135deg,#1e3a8a,#0ea5e9);color:#fff;padding:16px 20px;border-radius:12px;margin-bottom:20px;display:flex;align-items:center;gap:12px;box-shadow:0 4px 20px #1e3a8a33}.location-status[_ngcontent-%COMP%]   .location-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.location-status[_ngcontent-%COMP%]   .location-text[_ngcontent-%COMP%]{flex:1}.location-status[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{display:block;font-size:14px;font-weight:500;margin-bottom:2px}.location-status[_ngcontent-%COMP%]   .location-info[_ngcontent-%COMP%]{display:block;font-size:12px;opacity:.9;font-family:Courier New,monospace}.form-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background:#fff;border-radius:16px;padding:24px;box-shadow:0 8px 32px #0000001a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);position:relative;overflow:hidden}.form-card[_ngcontent-%COMP%]:before{content:\"\";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#1e3a8a,#0ea5e9)}.form-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-group.has-error[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 3px #ef44441a}.form-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:500;color:#374151;margin:0}.form-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#0ea5e9;width:16px}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.input-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{width:100%;padding:14px 16px 14px 48px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;font-family:Poppins,sans-serif;background:#fafafa;transition:all .3s ease;font-weight:400}.input-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#0ea5e9;box-shadow:0 0 0 3px #0ea5e91a;background:#fff;transform:translateY(-1px)}.input-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:disabled{background:#f3f4f6;color:#9ca3af;cursor:not-allowed}.input-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.input-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:#6b7280;pointer-events:none;z-index:1}.input-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.input-wrapper.select-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{padding-right:48px;appearance:none;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e\");background-position:right 16px center;background-repeat:no-repeat;background-size:16px}.input-wrapper.select-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{left:auto;right:16px;color:#0ea5e9}.input-wrapper[_ngcontent-%COMP%]   .textarea-input[_ngcontent-%COMP%]{padding:12px 16px 12px 48px;resize:vertical;min-height:80px}.input-wrapper[_ngcontent-%COMP%]   .textarea-input[_ngcontent-%COMP%]:focus{min-height:100px}.character-count[_ngcontent-%COMP%]{text-align:right;font-size:12px;color:#9ca3af;font-weight:500}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;color:#ef4444;font-size:13px;font-weight:500;padding:4px 8px;background:#ef44441a;border-radius:6px}.error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}.submit-btn[_ngcontent-%COMP%]{width:100%;padding:16px;background:linear-gradient(135deg,#1e3a8a,#0ea5e9);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;font-family:Poppins,sans-serif;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden;margin-top:8px}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px #1e3a8a4d}.submit-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.submit-btn[_ngcontent-%COMP%]:disabled{background:#9ca3af;cursor:not-allowed;transform:none}.submit-btn[_ngcontent-%COMP%]:disabled:hover{box-shadow:none}.submit-btn[_ngcontent-%COMP%]   .btn-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.submit-btn[_ngcontent-%COMP%]   .btn-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.submit-btn.loading[_ngcontent-%COMP%]{pointer-events:none}.holiday-banner[_ngcontent-%COMP%]{width:100%;max-width:400px;background:linear-gradient(135deg,#fef3c7,#fde68a);border:1px solid #f59e0b;border-radius:12px;padding:16px;margin:20px 0;display:flex;align-items:flex-start;gap:12px;box-shadow:0 4px 12px #f59e0b26}.holiday-banner[_ngcontent-%COMP%]   .banner-icon[_ngcontent-%COMP%]{flex-shrink:0;margin-top:2px}.holiday-banner[_ngcontent-%COMP%]   .banner-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;color:#d97706}.holiday-banner[_ngcontent-%COMP%]   .banner-content[_ngcontent-%COMP%]{flex:1}.holiday-banner[_ngcontent-%COMP%]   .banner-title[_ngcontent-%COMP%]{margin:0 0 4px;font-size:14px;font-weight:600;color:#92400e}.holiday-banner[_ngcontent-%COMP%]   .banner-text[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#7c2d12;line-height:1.4}.message[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:16px 0;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px #0000001a}.message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px 20px;font-weight:500;font-size:14px}.message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;flex-shrink:0}.message.success-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dcfce7,#bbf7d0);border-left:4px solid #16a34a}.message.success-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{color:#166534}.message.error-message[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fee2e2,#fecaca);border-left:4px solid #dc2626}.message.error-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{color:#991b1b}.location-notice[_ngcontent-%COMP%]{width:100%;max-width:400px;background:#0ea5e91a;border:1px solid rgba(14,165,233,.2);border-radius:8px;padding:12px 16px;margin-top:20px;display:flex;align-items:center;gap:8px;font-size:13px;color:#0369a1}.location-notice[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#0ea5e9;font-size:14px}  option{padding:8px 12px!important;display:flex;align-items:center;gap:8px}.fa-user-check[_ngcontent-%COMP%]{color:#16a34a}.fa-user-times[_ngcontent-%COMP%]{color:#ef4444}.fa-umbrella-beach[_ngcontent-%COMP%]{color:#f59e0b}.fa-calendar-times[_ngcontent-%COMP%]{color:#6b7280}@media (max-width: 480px){.attendance-wrapper[_ngcontent-%COMP%]{padding:16px}.header-section[_ngcontent-%COMP%]{padding:20px 16px}.header-section[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px}.header-section[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:13px}.form-card[_ngcontent-%COMP%]{padding:20px 16px}.input-wrapper[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{padding:12px 14px 12px 44px;font-size:15px}.input-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{left:14px}.input-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}.select-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{right:14px}.submit-btn[_ngcontent-%COMP%]{padding:14px;font-size:15px}.holiday-banner[_ngcontent-%COMP%]{padding:14px;flex-direction:column;align-items:flex-start;gap:8px}.holiday-banner[_ngcontent-%COMP%]   .banner-title[_ngcontent-%COMP%]{font-size:13px}.holiday-banner[_ngcontent-%COMP%]   .banner-text[_ngcontent-%COMP%]{font-size:12px}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.form-card[_ngcontent-%COMP%], .header-section[_ngcontent-%COMP%], .holiday-banner[_ngcontent-%COMP%], .message[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .5s ease forwards}.form-input[_ngcontent-%COMP%]:focus, .submit-btn[_ngcontent-%COMP%]:focus{outline:2px solid #0ea5e9;outline-offset:2px}@media (prefers-reduced-motion: reduce){*[_ngcontent-%COMP%], *[_ngcontent-%COMP%]:before, *[_ngcontent-%COMP%]:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}"]})}}return a})()},{path:"admin/teacher-absences",canActivate:[b.q],data:{roles:["admin"]},component:(()=>{class a{constructor(t,o,n,r){this.absenceService=t,this.authService=o,this.router=n,this.toastr=r,this.absences=[],this.errorMessage="",this.loading=!1,this.selectedStartDate="",this.selectedEndDate="",this.teacherIdFilter=""}ngOnInit(){if("admin"!==this.authService.getUserRole())return this.router.navigate(["/"]),void this.toastr.error("Unauthorized access");this.loadPendingAbsences()}loadPendingAbsences(){this.loading=!0,this.errorMessage="";const t=this.authService.getSchoolId();this.absenceService.getPendingAutoAbsences(t,this.selectedStartDate,this.selectedEndDate,this.teacherIdFilter).subscribe({next:o=>{this.absences=o.data||[],console.log("Loaded auto-generated absences:",this.absences),this.loading=!1,this.absences.length||this.toastr.info("No pending absences due to forgotten attendance found.")},error:o=>{this.errorMessage=o.message||"Error loading auto-generated absences",this.loading=!1,this.toastr.error(this.errorMessage)}})}openConfirmModal(t,o){const n=new window.bootstrap.Modal(document.getElementById("confirmActionModal")),r=document.getElementById("confirmActionModalLabel"),i=document.getElementById("confirmActionModalBody"),c=document.getElementById("confirmActionButton");if(r&&i&&c){r.innerText=`${o} Absence Request`;const u="string"==typeof t.teacherId?t.teacherId:t.teacherId.name||t.teacherId._id;i.innerHTML=`Are you sure you want to ${o.toLowerCase()} the absence for <strong>${u}</strong> on <strong>${new Date(t.date).toLocaleDateString()}</strong>? ${"Approved"===o?"This will mark them as Present.":"This will confirm their absence and deduct 1 leave day."}`,c.onclick=()=>this.updateAbsence(t._id,o)}n.show()}updateAbsence(t,o){this.loading=!0,this.absenceService.updateAbsence(t,{status:o}).subscribe({next:()=>{this.absences=this.absences.filter(i=>i._id!==t),this.loading=!1,this.toastr.success(`Absence request ${"Approved"===o?"approved":"rejected"} successfully`),window.bootstrap.Modal.getInstance(document.getElementById("confirmActionModal")).hide()},error:n=>{this.errorMessage=n.message||"Error updating absence request",this.loading=!1,this.toastr.error(this.errorMessage)}})}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(M),e.rXU(p.u),e.rXU(P.Ix),e.rXU(y.tw))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-admin-teacher-absence"]],decls:44,vars:10,consts:[["noAbsences",""],[1,"container-fluid","py-6","bg-gray-50","min-h-screen"],[1,"row","justify-content-center"],[1,"col-12","col-lg-12"],[1,"card","bg-white","shadow-xl","rounded-xl","overflow-hidden"],[1,"card-header","bg-gradient-to-r","from-blue-600","to-blue-800","text-white","p-2"],[1,"text-xl","font-semibold",2,"color","whitesmoke"],[1,"card-body","p-6"],[1,"filter-section","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"custom-input-wrapper"],["for","startDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","startDate",1,"custom-input",3,"ngModelChange","ngModel"],["for","endDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","endDate",1,"custom-input",3,"ngModelChange","ngModel"],["for","teacherFilter",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","teacherFilter","placeholder","Search by ID or Name",1,"custom-input",3,"ngModelChange","ngModel"],[1,"flex","items-end"],[1,"btn-primary","w-full",3,"click"],["class","data-grid-wrapper overflow-x-auto",4,"ngIf","ngIfElse"],["class","loading-overlay",4,"ngIf"],["class","alert alert-danger mb-4",4,"ngIf"],["id","confirmActionModal","tabindex","-1","aria-labelledby","confirmActionModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","rounded-lg","shadow-lg"],[1,"modal-header","bg-blue-600","text-white"],["id","confirmActionModalLabel",1,"modal-title","font-semibold"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close","btn-close-white"],["id","confirmActionModalBody",1,"modal-body","text-gray-700"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn-cancel"],["type","button","id","confirmActionButton",1,"btn-confirm",3,"disabled"],["class","spinner",4,"ngIf"],[1,"data-grid-wrapper","overflow-x-auto"],[1,"data-grid","w-full"],[1,"bg-blue-50","sticky","top-0","z-10"],[2,"background-color","#2C3E50 !important","color","white"],[1,"p-2"],["class","hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","transition-colors"],[1,"profile-wrapper"],[1,"teacher-name"],[1,"p-2","actions"],["title","Approve this absence (mark as Present if auto-generated)",1,"btn-confirm",3,"click"],["title","Reject this absence (confirm absence if auto-generated)",1,"btn-cancel",3,"click"],[1,"text-center","py-6","text-gray-500"],[1,"fas","fa-exclamation-circle","text-2xl","mb-2"],[1,"loading-overlay"],[1,"spinner"],[1,"alert","alert-danger","mb-4"]],template:function(o,n){if(1&o){const r=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"h2",6),e.EFF(6,"Manage Teacher Absences"),e.k0s()(),e.j41(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10)(11,"label",11),e.EFF(12,"Start Date"),e.k0s(),e.j41(13,"input",12),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.selectedStartDate,c)||(n.selectedStartDate=c),e.Njj(c)}),e.bIt("ngModelChange",function(){return e.eBV(r),e.Njj(n.loadPendingAbsences())}),e.k0s()(),e.j41(14,"div",10)(15,"label",13),e.EFF(16,"End Date"),e.k0s(),e.j41(17,"input",14),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.selectedEndDate,c)||(n.selectedEndDate=c),e.Njj(c)}),e.bIt("ngModelChange",function(){return e.eBV(r),e.Njj(n.loadPendingAbsences())}),e.k0s()(),e.j41(18,"div",10)(19,"label",15),e.EFF(20,"Teacher ID/Name"),e.k0s(),e.j41(21,"input",16),e.mxI("ngModelChange",function(c){return e.eBV(r),e.DH7(n.teacherIdFilter,c)||(n.teacherIdFilter=c),e.Njj(c)}),e.bIt("ngModelChange",function(){return e.eBV(r),e.Njj(n.loadPendingAbsences())}),e.k0s()(),e.j41(22,"div",17)(23,"button",18),e.bIt("click",function(){return e.eBV(r),e.Njj(n.loadPendingAbsences())}),e.EFF(24,"Search"),e.k0s()()()(),e.DNE(25,ie,20,1,"div",19)(26,se,4,0,"ng-template",null,0,e.C5r)(28,ce,2,0,"div",20)(29,de,2,1,"div",21),e.k0s()()()(),e.j41(30,"div",22)(31,"div",23)(32,"div",24)(33,"div",25)(34,"h5",26),e.EFF(35,"Confirm Action"),e.k0s(),e.nrm(36,"button",27),e.k0s(),e.nrm(37,"div",28),e.j41(38,"div",29)(39,"button",30),e.EFF(40,"Cancel"),e.k0s(),e.j41(41,"button",31),e.DNE(42,le,1,0,"span",32),e.EFF(43," Confirm "),e.k0s()()()()()()}if(2&o){const r=e.sdS(27);e.R7$(3),e.Y8G("@slideInOut",void 0),e.R7$(10),e.R50("ngModel",n.selectedStartDate),e.R7$(4),e.R50("ngModel",n.selectedEndDate),e.R7$(4),e.R50("ngModel",n.teacherIdFilter),e.R7$(4),e.Y8G("ngIf",n.absences.length>0)("ngIfElse",r),e.R7$(3),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",n.errorMessage),e.R7$(12),e.Y8G("disabled",n.loading),e.R7$(),e.Y8G("ngIf",n.loading)}},dependencies:[h.MD,h.Sq,h.bT,h.vh,s.X1,s.me,s.BC,s.YN,s.vS],styles:['@import"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap";.container-fluid[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f5f7fa;padding-top:1.5rem;padding-bottom:1.5rem}.card[_ngcontent-%COMP%]{border:none;border-radius:.75rem;overflow:hidden;box-shadow:0 4px 12px #0000000d;transition:transform .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}.card-header[_ngcontent-%COMP%]{padding:1.5rem;background:linear-gradient(90deg,#4a90e2,#63b3ed);color:#fff}.card-body[_ngcontent-%COMP%]{padding:2rem}.filter-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.custom-input-wrapper[_ngcontent-%COMP%]{position:relative}.custom-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;border:2px solid #e2e8f0;border-radius:.5rem;background:#fff;font-size:.95rem;color:#2d3748;transition:border-color .3s ease,box-shadow .3s ease}.custom-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e233}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4a90e2,#50c9c3);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#357abd,#4a90e2);transform:translateY(-2px)}.btn-confirm[_ngcontent-%COMP%]{background:linear-gradient(90deg,#2ecc71,#27ae60);color:#fff;padding:.5rem 1rem;border:none;border-radius:.5rem;font-weight:500;transition:background .3s ease}.btn-confirm[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#27ae60,#2ecc71)}.btn-cancel[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;padding:.5rem 1rem;border:none;border-radius:.5rem;font-weight:500;transition:background .3s ease}.btn-cancel[_ngcontent-%COMP%]:hover{background:#c0392b}.data-grid-wrapper[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:.5rem}.data-grid[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0}.data-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#2c3e50!important;color:#fff;font-weight:500;padding:.75rem;text-align:left;border-bottom:2px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fafafa}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#edf2f7}.profile-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.teacher-name[_ngcontent-%COMP%]{font-weight:500;color:#2d3748}.alert-danger[_ngcontent-%COMP%]{background-color:#fef2f2;border-color:#fee2e2;color:#dc2626;padding:.75rem 1.25rem;border-radius:.5rem;margin-bottom:1rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000001a;display:flex;justify-content:center;align-items:center;z-index:20}.spinner[_ngcontent-%COMP%]{width:2rem;height:2rem;border:3px solid #f3f3f3;border-top:3px solid #4a90e2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.grid-cols-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;font-size:.9rem}.btn-primary[_ngcontent-%COMP%], .btn-confirm[_ngcontent-%COMP%], .btn-cancel[_ngcontent-%COMP%]{width:100%;padding:.5rem}}'],data:{animation:[(0,m.hZ)("slideInOut",[(0,m.kY)(":enter",[(0,m.iF)({transform:"translateY(-100%)",opacity:0}),(0,m.i0)("300ms ease-out",(0,m.iF)({transform:"translateY(0)",opacity:1}))]),(0,m.kY)(":leave",[(0,m.i0)("300ms ease-in",(0,m.iF)({transform:"translateY(-100%)",opacity:0}))])])]}})}}return a})()},{path:"approve-leaves",component:N,canActivate:[b.q],data:{roles:["admin"]}}]},7917:(k,v,g)=>{g.d(v,{O:()=>C});var b=g(1626),s=g(9437),h=g(8810),m=g(2525),e=g(4438);let C=(()=>{class _{constructor(l){this.httpClient=l,this.apiUrl=m.c.apiUrl}createTeacher(l){return this.httpClient.post(`${this.apiUrl}/api/teachers/add`,l,{reportProgress:!0,observe:"events"}).pipe((0,s.W)(this.handleError))}getTeachersBySchool(l){let p=new b.Nl;return l&&Object.keys(l).forEach(f=>{null!=l[f]&&""!==l[f]&&(p=p.set(f,l[f].toString()))}),this.httpClient.get(`${this.apiUrl}/api/teachers/list`,{params:p}).pipe((0,s.W)(this.handleError))}getTeachers(){return this.getTeachersBySchool()}markAttendance(l){return this.httpClient.post(`${this.apiUrl}/api/teacher-attendance/mark`,l).pipe((0,s.W)(this.handleError))}getTeacherById(l){return this.httpClient.get(`${this.apiUrl}/api/teachers/${l}`).pipe((0,s.W)(this.handleError))}updateTeacher(l,p){return this.httpClient.put(`${this.apiUrl}/api/teachers/${l}`,p,{reportProgress:!0,observe:"events"}).pipe((0,s.W)(this.handleError))}softDeleteTeacher(l){return this.httpClient.delete(`${this.apiUrl}/api/teachers/${l}`).pipe((0,s.W)(this.handleError))}deleteTeacher(l){return this.softDeleteTeacher(l)}downloadTeachersExcel(){return this.httpClient.get(`${this.apiUrl}/api/teachers/export`,{responseType:"blob"}).pipe((0,s.W)(this.handleError))}uploadTeacherPhoto(l,p){return this.httpClient.put(`${this.apiUrl}/api/teachers/${l}/photo`,p).pipe((0,s.W)(this.handleError))}handleError(l){let p="An unknown error occurred!";return p=l.error instanceof ErrorEvent?`Client Error: ${l.error.message}`:`Server Error: ${l.status} - ${l.error?.message||l.message}`,console.error("TeacherService Error:",p),(0,h.$)(()=>new Error(p))}getTeacher(l){return this.getTeacherById(l)}createPortal(l,p){return this.httpClient.post(`${this.apiUrl}/api/teachers/${l}/portal`,{role:p}).pipe((0,s.W)(this.handleError))}static{this.\u0275fac=function(p){return new(p||_)(e.KVO(b.Qq))}}static{this.\u0275prov=e.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()}}]);