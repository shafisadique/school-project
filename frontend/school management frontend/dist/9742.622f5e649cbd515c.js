"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[9742],{9742:(M,d,a)=>{a.r(d),a.d(d,{TeacherUpdateComponent:()=>y});var i=a(9417),h=a(1413),c=a(6977),m=a(1626),f=a(177),g=a(3413),p=a(2716),e=a(4438),_=a(7917),u=a(749),E=a(5794);function F(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," Name is required "),e.k0s())}function v(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," Minimum 2 characters "),e.k0s())}function b(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," 10 digits only "),e.k0s())}function j(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," Gender required "),e.k0s())}function C(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," Designation required "),e.k0s())}function P(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," Select at least one subject "),e.k0s())}function k(o,l){if(1&o&&(e.j41(0,"div",49),e.EFF(1),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.JRh(t.fileError)}}function x(o,l){if(1&o&&(e.j41(0,"div",50),e.nrm(1,"img",51),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.Y8G("src",t.imagePreview,e.B4B)}}function T(o,l){if(1&o&&(e.j41(0,"div",22)(1,"div",52),e.EFF(2),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.JRh(t.serverError)}}function D(o,l){1&o&&e.nrm(0,"span",53)}function O(o,l){1&o&&(e.j41(0,"div",49),e.EFF(1," 10 digits only "),e.k0s())}function I(o,l){if(1&o){const t=e.RV6();e.j41(0,"form",5),e.bIt("ngSubmit",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.onSubmit())}),e.j41(1,"div",6)(2,"fieldset",7)(3,"legend"),e.EFF(4,"Personal Details"),e.k0s(),e.j41(5,"div",6)(6,"div",8)(7,"label",9),e.EFF(8,"Name "),e.j41(9,"span",10),e.EFF(10,"*"),e.k0s()(),e.nrm(11,"input",11),e.DNE(12,F,2,0,"div",12)(13,v,2,0,"div",12),e.k0s(),e.j41(14,"div",8)(15,"label",9),e.EFF(16,"Email"),e.k0s(),e.nrm(17,"input",13),e.k0s(),e.j41(18,"div",14)(19,"label",9),e.EFF(20,"Phone"),e.k0s(),e.nrm(21,"input",15),e.DNE(22,b,2,0,"div",12),e.k0s(),e.j41(23,"div",14)(24,"label",9),e.EFF(25,"Gender "),e.j41(26,"span",10),e.EFF(27,"*"),e.k0s()(),e.j41(28,"select",16)(29,"option",17),e.EFF(30,"Select"),e.k0s(),e.j41(31,"option",18),e.EFF(32,"Male"),e.k0s(),e.j41(33,"option",19),e.EFF(34,"Female"),e.k0s(),e.j41(35,"option",20),e.EFF(36,"Other"),e.k0s()(),e.DNE(37,j,2,0,"div",12),e.k0s(),e.j41(38,"div",14)(39,"label",9),e.EFF(40,"Designation "),e.j41(41,"span",10),e.EFF(42,"*"),e.k0s()(),e.nrm(43,"input",21),e.DNE(44,C,2,0,"div",12),e.k0s(),e.j41(45,"div",22)(46,"label",9),e.EFF(47,"Status "),e.j41(48,"span",10),e.EFF(49,"*"),e.k0s()(),e.j41(50,"select",23)(51,"option",24),e.EFF(52,"Active"),e.k0s(),e.j41(53,"option",24),e.EFF(54,"Inactive"),e.k0s()()(),e.j41(55,"div",8)(56,"label"),e.EFF(57,"Qualification"),e.k0s(),e.nrm(58,"input",25),e.k0s(),e.j41(59,"div",8)(60,"label"),e.EFF(61,"Joining Date"),e.k0s(),e.nrm(62,"input",26),e.k0s(),e.j41(63,"div",8)(64,"label"),e.EFF(65,"Date of Birth"),e.k0s(),e.nrm(66,"input",27),e.k0s()()(),e.j41(67,"fieldset",7)(68,"legend"),e.EFF(69,"Professional Details"),e.k0s(),e.j41(70,"div",6)(71,"div",22)(72,"label",9),e.EFF(73,"Subjects Taught "),e.j41(74,"span",10),e.EFF(75,"*"),e.k0s()(),e.nrm(76,"ng-select",28),e.DNE(77,P,2,0,"div",12),e.k0s()()(),e.j41(78,"fieldset",7)(79,"legend"),e.EFF(80,"Profile Picture"),e.k0s(),e.j41(81,"div",29)(82,"div",8)(83,"label",9),e.EFF(84,"Upload New Profile Picture (Optional)"),e.k0s(),e.j41(85,"input",30),e.bIt("change",function(n){e.eBV(t);const s=e.XpG();return e.Njj(s.onFileSelect(n))}),e.k0s(),e.DNE(86,k,2,1,"div",12),e.k0s(),e.DNE(87,x,2,1,"div",31),e.k0s()(),e.DNE(88,T,3,1,"div",32),e.j41(89,"div",33)(90,"button",34),e.DNE(91,D,1,0,"span",35),e.EFF(92),e.k0s()()(),e.j41(93,"fieldset",7)(94,"legend"),e.EFF(95,"Additional Details (Optional)"),e.k0s(),e.j41(96,"div",6)(97,"div",8)(98,"label",9),e.EFF(99,"Address"),e.k0s(),e.nrm(100,"textarea",36),e.k0s(),e.j41(101,"div",8)(102,"label",9),e.EFF(103,"Blood Group"),e.k0s(),e.j41(104,"select",37)(105,"option",17),e.EFF(106,"Select"),e.k0s(),e.j41(107,"option",38),e.EFF(108,"A+"),e.k0s(),e.j41(109,"option",39),e.EFF(110,"A-"),e.k0s(),e.j41(111,"option",40),e.EFF(112,"B+"),e.k0s(),e.j41(113,"option",41),e.EFF(114,"B-"),e.k0s(),e.j41(115,"option",42),e.EFF(116,"O+"),e.k0s(),e.j41(117,"option",43),e.EFF(118,"O-"),e.k0s(),e.j41(119,"option",44),e.EFF(120,"AB+"),e.k0s(),e.j41(121,"option",45),e.EFF(122,"AB-"),e.k0s()()(),e.j41(123,"div",8)(124,"label",9),e.EFF(125,"Emergency Contact Name"),e.k0s(),e.nrm(126,"input",46),e.k0s(),e.j41(127,"div",8)(128,"label",9),e.EFF(129,"Emergency Contact Phone"),e.k0s(),e.nrm(130,"input",47),e.DNE(131,O,2,0,"div",12),e.k0s(),e.j41(132,"div",8)(133,"label",9),e.EFF(134,"Leave Balance (days)"),e.k0s(),e.nrm(135,"input",48),e.k0s()()()()}if(2&o){const t=e.XpG();e.Y8G("formGroup",t.form),e.R7$(12),e.Y8G("ngIf",t.submitted&&(null==t.f.name.errors?null:t.f.name.errors.required)),e.R7$(),e.Y8G("ngIf",t.submitted&&(null==t.f.name.errors?null:t.f.name.errors.minlength)),e.R7$(9),e.Y8G("ngIf",t.submitted&&(null==t.f.phone.errors?null:t.f.phone.errors.pattern)),e.R7$(15),e.Y8G("ngIf",t.submitted&&(null==t.f.gender.errors?null:t.f.gender.errors.required)),e.R7$(7),e.Y8G("ngIf",t.submitted&&(null==t.f.designation.errors?null:t.f.designation.errors.required)),e.R7$(7),e.Y8G("value",!0),e.R7$(2),e.Y8G("value",!1),e.R7$(23),e.Y8G("items",t.subjectsList)("multiple",!0)("closeOnSelect",!1),e.R7$(),e.Y8G("ngIf",t.submitted&&(null==t.f.subjects.errors?null:t.f.subjects.errors.minlength)),e.R7$(9),e.Y8G("ngIf",t.fileError),e.R7$(),e.Y8G("ngIf",t.imagePreview),e.R7$(),e.Y8G("ngIf",t.serverError),e.R7$(2),e.Y8G("disabled",t.loading||t.form.invalid),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.SpI(" ",t.loading?"Updating...":"Update Teacher"," "),e.R7$(39),e.Y8G("ngIf",t.submitted&&(null==t.f.emergencyContactPhone.errors?null:t.f.emergencyContactPhone.errors.pattern))}}let y=(()=>{class o{constructor(t,r,n,s,U){this.fb=t,this.teacherSvc=r,this.route=n,this.router=s,this.toastr=U,this.submitted=!1,this.loading=!1,this.uploadProgress=0,this.subjectsList=["English","Hindi","Mathematics","Environmental Science","General Knowledge","Arts","Science","Social Science","Music"],this.selectedFile=null,this.imagePreview=null,this.fileError="",this.serverError="",this.teacherId=null,this.destroy$=new h.B,this.schoolId=localStorage.getItem("schoolId")}ngOnInit(){if(this.teacherId=this.route.snapshot.paramMap.get("teacherId"),!this.teacherId)return this.toastr.error("Invalid teacher ID"),void this.router.navigate(["/teacher/teacher-details"]);this.initForm(),this.loadTeacher()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initForm(){this.form=this.fb.group({name:["",[i.k0.required,i.k0.minLength(2),i.k0.maxLength(100)]],email:[""],phone:["",[i.k0.pattern(/^\d{10}$/)]],gender:["",i.k0.required],qualification:[""],joiningDate:[""],dateOfBirth:[""],address:[""],bloodGroup:[""],emergencyContactName:[""],emergencyContactPhone:["",i.k0.pattern(/^\d{10}$/)],status:[!0],designation:["",i.k0.required],subjects:[[],[i.k0.required,i.k0.minLength(1)]],leaveBalance:[0,[i.k0.min(0)]]})}get f(){return this.form.controls}loadTeacher(){this.teacherSvc.getTeacherById(this.teacherId).pipe((0,c.Q)(this.destroy$)).subscribe({next:t=>{const r=t.data;this.form.patchValue({name:r.name,email:r.email||"",phone:r.phone||"",gender:r.gender,designation:r.designation||"",qualification:r.qualification||"",joiningDate:r.joiningDate?r.joiningDate.split("T")[0]:"",dateOfBirth:r.dateOfBirth?r.dateOfBirth.split("T")[0]:"",experienceYears:r.experienceYears||null,address:r.address||"",bloodGroup:r.bloodGroup||"",emergencyContactName:r.emergencyContactName||"",emergencyContactPhone:r.emergencyContactPhone||"",status:r.status,leaveBalance:r.leaveBalance||0});const n=[];r.subjects&&r.subjects.length>0&&r.subjects.forEach(s=>{this.subjectsList.includes(s)&&n.push(s)}),this.form.patchValue({subjects:n}),r.profileImageUrl?this.imagePreview=r.profileImageUrl:r.profileImage&&(this.imagePreview=r.profileImage.startsWith("http")?r.profileImage:`http://localhost:5675/api/proxy-image/${encodeURIComponent(r.profileImage)}`)},error:t=>{this.serverError=this.parseError(t),this.toastr.error("Failed to load teacher details"),this.router.navigate(["/teacher/teacher-details"])}})}onFileSelect(t){const r=t.target.files[0];if(!r)return;if(!["image/png","image/jpeg","image/jpg"].includes(r.type))return void(this.fileError="Only PNG/JPG/JPEG allowed");if(r.size>2097152)return void(this.fileError="Max 2 MB");this.selectedFile=r,this.fileError="";const n=new FileReader;n.onload=()=>this.imagePreview=n.result,n.readAsDataURL(r)}onSubmit(){if(this.submitted=!0,this.serverError="",this.form.invalid)return;this.loading=!0,this.uploadProgress=0;const t=this.buildUpdateData(this.form.value),r=new FormData;for(const[n,s]of Object.entries(t))"subjects"===n?Array.isArray(s)&&s.length>0&&r.append(n,JSON.stringify(s)):null!=s&&""!==s&&r.append(n,s.toString());this.teacherSvc.updateTeacher(this.teacherId,r).pipe((0,c.Q)(this.destroy$)).subscribe({next:n=>{switch(n.type){case m.hv.UploadProgress:this.uploadProgress=Math.round(100*n.loaded/(n.total||1));break;case m.hv.Response:console.log("Update response:",n.body),this.handleUpdateSuccess(n.body)}},error:n=>{this.loading=!1,this.uploadProgress=0,this.serverError=this.parseError(n),this.toastr.error(n.error?.message||"Failed to update teacher","Error"),console.error("Full error:",n)}})}handleUpdateSuccess(t){if(this.loading=!1,this.uploadProgress=0,this.selectedFile){const r=new FormData;r.append("profileImage",this.selectedFile),this.teacherSvc.uploadTeacherPhoto(this.teacherId,r).pipe((0,c.Q)(this.destroy$)).subscribe({next:()=>{this.toastr.success("Teacher updated successfully (with photo)"),this.router.navigate(["/teacher/teacher-details"])},error:n=>{this.toastr.warning("Teacher updated, but failed to upload profile picture"),this.router.navigate(["/teacher/teacher-details"])}})}else this.toastr.success("Teacher updated successfully"),this.router.navigate(["/teacher/teacher-details"])}buildUpdateData(t){const r={};["name","email","phone","gender","status","designation"].forEach(s=>{if(null!=t[s]&&""!==t[s]){if("phone"===s&&!/^\d{10}$/.test(t[s]))return;r[s]=t[s].trim?t[s].trim():t[s]}});const n=[];return t.subjects&&t.subjects.length>0&&(t.subjects.forEach(s=>{this.subjectsList.includes(s)&&n.push(s)}),r.subjects=n),r}parseError(t){return t.error?.message||"Server error"}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(i.ok),e.rXU(_.O),e.rXU(u.nX),e.rXU(u.Ix),e.rXU(E.tw))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-teacher-update"]],decls:5,vars:1,consts:[[1,"container-fluid","py-3","py-md-4"],[1,"row","justify-content-center"],[1,"col-12","col-lg-10","col-xl-9"],["cardTitle","Update Teacher"],["novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"form-section"],[1,"col-12","col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","name","placeholder","Full name",1,"form-control","form-control-sm"],["class","text-danger small mt-1",4,"ngIf"],["type","email","formControlName","email","placeholder","teacher@example.com",1,"form-control","form-control-sm"],[1,"col-12","col-md-4"],["type","text","formControlName","phone","placeholder","10 digits",1,"form-control","form-control-sm"],["formControlName","gender",1,"form-select","form-select-sm"],["value",""],["value","Male"],["value","Female"],["value","Other"],["type","text","formControlName","designation","placeholder","e.g., Math Teacher",1,"form-control","form-control-sm"],[1,"col-12"],["formControlName","status",1,"form-select","form-select-sm"],[3,"value"],["type","text","formControlName","qualification",1,"form-control","form-control-sm"],["type","date","formControlName","joiningDate",1,"form-control","form-control-sm"],["type","date","formControlName","dateOfBirth",1,"form-control","form-control-sm"],["formControlName","subjects","placeholder","Select subjects",1,"form-select-sm",3,"items","multiple","closeOnSelect"],[1,"row","g-3","align-items-center"],["type","file","accept","image/png,image/jpeg,image/jpg",1,"form-control","form-control-sm",3,"change"],["class","col-12 col-md-6 text-center",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"col-12","d-flex","justify-content-end","gap-2"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],["formControlName","address","rows","2",1,"form-control","form-control-sm"],["formControlName","bloodGroup",1,"form-select","form-select-sm"],["value","A+"],["value","A-"],["value","B+"],["value","B-"],["value","O+"],["value","O-"],["value","AB+"],["value","AB-"],["type","text","formControlName","emergencyContactName",1,"form-control","form-control-sm"],["type","text","formControlName","emergencyContactPhone","placeholder","10 digits",1,"form-control","form-control-sm"],["type","number","min","0","formControlName","leaveBalance",1,"form-control","form-control-sm"],[1,"text-danger","small","mt-1"],[1,"col-12","col-md-6","text-center"],["alt","Preview",1,"img-thumbnail",2,"max-height","110px",3,"src"],[1,"alert","alert-danger","small","p-2"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(r,n){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-card",3),e.DNE(4,I,136,19,"form",4),e.k0s()()()()),2&r&&(e.R7$(4),e.Y8G("ngIf",n.form))},dependencies:[f.MD,f.bT,i.X1,i.qT,i.xH,i.y7,i.me,i.Q0,i.wz,i.BC,i.cb,i.VZ,i.j4,i.JD,g.i,p.MQ,p.vr],styles:[".form-section[_ngcontent-%COMP%]{border:1px solid #e3e6f0;border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;background:#fafbfe}.form-section[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:.95rem;font-weight:600;text-transform:uppercase;letter-spacing:.8px;padding:.5rem 1rem;border-radius:6px;width:auto;float:none;margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#2d3748;font-size:.9rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #cbd5e0}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#667eea;box-shadow:0 0 0 .2rem #667eea40}.text-danger[_ngcontent-%COMP%]{font-size:.8rem}.img-thumbnail[_ngcontent-%COMP%]{border:2px solid #e2e8f0;border-radius:8px}button[disabled][_ngcontent-%COMP%]{opacity:.65;cursor:not-allowed}@media (max-width: 576px){.form-section[_ngcontent-%COMP%]{padding:1rem}legend[_ngcontent-%COMP%]{font-size:.85rem;padding:.4rem .8rem}}"]})}}return o})()}}]);