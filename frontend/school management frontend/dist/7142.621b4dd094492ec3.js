"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[7142],{965:(C,k,m)=>{m.d(k,{y:()=>t});var g=m(2525),o=m(4438),f=m(1626);let t=(()=>{class p{constructor(l){this.http=l,this.baseUrl=`${g.c.apiUrl}/api/academicyear`}createAcademicYear(l){return this.http.post(`${this.baseUrl}/create`,l)}editAcademicYear(l){return this.http.put(`${this.baseUrl}/edit`,l)}getActiveAcademicYear(l){return this.http.get(`${this.baseUrl}/active/${l}`)}getAllAcademicYears(l){return this.http.get(`${this.baseUrl}/${l}`)}activateAcademicYear(l,u){return this.http.post(`${this.baseUrl}/activate/${u}`,{academicYearId:l})}setActiveAcademicYear(l,u){return this.http.post(`${this.baseUrl}/set`,{schoolId:l,academicYearId:u})}getNextAcademicYear(l,u){return this.http.get(`${this.baseUrl}/next/${l}?schoolId=${u}`)}static{this.\u0275fac=function(u){return new(u||p)(o.KVO(f.Qq))}}static{this.\u0275prov=o.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},3891:(C,k,m)=>{m.d(k,{e:()=>t});var g=m(1626),o=m(2525),f=m(4438);let t=(()=>{class p{constructor(l){this.http=l,this.apiUrl=o.c.apiUrl}getClassesBySchool(l){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${l}`)}getStudentsByClass(l,u){const h=`${this.apiUrl}/api/students/get-student-by-class/${l}`,_=(new g.Nl).set("academicYearId",u);return this.http.get(h,{params:_})}assignRollNumbers(l){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${l}`,{})}assignRollNumbersAlphabetically(l){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${l}`,{})}assignRollNumberToStudent(l,u){return this.http.put(`${this.apiUrl}/api/students/${l}/assign-roll-number`,{rollNo:u})}createClass(l){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,l)}deleteAssignment(l){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:l})}createSubject(l){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,l)}getSubjects(l){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${l}`)}getTeachers(l){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${l}`)}getCombinedAssignments(l,u){const h=(new g.Nl).set("academicYearId",u);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${l}`,{params:h})}assignSubjectToClass(l,u,h,_){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:l,subjectId:u,teacherId:h,academicYearId:_})}updateAssignment(l){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,l)}getAssignmentsByTeacher(l,u,h){let _=(new g.Nl).set("academicYearId",u);return h&&(_=_.set("date",h)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${l}`,{params:_})}updateAttendanceTeachers(l,u,h){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:l,attendanceTeacher:u,substituteAttendanceTeachers:h})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(u){return new(u||p)(f.KVO(g.Qq))}}static{this.\u0275prov=f.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},7142:(C,k,m)=>{m.r(k),m.d(k,{resultRouter:()=>At});var g=m(177),o=m(9417),f=m(9969),t=m(4438),p=m(4525),R=m(965),l=m(4977),u=m(6561),h=m(5794),_=m(749);const I=(s,i)=>({"text-success fw-bold":s,"text-danger fw-bold":i}),v=(s,i)=>({"bg-success":s,"bg-danger":i}),M=(s,i)=>({"text-success":s,"text-danger":i});function O(s,i){if(1&s&&(t.j41(0,"option",21),t.EFF(1),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.JRh(e.name)}}function P(s,i){if(1&s&&(t.j41(0,"option",21),t.EFF(1),t.k0s()),2&s){const e=i.$implicit,a=t.XpG();t.Y8G("value",e._id),t.R7$(),t.JRh(a.getExamDisplayName(e))}}function y(s,i){if(1&s){const e=t.RV6();t.j41(0,"tr",33)(1,"td")(2,"div",34)(3,"div",35),t.EFF(4),t.k0s(),t.j41(5,"span",36),t.EFF(6),t.k0s()()(),t.j41(7,"td",36),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td",30)(12,"span",37),t.EFF(13),t.k0s()(),t.j41(14,"td",38),t.EFF(15),t.nI1(16,"number"),t.k0s(),t.j41(17,"td",30)(18,"span",39),t.EFF(19),t.k0s()(),t.j41(20,"td",30)(21,"button",40),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.toggleRow(n._id))}),t.nrm(22,"i",41),t.k0s(),t.j41(23,"button",42),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.editResult(n._id))}),t.nrm(24,"i",43),t.k0s(),t.j41(25,"button",44),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.deleteResult(n._id))}),t.nrm(26,"i",45),t.k0s()()()}if(2&s){const e=i.$implicit,a=t.XpG(2);t.AVh("table-light",a.expandedRows[e._id]),t.R7$(4),t.SpI(" ",e.studentId.name.charAt(0).toUpperCase()," "),t.R7$(2),t.JRh(e.studentId.name),t.R7$(2),t.JRh(e.studentId.rollNo||"N/A"),t.R7$(2),t.JRh(e.examId.examTitle),t.R7$(3),t.Lme("",e.totalMarksObtained," / ",e.totalMaxMarks,""),t.R7$(),t.Y8G("ngClass",t.l_i(16,I,e.percentage>=33,e.percentage<33)),t.R7$(),t.SpI(" ",t.i5U(16,13,e.percentage,"1.1-1"),"% "),t.R7$(3),t.Y8G("ngClass",t.l_i(19,v,"Pass"===e.status,"Fail"===e.status)),t.R7$(),t.SpI(" ",e.status," "),t.R7$(4),t.Y8G("disabled",!e.subjectId)}}function $(s,i){if(1&s){const e=t.RV6();t.j41(0,"tr")(1,"td",46),t.nrm(2,"i",47),t.j41(3,"p",25),t.EFF(4,"No results found for the selected exam."),t.k0s(),t.j41(5,"button",48),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.navigateToCreateResult())}),t.EFF(6,"Create First Result"),t.k0s()()()}}function S(s,i){if(1&s&&(t.j41(0,"div",8)(1,"div",22)(2,"h5",23),t.nrm(3,"i",24),t.EFF(4,"Results Overview "),t.k0s(),t.j41(5,"small",25),t.EFF(6),t.k0s()(),t.j41(7,"div",26)(8,"div",27)(9,"table",28)(10,"thead",29)(11,"tr")(12,"th"),t.EFF(13,"Student Name"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Roll No"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Exam"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Total Marks"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Percentage"),t.k0s(),t.j41(22,"th"),t.EFF(23,"Status"),t.k0s(),t.j41(24,"th",30),t.EFF(25,"Actions"),t.k0s()()(),t.j41(26,"tbody"),t.DNE(27,y,27,22,"tr",31)(28,$,7,0,"tr",32),t.k0s()()()()()),2&s){const e=t.XpG();t.R7$(6),t.SpI("",e.results.length," results found"),t.R7$(21),t.Y8G("ngForOf",e.results),t.R7$(),t.Y8G("ngIf",0===e.results.length)}}function Y(s,i){if(1&s&&(t.j41(0,"tr",33)(1,"td",36),t.EFF(2),t.k0s(),t.j41(3,"td",30),t.EFF(4),t.k0s(),t.j41(5,"td",30),t.EFF(6),t.k0s(),t.j41(7,"td",38),t.EFF(8),t.nI1(9,"number"),t.k0s(),t.j41(10,"td",30)(11,"span",61),t.EFF(12),t.k0s()()()),2&s){const e=i.$implicit;t.R7$(2),t.JRh(e.subjectId.name),t.R7$(2),t.JRh(e.marksObtained||0),t.R7$(2),t.JRh(e.maxMarks||100),t.R7$(),t.Y8G("ngClass",t.l_i(10,M,e.marksObtained/e.maxMarks*100>=33,e.marksObtained/e.maxMarks*100<33)),t.R7$(),t.SpI(" ",t.i5U(9,7,e.marksObtained/e.maxMarks*100,"1.1-1"),"% "),t.R7$(3),t.Y8G("ngClass",t.l_i(13,v,e.marksObtained/e.maxMarks*100>=33,e.marksObtained/e.maxMarks*100<33)),t.R7$(),t.SpI(" ",e.marksObtained/e.maxMarks*100>=33?"Pass":"Fail"," ")}}function T(s,i){if(1&s){const e=t.RV6();t.j41(0,"div",51)(1,"div",52)(2,"h6",53),t.nrm(3,"i",5),t.EFF(4),t.k0s(),t.j41(5,"button",54),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,r=t.XpG();return t.Njj(r.toggleRow(n._id))}),t.nrm(6,"i",55),t.EFF(7," Close "),t.k0s()(),t.j41(8,"div",56)(9,"div",27)(10,"table",57)(11,"thead",58)(12,"tr")(13,"th"),t.EFF(14,"Subject"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Marks Obtained"),t.k0s(),t.j41(17,"th"),t.EFF(18,"Max Marks"),t.k0s(),t.j41(19,"th"),t.EFF(20,"Percentage"),t.k0s(),t.j41(21,"th"),t.EFF(22,"Status"),t.k0s()()(),t.j41(23,"tbody"),t.DNE(24,Y,13,16,"tr",59),t.k0s()()(),t.j41(25,"div",60)(26,"button",48),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,r=t.XpG();return t.Njj(r.printResult(n._id))}),t.EFF(27,"Print Result"),t.k0s()()()()}if(2&s){const e=t.XpG().$implicit;t.Y8G("@fadeIn",void 0),t.R7$(4),t.SpI("Subject Details for ",e.studentId.name," "),t.R7$(20),t.Y8G("ngForOf",e.subjects)}}function A(s,i){if(1&s&&(t.j41(0,"div",49),t.DNE(1,T,28,3,"div",50),t.k0s()),2&s){const e=i.$implicit,a=t.XpG();t.R7$(),t.Y8G("ngIf",a.expandedRows[e._id])}}let G=(()=>{class s{constructor(e,a,n,r,c,d){this.examService=e,this.academicYearService=a,this.resultService=n,this.authService=r,this.toastr=c,this.router=d,this.exams=[],this.academicYears=[],this.selectedExamId="",this.selectedAcademicYearId="",this.results=[],this.schoolId=null,this.expandedRows={},this.isLoadingAcademicYears=!1,this.isLoadingExams=!1,this.isLoadingResults=!1}ngOnInit(){if(this.schoolId=this.authService.getSchoolId(),!this.schoolId)return this.toastr.error("School ID missing. Log in again.","Error"),void this.router.navigate(["/auth/login"]);this.loadAcademicYears()}loadAcademicYears(){this.isLoadingAcademicYears=!0,this.academicYearService.getAllAcademicYears(this.schoolId).subscribe({next:e=>{if(this.academicYears=e,0===e.length)return this.toastr.warning("No academic years found.","Warning"),void(this.isLoadingAcademicYears=!1);this.loadActiveYear()},error:e=>{console.error("Years error:",e),this.toastr.error("Failed to load years.","Error"),this.isLoadingAcademicYears=!1}})}loadActiveYear(){this.academicYearService.getActiveAcademicYear(this.schoolId).subscribe({next:e=>{this.selectedAcademicYearId=e._id,this.loadExams()},error:e=>{console.error("Active year error:",e),this.toastr.error("Failed to load active year.","Error"),this.isLoadingAcademicYears=!1}})}loadExams(){if(!this.selectedAcademicYearId)return this.exams=[],void(this.results=[]);this.isLoadingExams=!0;const e=this.authService.getUserRole();"admin"===e?this.examService.getExamsBySchool(this.schoolId,this.selectedAcademicYearId).subscribe({next:a=>{this.exams=a,this.selectedExamId=a.length>0?a[0]._id:"",this.loadResults()},error:a=>{console.error(a),this.toastr.error("Failed to load exams.","Error"),this.exams=[]},complete:()=>this.isLoadingExams=!1}):"teacher"===e&&this.resultService.getExamsByTeacher().subscribe({next:a=>{this.exams=a,this.selectedExamId=a.length>0?a[0]._id:"",this.loadResults()},error:a=>{console.error(a),this.toastr.error("Failed to load exams.","Error"),this.exams=[]},complete:()=>this.isLoadingExams=!1})}loadResults(){this.selectedExamId?(this.isLoadingResults=!0,this.resultService.getResultsByExam(this.selectedExamId).subscribe({next:e=>{this.results=e.map(a=>this.transformResult(a)),0===this.results.length&&this.toastr.info("No results found.","Info"),this.isLoadingResults=!1},error:e=>{console.error("Results error:",e),this.toastr.error("Failed to load results.","Error"),this.results=[],this.isLoadingResults=!1},complete:()=>this.isLoadingResults=!1})):this.results=[]}transformResult(e){if(e.subjectId&&!e.subjects?.length)return{...e,subjects:[{subjectId:e.subjectId,marksObtained:e.marksObtained||0,maxMarks:e.maxMarks||100}],totalMarksObtained:e.marksObtained||0,totalMaxMarks:e.maxMarks||100,percentage:(e.marksObtained||0)/(e.maxMarks||100)*100,grade:(e.marksObtained||0)/(e.maxMarks||100)*100>=33?"Pass":"Fail",status:(e.marksObtained||0)/(e.maxMarks||100)*100>=33?"Pass":"Fail"};const a=e.subjects.reduce((c,d)=>c+(d.marksObtained||0),0),n=e.subjects.reduce((c,d)=>c+(d.maxMarks||0),0),r=n>0?a/n*100:0;return{...e,totalMarksObtained:a,totalMaxMarks:n,percentage:r,grade:r>=33?"Pass":"Fail",status:r>=33?"Pass":"Fail"}}getExamDisplayName(e){return`${e.examTitle} - ${e.classId?.name||"Unknown Class"}`}onAcademicYearChange(){this.selectedExamId="",this.loadExams()}onExamChange(){this.loadResults()}toggleRow(e){this.expandedRows[e]=!this.expandedRows[e]}editResult(e){this.router.navigate([`/result/edit/${e}`])}navigateToCreateResult(){this.selectedExamId?this.router.navigate(["/result/create"],{queryParams:{examId:this.selectedExamId}}):this.toastr.warning("Select an exam first.","Warning")}formatDate(e){return new Date(e).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"})}printResult(e){}deleteResult(e){}static{this.\u0275fac=function(a){return new(a||s)(t.rXU(p.R),t.rXU(R.y),t.rXU(l.L),t.rXU(u.u),t.rXU(h.tw),t.rXU(_.Ix))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-result-list"]],decls:35,vars:9,consts:[[1,"container-fluid","p-4"],[1,"row","mb-4"],[1,"col-12"],[1,"d-flex","justify-content-between","align-items-center","bg-white","p-3","rounded","shadow-sm"],[1,"mb-0","text-primary","fw-bold"],[1,"fas","fa-list","me-2"],[1,"btn","btn-primary","px-4","py-2",3,"click","disabled"],[1,"fas","fa-plus","me-1"],[1,"card","shadow-sm","border-0"],[1,"card-body","p-3"],[1,"row","g-3"],[1,"col-md-6"],["for","academicYear",1,"form-label","fw-medium"],[1,"text-danger"],["id","academicYear",1,"form-select",3,"ngModelChange","change","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","exam",1,"form-label","fw-medium"],["id","exam",1,"form-select",3,"ngModelChange","change","ngModel","disabled"],["class","card shadow-sm border-0",4,"ngIf"],["class","mt-3",4,"ngFor","ngForOf"],[3,"value"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center","p-3"],[1,"mb-0","fw-bold","text-dark"],[1,"fas","fa-table","me-2","text-primary"],[1,"text-muted"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-dark"],[1,"text-center"],["class","align-middle",3,"table-light",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"align-middle"],[1,"d-flex","align-items-center"],[1,"avatar","me-2","rounded-circle","bg-primary","text-white","d-flex","align-items-center","justify-content-center",2,"width","35px","height","35px","font-size","0.8rem"],[1,"fw-medium"],[1,"badge","bg-info","fs-6"],[1,"text-center",3,"ngClass"],[1,"badge","rounded-pill","px-3","py-2","fs-6",3,"ngClass"],["matTooltip","View Details",1,"btn","btn-sm","btn-outline-primary","me-1",3,"click"],[1,"fas","fa-eye"],["matTooltip","Edit Score",1,"btn","btn-sm","btn-outline-warning","me-1",3,"click","disabled"],[1,"fas","fa-edit"],["matTooltip","Delete Result",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],["colspan","7",1,"text-center","py-4"],[1,"fas","fa-file-alt","fa-3x","text-muted","mb-3"],[1,"btn","btn-primary",3,"click"],[1,"mt-3"],["class","card shadow-sm border-left-primary",4,"ngIf"],[1,"card","shadow-sm","border-left-primary"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0","fw-bold","text-primary"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"fas","fa-times"],[1,"card-body"],[1,"table","table-sm","table-bordered"],[1,"table-light"],["class","align-middle",4,"ngFor","ngForOf"],[1,"mt-3","text-center"],[1,"badge","rounded-pill","px-2","py-1",3,"ngClass"]],template:function(a,n){1&a&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),t.nrm(5,"i",5),t.EFF(6,"Result List "),t.k0s(),t.j41(7,"button",6),t.bIt("click",function(){return n.navigateToCreateResult()}),t.nrm(8,"i",7),t.EFF(9,"Create Result "),t.k0s()()()(),t.j41(10,"div",1)(11,"div",2)(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"label",12),t.EFF(17,"Academic Year "),t.j41(18,"span",13),t.EFF(19,"*"),t.k0s()(),t.j41(20,"select",14),t.mxI("ngModelChange",function(c){return t.DH7(n.selectedAcademicYearId,c)||(n.selectedAcademicYearId=c),c}),t.bIt("change",function(){return n.onAcademicYearChange()}),t.j41(21,"option",15),t.EFF(22,"Select Academic Year"),t.k0s(),t.DNE(23,O,2,2,"option",16),t.k0s()(),t.j41(24,"div",11)(25,"label",17),t.EFF(26,"Exam "),t.j41(27,"span",13),t.EFF(28,"*"),t.k0s()(),t.j41(29,"select",18),t.mxI("ngModelChange",function(c){return t.DH7(n.selectedExamId,c)||(n.selectedExamId=c),c}),t.bIt("change",function(){return n.onExamChange()}),t.j41(30,"option",15),t.EFF(31,"Select Exam"),t.k0s(),t.DNE(32,P,2,2,"option",16),t.k0s()()()()()()(),t.DNE(33,S,29,3,"div",19)(34,A,2,1,"div",20),t.k0s()),2&a&&(t.R7$(7),t.Y8G("disabled",n.isLoadingExams||n.isLoadingAcademicYears),t.R7$(13),t.R50("ngModel",n.selectedAcademicYearId),t.Y8G("disabled",n.isLoadingAcademicYears),t.R7$(3),t.Y8G("ngForOf",n.academicYears),t.R7$(6),t.R50("ngModel",n.selectedExamId),t.Y8G("disabled",n.isLoadingExams||!n.selectedAcademicYearId),t.R7$(3),t.Y8G("ngForOf",n.exams),t.R7$(),t.Y8G("ngIf",!n.isLoadingResults),t.R7$(),t.Y8G("ngForOf",n.results))},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.QX,o.YN,o.xH,o.y7,o.wz,o.BC,o.vS],styles:[".container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}h2[_ngcontent-%COMP%]{font-size:24px;color:#333}.filters[_ngcontent-%COMP%]{display:flex;gap:15px}.filter-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{font-size:14px;color:#555;margin-bottom:5px}select[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 2px 4px #0000001a}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px 15px;text-align:left;border-bottom:1px solid #ddd}th[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:600;color:#333}td[_ngcontent-%COMP%]{color:#555}.no-data[_ngcontent-%COMP%]{text-align:center;color:#999;font-style:italic}.promotion-info[_ngcontent-%COMP%]{margin:20px 0;padding:10px;background-color:#f9f9f9;border:1px solid #ddd;border-radius:4px}.promotion-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;color:#333}.form-actions[_ngcontent-%COMP%]{margin-top:20px;text-align:right}.promote-button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#28a745;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:14px}.promote-button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}"],data:{animation:[(0,f.hZ)("fadeIn",[(0,f.kY)(":enter",[(0,f.iF)({opacity:0,transform:"translateY(-10px)"}),(0,f.i0)("300ms ease-in",(0,f.iF)({opacity:1,transform:"translateY(0)"}))])])]}})}}return s})();var F=m(4249),N=m(998),E=m(3891);const j=(s,i)=>({"bg-success":s,"bg-danger":i}),w=(s,i)=>({"text-success":s,"text-danger":i});function L(s,i){if(1&s&&(t.j41(0,"option",25),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.E5c(" ",e.examTitle," - ",e.classId.name," (",t.i5U(2,4,e.examDate,"shortDate"),") ")}}function D(s,i){1&s&&(t.j41(0,"div",26),t.EFF(1,"Please select an exam."),t.k0s())}function X(s,i){if(1&s&&(t.j41(0,"option",25),t.EFF(1),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.Lme(" ",e.name," (Roll No: ",e.rollNo||"N/A",") ")}}function U(s,i){1&s&&(t.j41(0,"div",26),t.EFF(1,"Please select a student."),t.k0s())}function B(s,i){if(1&s&&(t.j41(0,"div",37),t.nrm(1,"i",38),t.EFF(2,"Student: "),t.j41(3,"strong"),t.EFF(4),t.k0s(),t.EFF(5),t.j41(6,"strong"),t.EFF(7),t.k0s()()),2&s){const e=t.XpG(3);t.R7$(4),t.JRh(e.selectedStudent.name),t.R7$(),t.SpI(" (Roll No: ",e.selectedStudent.rollNo||"N/A",") | Exam: "),t.R7$(2),t.JRh(e.selectedExam.examTitle)}}function V(s,i){if(1&s&&(t.j41(0,"div",51),t.EFF(1),t.k0s()),2&s){const e=t.XpG().$implicit;t.R7$(),t.SpI(" Marks must be between 0 and ",e.maxMarks,". ")}}function J(s,i){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&s){let e;const a=t.XpG().$implicit,n=t.XpG(3);t.R7$(),t.SpI(" ",t.i5U(2,1,(null==(e=n.marksForm.get(a.subjectId._id))?null:e.value)/a.maxMarks*100,"1.1-1"),"% ")}}function z(s,i){1&s&&(t.j41(0,"span",52),t.EFF(1,"N/A"),t.k0s())}function K(s,i){if(1&s&&(t.j41(0,"span",53),t.EFF(1),t.k0s()),2&s){let e,a;const n=t.XpG().$implicit,r=t.XpG(3);t.Y8G("ngClass",t.l_i(2,j,(null==(e=r.marksForm.get(n.subjectId._id))?null:e.value)>=40,(null==(e=r.marksForm.get(n.subjectId._id))?null:e.value)<40)),t.R7$(),t.SpI(" ",(null==(a=r.marksForm.get(n.subjectId._id))?null:a.value)>=40?"Pass":"Fail"," ")}}function H(s,i){1&s&&(t.j41(0,"span",54),t.EFF(1,"Pending"),t.k0s())}function Q(s,i){if(1&s&&(t.j41(0,"tr",39)(1,"td",40),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"div",41),t.nrm(5,"input",42),t.j41(6,"div",43),t.EFF(7),t.k0s()(),t.DNE(8,V,2,1,"div",44),t.k0s(),t.j41(9,"td",45),t.EFF(10),t.k0s(),t.j41(11,"td",46),t.DNE(12,J,3,4,"span",47)(13,z,2,0,"span",48),t.k0s(),t.j41(14,"td"),t.DNE(15,K,2,5,"span",49)(16,H,2,0,"span",50),t.k0s()()),2&s){let e,a,n,r,c;const d=i.$implicit,b=i.index,x=t.XpG(3);t.R7$(2),t.JRh(d.subjectId.name),t.R7$(3),t.Y8G("formControlName",d.subjectId._id)("name","marks-"+b)("max",d.maxMarks)("disabled",x.isLoading),t.R7$(2),t.SpI(" / ",d.maxMarks," "),t.R7$(),t.Y8G("ngIf",(null==(e=x.marksForm.get(d.subjectId._id))?null:e.invalid)&&(null==(e=x.marksForm.get(d.subjectId._id))?null:e.touched)),t.R7$(2),t.JRh(d.maxMarks),t.R7$(2),t.Y8G("ngIf",null==(a=x.marksForm.get(d.subjectId._id))?null:a.value),t.R7$(),t.Y8G("ngIf",!(null!=(n=x.marksForm.get(d.subjectId._id))&&n.value)),t.R7$(2),t.Y8G("ngIf",null==(r=x.marksForm.get(d.subjectId._id))?null:r.value),t.R7$(),t.Y8G("ngIf",!(null!=(c=x.marksForm.get(d.subjectId._id))&&c.value))}}function W(s,i){1&s&&(t.j41(0,"tr",46)(1,"td",55),t.nrm(2,"i",56),t.j41(3,"p"),t.EFF(4,"No subjects available for this exam."),t.k0s()()())}function Z(s,i){if(1&s&&(t.j41(0,"tfoot",33)(1,"tr")(2,"th",57),t.EFF(3,"Total:"),t.k0s(),t.j41(4,"th",58),t.EFF(5),t.k0s(),t.nrm(6,"th",46),t.j41(7,"th",59),t.EFF(8),t.nI1(9,"number"),t.k0s(),t.j41(10,"th")(11,"span",53),t.EFF(12),t.k0s()()()()),2&s){const e=t.XpG(3);t.R7$(5),t.Lme("",e.getTotalObtained()," / ",e.getTotalMax(),""),t.R7$(2),t.Y8G("ngClass",t.l_i(9,w,e.getOverallPercentage()>=40,e.getOverallPercentage()<40)),t.R7$(),t.SpI(" ",t.i5U(9,6,e.getOverallPercentage(),"1.1-1"),"% "),t.R7$(3),t.Y8G("ngClass",t.l_i(12,j,e.getOverallPercentage()>=40,e.getOverallPercentage()<40)),t.R7$(),t.SpI(" ",e.getOverallPercentage()>=40?"Pass":"Fail"," ")}}function q(s,i){if(1&s&&(t.j41(0,"div",8)(1,"div",9)(2,"div",27)(3,"h5",3),t.nrm(4,"i",28),t.EFF(5,"Enter Marks"),t.k0s()(),t.j41(6,"div",12),t.DNE(7,B,8,3,"div",29),t.j41(8,"form",30)(9,"div",31)(10,"table",32)(11,"thead",33)(12,"tr")(13,"th"),t.EFF(14,"Subject"),t.k0s(),t.j41(15,"th"),t.EFF(16,"Marks Obtained"),t.k0s(),t.j41(17,"th"),t.EFF(18,"Max Marks"),t.k0s(),t.j41(19,"th"),t.EFF(20,"Percentage"),t.k0s(),t.j41(21,"th"),t.EFF(22,"Status"),t.k0s()()(),t.j41(23,"tbody"),t.DNE(24,Q,17,12,"tr",34)(25,W,5,0,"tr",35),t.k0s(),t.DNE(26,Z,13,15,"tfoot",36),t.k0s()()()()()()),2&s){const e=t.XpG(2);t.R7$(7),t.Y8G("ngIf",e.subjects.length>0),t.R7$(),t.Y8G("formGroup",e.marksForm),t.R7$(16),t.Y8G("ngForOf",e.subjects)("ngForTrackBy",e.trackBySubjectId),t.R7$(),t.Y8G("ngIf",0===e.subjects.length),t.R7$(),t.Y8G("ngIf",e.subjects.length>0)}}function tt(s,i){1&s&&t.nrm(0,"span",67)}function et(s,i){if(1&s){const e=t.RV6();t.j41(0,"div",60)(1,"div",61)(2,"button",62),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.router.navigate(["/result-list"]))}),t.nrm(3,"i",63),t.EFF(4,"Back to List "),t.k0s(),t.j41(5,"button",64),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.submitMarks())}),t.nrm(6,"i",65),t.EFF(7,"Submit Marks "),t.DNE(8,tt,1,0,"span",66),t.k0s()()()}if(2&s){const e=t.XpG(2);t.R7$(2),t.Y8G("disabled",e.isLoading),t.R7$(3),t.Y8G("disabled",e.isLoading||e.marksForm.invalid),t.R7$(3),t.Y8G("ngIf",e.isLoading)}}function st(s,i){if(1&s){const e=t.RV6();t.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"h5",3),t.nrm(5,"i",11),t.EFF(6,"Basic Information"),t.k0s()(),t.j41(7,"div",12)(8,"div",13)(9,"div",14)(10,"label",15),t.EFF(11,"Exam "),t.j41(12,"span",16),t.EFF(13,"*"),t.k0s()(),t.j41(14,"select",17),t.mxI("ngModelChange",function(n){t.eBV(e);const r=t.XpG();return t.DH7(r.selectedExamId,n)||(r.selectedExamId=n),t.Njj(n)}),t.bIt("ngModelChange",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onExamChange())}),t.j41(15,"option",18),t.EFF(16,"Select Exam"),t.k0s(),t.DNE(17,L,3,7,"option",19),t.k0s(),t.DNE(18,D,2,0,"div",20),t.k0s(),t.j41(19,"div",14)(20,"label",21),t.EFF(21,"Student "),t.j41(22,"span",16),t.EFF(23,"*"),t.k0s()(),t.j41(24,"select",22),t.mxI("ngModelChange",function(n){t.eBV(e);const r=t.XpG();return t.DH7(r.selectedStudentId,n)||(r.selectedStudentId=n),t.Njj(n)}),t.bIt("ngModelChange",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onStudentChange())}),t.j41(25,"option",18),t.EFF(26,"Select Student"),t.k0s(),t.DNE(27,X,2,3,"option",19),t.k0s(),t.DNE(28,U,2,0,"div",20),t.k0s()()()()(),t.DNE(29,q,27,6,"div",23)(30,et,9,3,"div",24),t.k0s()}if(2&s){const e=t.XpG();t.R7$(14),t.R50("ngModel",e.selectedExamId),t.Y8G("disabled",e.isLoading),t.R7$(3),t.Y8G("ngForOf",e.exams),t.R7$(),t.Y8G("ngIf",""===e.selectedExamId),t.R7$(6),t.R50("ngModel",e.selectedStudentId),t.Y8G("disabled",!e.selectedExamId||e.isLoading),t.R7$(3),t.Y8G("ngForOf",e.students),t.R7$(),t.Y8G("ngIf",""===e.selectedStudentId&&e.selectedExamId),t.R7$(),t.Y8G("ngIf",e.subjects.length>0&&e.selectedStudent),t.R7$(),t.Y8G("ngIf",e.subjects.length>0&&e.selectedStudent)}}function nt(s,i){1&s&&(t.j41(0,"div",68)(1,"div",69)(2,"span",70),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",71),t.EFF(5,"Loading data..."),t.k0s()())}let at=(()=>{class s{constructor(e,a,n,r,c,d,b,x,Gt,Nt){this.examService=e,this.resultService=a,this.studentService=n,this.academicYearService=r,this.classSubjectService=c,this.authService=d,this.toastr=b,this.router=x,this.fb=Gt,this.cdr=Nt,this.exams=[],this.selectedExamId="",this.selectedExam=null,this.students=[],this.selectedStudentId="",this.selectedStudent=null,this.subjects=[],this.selectedAcademicYearId="",this.selectedClassId="",this.schoolId=null,this.isLoading=!1,this.marksForm=this.fb.group({})}ngOnInit(){if(this.schoolId=this.authService.getSchoolId(),!this.schoolId)return this.toastr.error("School ID is missing. Please log in again.","Error"),void this.router.navigate(["/auth/login"]);this.loadActiveYearAndExams()}loadActiveYearAndExams(){this.isLoading=!0,this.academicYearService.getActiveAcademicYear(this.schoolId).subscribe({next:e=>{this.selectedAcademicYearId=e._id,this.loadExams()},error:e=>this.handleError("active academic year",e),complete:()=>this.isLoading=!1})}loadExams(){this.isLoading=!0,this.examService.getExamsForResultEntry().subscribe({next:e=>{console.log("Full Response from getExamsForResultEntry:",e),this.exams=e.exams||e,0===this.exams.length&&this.toastr.info("No exams available for your assigned subjects.","Info")},error:e=>this.handleError("exams",e),complete:()=>this.isLoading=!1})}onExamChange(){this.selectedStudentId="",this.selectedStudent=null,this.subjects=[],this.marksForm=this.fb.group({}),this.selectedExam=this.exams.find(e=>e._id===this.selectedExamId)||null,console.log("Selected Exam:",this.selectedExam),this.selectedExam&&(this.selectedClassId=this.selectedExam.classId._id,this.subjects=this.selectedExam.examPapers.map(e=>({subjectId:{_id:e.subjectId._id,name:e.subjectId.name||"Unknown"},maxMarks:e.maxMarks})),console.log("Mapped Subjects:",this.subjects),this.buildMarksForm(),this.loadStudents(),this.cdr.detectChanges())}buildMarksForm(){const e={};this.subjects.forEach(a=>{e[a.subjectId._id]=[0,[o.k0.required,o.k0.min(0),o.k0.max(a.maxMarks)]]}),this.marksForm=this.fb.group(e),console.log("Marks Form Controls:",e)}loadStudents(){!this.selectedClassId||!this.selectedAcademicYearId||(this.isLoading=!0,this.classSubjectService.getStudentsByClass(this.selectedClassId,this.selectedAcademicYearId).subscribe({next:e=>{this.students=e.students||e,0===this.students.length&&this.toastr.info("No students found for the selected class.","Info")},error:e=>this.handleError("students",e),complete:()=>this.isLoading=!1}))}onStudentChange(){this.selectedStudent=this.students.find(e=>e._id===this.selectedStudentId)||null,this.selectedStudent&&this.resultService.getPartialResults(this.selectedStudent._id,this.selectedExamId).subscribe({next:e=>{e.forEach(a=>{const n=this.marksForm.get(a.subjectId._id);n&&n.setValue(a.marksObtained)}),console.log("Partial Results Loaded:",e)},error:e=>this.handleError("partial results",e)})}submitMarks(){if(this.marksForm.invalid)return this.toastr.warning("Please fill all marks correctly (0 to max marks).","Validation Error"),void this.markInvalidFields();this.isLoading=!0;const a=this.subjects.map(n=>({studentId:this.selectedStudent._id,examId:this.selectedExam._id,classId:this.selectedClassId,subjectId:n.subjectId._id,marksObtained:this.marksForm.value[n.subjectId._id]})).map(n=>this.resultService.createPartialResult(n).toPromise());Promise.all(a).then(()=>{this.toastr.success("Marks submitted successfully!","Success"),this.marksForm.reset(),this.onStudentChange()}).catch(n=>this.handleError("submitting marks",n)).finally(()=>{this.isLoading=!1})}getTotalObtained(){return this.subjects.reduce((e,a)=>e+(this.marksForm.get(a.subjectId._id)?.value||0),0)}getTotalMax(){return this.subjects.reduce((e,a)=>e+a.maxMarks,0)}getOverallPercentage(){const e=this.getTotalMax();return 0===e?0:this.getTotalObtained()/e*100}markInvalidFields(){Object.keys(this.marksForm.controls).forEach(e=>{const a=this.marksForm.get(e);a&&a.invalid&&a.markAsTouched()})}handleError(e,a){console.error(`Error ${e}:`,a);let n=`Failed to ${e}. Please try again.`;a?.error?.error?n=a.error.error:a?.message?n=a.message:a?.error&&(n="string"==typeof a.error?a.error:JSON.stringify(a.error)),this.toastr.error(n,`${e.charAt(0).toUpperCase()+e.slice(1)} Error`),this.isLoading=!1}navigateToResultList(){this.router.navigate(["result/result-list"])}static{this.\u0275fac=function(a){return new(a||s)(t.rXU(p.R),t.rXU(l.L),t.rXU(N.b),t.rXU(R.y),t.rXU(E.e),t.rXU(u.u),t.rXU(h.tw),t.rXU(_.Ix),t.rXU(o.ok),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-teacher-result-entry"]],decls:10,vars:3,consts:[["loadingSpinner",""],[1,"container-fluid","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"fas","fa-graduation-cap","me-2","text-primary"],[1,"btn","btn-primary",3,"click","disabled"],["class","row g-3 mb-4",4,"ngIf","ngIfElse"],[1,"row","g-3","mb-4"],[1,"col-12"],[1,"card","shadow-sm","border-0"],[1,"card-header","bg-primary","text-white"],[1,"fas","fa-info-circle","me-2"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","exam",1,"form-label"],[1,"text-danger"],["id","exam","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback d-block",4,"ngIf"],["for","student",1,"form-label"],["id","student","required","",1,"form-select",3,"ngModelChange","ngModel","disabled"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],[3,"value"],[1,"invalid-feedback","d-block"],[1,"card-header","bg-success","text-white"],[1,"fas","fa-edit","me-2"],["class","alert alert-info",4,"ngIf"],[3,"formGroup"],[1,"table-responsive"],[1,"table","table-bordered","table-hover"],[1,"table-light"],["class","align-middle",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center",4,"ngIf"],["class","table-light",4,"ngIf"],[1,"alert","alert-info"],[1,"fas","fa-info-circle","me-1"],[1,"align-middle"],[1,"fw-bold"],[1,"input-group","input-group-sm"],["type","number","min","0",1,"form-control",3,"formControlName","name","max","disabled"],[1,"input-group-text"],["class","text-danger small mt-1",4,"ngIf"],[1,"text-center","fw-bold"],[1,"text-center"],[4,"ngIf"],["class","text-muted",4,"ngIf"],["class","badge",3,"ngClass",4,"ngIf"],["class","badge bg-secondary",4,"ngIf"],[1,"text-danger","small","mt-1"],[1,"text-muted"],[1,"badge",3,"ngClass"],[1,"badge","bg-secondary"],["colspan","5",1,"py-4","text-muted"],[1,"fas","fa-exclamation-triangle","fa-2x","mb-2"],["colspan","1",1,"text-end"],[1,"text-end","fw-bold"],[1,"text-center","fw-bold",3,"ngClass"],[1,"row"],[1,"col-12","text-end"],["type","button",1,"btn","btn-secondary","me-2",3,"click","disabled"],[1,"fas","fa-arrow-left","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save","me-1"],["class","spinner-border spinner-border-sm ms-2","role","status",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","ms-2"],[1,"loading-overlay","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"ms-3","mb-0"]],template:function(a,n){if(1&a){const r=t.RV6();t.j41(0,"div",1)(1,"header",2)(2,"h2",3),t.nrm(3,"i",4),t.EFF(4,"Enter Marks"),t.k0s(),t.j41(5,"button",5),t.bIt("click",function(){return t.eBV(r),t.Njj(n.navigateToResultList())}),t.EFF(6," Result List "),t.k0s()(),t.DNE(7,st,31,10,"div",6)(8,nt,6,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&a){const r=t.sdS(9);t.R7$(5),t.Y8G("disabled",n.isLoading),t.R7$(2),t.Y8G("ngIf",!n.isLoading)("ngIfElse",r)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.QX,g.vh,o.X1,o.qT,o.xH,o.y7,o.me,o.Q0,o.wz,o.BC,o.cb,o.YS,o.VZ,o.zX,o.j4,o.JD,o.YN,o.vS],styles:[".container-fluid[_ngcontent-%COMP%]{background:#f8f9fa;min-height:100vh}.header[_ngcontent-%COMP%]{background:#fff;padding:1rem 1.5rem;border-radius:.5rem;box-shadow:0 2px 4px #0000001a;margin-bottom:1rem}.card[_ngcontent-%COMP%]{border:none;border-radius:.5rem;overflow:hidden}.card-header[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem;display:block}.form-select[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]{border-radius:.375rem;border:1px solid #ced4da;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-select[_ngcontent-%COMP%]:focus, .form-control[_ngcontent-%COMP%]:focus{border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.marks-table[_ngcontent-%COMP%]{margin-top:1rem}.table[_ngcontent-%COMP%]{margin-bottom:0;font-size:.95rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600;border-top:none}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.input-group-text[_ngcontent-%COMP%]{background-color:#f8f9fa;border-left:none}.alert-info[_ngcontent-%COMP%]{border-radius:.375rem;border:none;background-color:#d1ecf1;color:#0c5460}.form-actions[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1rem;border-top:1px solid #dee2e6}.btn[_ngcontent-%COMP%]{border-radius:.375rem;font-weight:500;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border:none}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 8px #0003}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#fffc;z-index:9999}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}@media (max-width: 768px){.grid-container[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-responsive[_ngcontent-%COMP%]{font-size:.85rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem}}.invalid-feedback[_ngcontent-%COMP%]{font-size:.875rem}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}"]})}}return s})();var it=m(1375);const rt=(s,i)=>({"status-pass":s,"status-fail":i}),ot=(s,i)=>({published:s,unpublished:i});function lt(s,i){if(1&s&&(t.j41(0,"option",15),t.EFF(1),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.JRh(e.name)}}function dt(s,i){if(1&s&&(t.j41(0,"option",15),t.EFF(1),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.JRh(e.name)}}function ct(s,i){if(1&s&&(t.j41(0,"option",15),t.EFF(1),t.k0s()),2&s){const e=i.$implicit;t.Y8G("value",e._id),t.R7$(),t.JRh(e.examTitle)}}function ut(s,i){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const e=t.XpG(3);t.R7$(),t.JRh("asc"===e.sortOrder?"\u2191":"\u2193")}}function mt(s,i){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const e=t.XpG(3);t.R7$(),t.JRh("asc"===e.sortOrder?"\u2191":"\u2193")}}function gt(s,i){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const e=t.XpG(3);t.R7$(),t.JRh("asc"===e.sortOrder?"\u2191":"\u2193")}}function pt(s,i){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const e=t.XpG(3);t.R7$(),t.JRh("asc"===e.sortOrder?"\u2191":"\u2193")}}function ht(s,i){if(1&s){const e=t.RV6();t.j41(0,"button",26),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,r=t.XpG(3);return t.Njj(r.publishSingleResult(n))}),t.EFF(1," Publish "),t.k0s()}}function _t(s,i){if(1&s){const e=t.RV6();t.j41(0,"tr",22)(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"number"),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s(),t.j41(14,"td"),t.EFF(15),t.k0s(),t.j41(16,"td")(17,"span",23),t.EFF(18),t.k0s()(),t.j41(19,"td")(20,"span",23),t.EFF(21),t.k0s()(),t.j41(22,"td"),t.DNE(23,ht,2,0,"button",24),t.j41(24,"button",25),t.bIt("click",function(){const n=t.eBV(e).$implicit,r=t.XpG(3);return t.Njj(r.openProgressCard(n))}),t.EFF(25,"View Progress Card"),t.k0s()()()}if(2&s){const e=i.$implicit;t.R7$(2),t.JRh(e.studentId.name||"N/A"),t.R7$(2),t.JRh(e.studentId.rollNo||"N/A"),t.R7$(2),t.JRh(e.examId.examTitle||"N/A"),t.R7$(2),t.JRh(e.totalMaxMarks||0),t.R7$(2),t.JRh(t.i5U(11,12,.4*e.totalMaxMarks,"1.0-0")),t.R7$(3),t.JRh(e.totalMarksObtained||0),t.R7$(2),t.SpI("",e.percentage||0,"%"),t.R7$(2),t.Y8G("ngClass",t.l_i(15,rt,e.percentage>=33,e.percentage<33)),t.R7$(),t.SpI(" ",e.percentage>=33?"Pass":"Fail"," "),t.R7$(2),t.Y8G("ngClass",t.l_i(18,ot,e.isPublished,!e.isPublished)),t.R7$(),t.SpI(" ",e.isPublished?"Published":"Unpublished"," "),t.R7$(2),t.Y8G("ngIf",!e.isPublished)}}function bt(s,i){if(1&s){const e=t.RV6();t.j41(0,"table")(1,"thead")(2,"tr")(3,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("studentId.name"))}),t.EFF(4,"Student "),t.DNE(5,ut,2,1,"span",17),t.k0s(),t.j41(6,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("studentId.rollNo"))}),t.EFF(7,"Roll No "),t.DNE(8,mt,2,1,"span",17),t.k0s(),t.j41(9,"th"),t.EFF(10,"Exam"),t.k0s(),t.j41(11,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("totalMaxMarks"))}),t.EFF(12,"T/M"),t.k0s(),t.j41(13,"th"),t.EFF(14,"P/M"),t.k0s(),t.j41(15,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("totalMarksObtained"))}),t.EFF(16,"Marks"),t.k0s(),t.j41(17,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("percentage"))}),t.EFF(18,"Percentage "),t.DNE(19,gt,2,1,"span",17),t.k0s(),t.j41(20,"th"),t.EFF(21,"Status"),t.k0s(),t.j41(22,"th",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("isPublished"))}),t.EFF(23,"Published "),t.DNE(24,pt,2,1,"span",17),t.k0s(),t.j41(25,"th"),t.EFF(26,"Actions "),t.j41(27,"button",20),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.publishAllResults())}),t.EFF(28,"Published All "),t.k0s()()()(),t.j41(29,"tbody"),t.DNE(30,_t,26,21,"tr",21),t.k0s()()}if(2&s){const e=t.XpG(2);t.R7$(5),t.Y8G("ngIf","studentId.name"===e.sortKey),t.R7$(3),t.Y8G("ngIf","studentId.rollNo"===e.sortKey),t.R7$(11),t.Y8G("ngIf","percentage"===e.sortKey),t.R7$(5),t.Y8G("ngIf","isPublished"===e.sortKey),t.R7$(6),t.Y8G("ngForOf",e.sortedResults)}}function ft(s,i){1&s&&(t.j41(0,"div",27),t.EFF(1," No results found for the selected criteria. "),t.k0s())}function xt(s,i){if(1&s&&(t.j41(0,"div",16),t.DNE(1,bt,31,5,"table",17)(2,ft,2,0,"div",18),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.sortedResults.length>0),t.R7$(),t.Y8G("ngIf",0===e.sortedResults.length&&!e.isLoading)}}function kt(s,i){1&s&&(t.j41(0,"div",28)(1,"span"),t.EFF(2,"Loading results..."),t.k0s()())}function Ft(s,i){if(1&s&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.nI1(9,"number"),t.k0s(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.k0s()()),2&s){const e=i.$implicit,a=i.index;t.R7$(2),t.JRh(a+1),t.R7$(2),t.JRh(e.subjectId.name||"N/A"),t.R7$(2),t.JRh(e.maxMarks||0),t.R7$(2),t.JRh(e.passingMarks||t.i5U(9,6,.4*e.maxMarks,"1.0-0")||"N/A"),t.R7$(3),t.JRh(e.marksObtained||0),t.R7$(2),t.JRh(e.marksObtained||0)}}function Rt(s,i){if(1&s&&(t.j41(0,"table",44)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"Sno"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Subject Name"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Max. Mark"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Min. Mark"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Mark Obt."),t.k0s(),t.j41(13,"th"),t.EFF(14,"Copy Mark"),t.k0s()()(),t.j41(15,"tbody"),t.DNE(16,Ft,14,9,"tr",45),t.j41(17,"tr",46)(18,"td",47)(19,"strong"),t.EFF(20,"TOTAL"),t.k0s()(),t.j41(21,"td"),t.EFF(22),t.k0s(),t.j41(23,"td"),t.EFF(24),t.nI1(25,"number"),t.k0s(),t.j41(26,"td"),t.EFF(27),t.k0s(),t.j41(28,"td"),t.EFF(29),t.k0s()()()()),2&s){const e=t.XpG(2);t.R7$(16),t.Y8G("ngForOf",e.selectedResult.subjects),t.R7$(6),t.JRh(e.selectedResult.totalMaxMarks||0),t.R7$(2),t.JRh(t.i5U(25,5,e.getTotalPassingMarks(e.selectedResult),"1.0-0")),t.R7$(3),t.JRh(e.selectedResult.totalMarksObtained||0),t.R7$(2),t.JRh(e.selectedResult.totalMarksObtained||0)}}function Ct(s,i){if(1&s&&(t.j41(0,"div",48)(1,"p")(2,"strong"),t.EFF(3,"PER(%):"),t.k0s(),t.EFF(4),t.k0s(),t.j41(5,"p")(6,"strong"),t.EFF(7,"GRADE:"),t.k0s(),t.EFF(8),t.k0s(),t.j41(9,"p")(10,"strong"),t.EFF(11,"ATTENDANCE:"),t.k0s(),t.EFF(12),t.k0s(),t.j41(13,"p")(14,"strong"),t.EFF(15,"REMARKS:"),t.k0s(),t.EFF(16),t.k0s()()),2&s){const e=t.XpG(2);t.R7$(4),t.SpI(" ",e.selectedResult.percentage||0,"%"),t.R7$(4),t.SpI(" ",e.getGrade(e.selectedResult.percentage||0),""),t.R7$(4),t.SpI(" ",e.selectedResult.attendance||"[Not Available]","%"),t.R7$(4),t.SpI(" ",(e.selectedResult.percentage||0)>=40?"GOOD":"NEEDS IMPROVEMENT","")}}function vt(s,i){1&s&&(t.j41(0,"div",27),t.EFF(1," No subject details available. "),t.k0s())}function Et(s,i){if(1&s){const e=t.RV6();t.j41(0,"div",29),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeProgressCard())}),t.j41(1,"div",30),t.bIt("click",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.stopPropagation(n))}),t.j41(2,"div",31),t.nrm(3,"img",32),t.j41(4,"h3"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s(),t.j41(8,"p"),t.EFF(9),t.k0s()(),t.j41(10,"div",33)(11,"div",34),t.nrm(12,"img",35),t.j41(13,"div",36)(14,"p")(15,"strong"),t.EFF(16,"Student Name:"),t.k0s(),t.EFF(17),t.k0s(),t.j41(18,"p")(19,"strong"),t.EFF(20,"Father's Name:"),t.k0s(),t.EFF(21),t.k0s(),t.j41(22,"p")(23,"strong"),t.EFF(24,"Class & Sec:"),t.k0s(),t.EFF(25),t.k0s(),t.j41(26,"p")(27,"strong"),t.EFF(28,"Gender:"),t.k0s(),t.EFF(29),t.k0s(),t.j41(30,"p")(31,"strong"),t.EFF(32,"Session:"),t.k0s(),t.EFF(33),t.k0s(),t.j41(34,"p")(35,"strong"),t.EFF(36,"Adm No:"),t.k0s(),t.EFF(37),t.k0s()()(),t.j41(38,"h4"),t.EFF(39),t.k0s(),t.DNE(40,Rt,30,8,"table",37)(41,Ct,17,4,"div",38)(42,vt,2,0,"div",18),t.k0s(),t.j41(43,"div",39)(44,"p"),t.EFF(45),t.k0s(),t.j41(46,"div",40)(47,"div"),t.nrm(48,"img",41),t.j41(49,"span"),t.EFF(50,"School Seal"),t.k0s()(),t.j41(51,"div")(52,"span"),t.EFF(53,"PRINCIPAL"),t.k0s()()(),t.j41(54,"p",42),t.EFF(55,"*Grading A: 90 to 100%, B: 75 to 89%, C: 60 to 74%, D: 35 to 59%, E: below 35%"),t.k0s()(),t.j41(56,"button",43),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeProgressCard())}),t.EFF(57,"\xd7"),t.k0s()()()}if(2&s){const e=t.XpG();t.R7$(3),t.Y8G("src",(null==e.schoolDetails?null:e.schoolDetails.logo)||"assets/school-logo.png",t.B4B),t.R7$(2),t.JRh((null==e.schoolDetails?null:e.schoolDetails.name)||"Rainbow Public School"),t.R7$(2),t.JRh(((null==e.schoolDetails||null==e.schoolDetails.address?null:e.schoolDetails.address.street)||"")+", "+((null==e.schoolDetails||null==e.schoolDetails.address?null:e.schoolDetails.address.city)||"")+", "+((null==e.schoolDetails||null==e.schoolDetails.address?null:e.schoolDetails.address.state)||"")+" - "+((null==e.schoolDetails||null==e.schoolDetails.address?null:e.schoolDetails.address.postalCode)||"")),t.R7$(2),t.Lme("Email: ",(null==e.schoolDetails?null:e.schoolDetails.contactEmail)||"Not provided"," | Contact: ",(null==e.schoolDetails?null:e.schoolDetails.contactPhone)||"Not provided",""),t.R7$(8),t.SpI(" ",e.selectedResult.studentId.name||"N/A",""),t.R7$(4),t.SpI(" ",e.selectedResult.studentId.fatherName||"[Not Available]",""),t.R7$(4),t.SpI(" ",(null==e.selectedResult.classId?null:e.selectedResult.classId.name)||"[Not Available]",""),t.R7$(4),t.SpI(" ",e.selectedResult.studentId.gender||"[Not Available]",""),t.R7$(4),t.SpI(" ",(null==e.selectedResult.academicYearId?null:e.selectedResult.academicYearId.name)||"[Not Available]",""),t.R7$(4),t.SpI(" ",e.selectedResult.studentId._id||"N/A",""),t.R7$(2),t.SpI("Progress Report of ",e.selectedResult.examId.examTitle||"N/A",""),t.R7$(),t.Y8G("ngIf",null==e.selectedResult.subjects?null:e.selectedResult.subjects.length),t.R7$(),t.Y8G("ngIf",null==e.selectedResult.subjects?null:e.selectedResult.subjects.length),t.R7$(),t.Y8G("ngIf",!(null!=e.selectedResult.subjects&&e.selectedResult.subjects.length)),t.R7$(3),t.JRh(e.selectedResult.studentId.teacherName||"[Class Teacher]")}}let jt=(()=>{class s{constructor(e,a,n,r,c,d,b){this.resultService=e,this.academicYearService=a,this.authService=n,this.classService=r,this.examService=c,this.toastr=d,this.schoolService=b,this.classes=[],this.selectedClassId="",this.selectedAcademicYearId="",this.academicYears=[],this.results=[],this.isLoading=!1,this.schoolId=null,this.exams=[],this.selectedExamId="",this.sortKey="percentage",this.sortOrder="desc",this.selectedResult=null,this.schoolDetails=null,this.allPublished=!1,this.isPublishing=!1}ngOnInit(){this.schoolId=this.authService.getSchoolId(),this.schoolId?(this.loadClasses(),this.loadAcademicYears(),this.loadSchoolDetails()):this.toastr.error("School ID missing","Error")}loadSchoolDetails(){this.authService.getUserId()&&this.schoolService.getMySchool().subscribe({next:a=>{this.schoolDetails=a},error:a=>{this.toastr.error("Failed to load school details","Error"),console.error("Error loading school details:",a)}})}loadClasses(){this.isLoading=!0,this.classService.getClassesBySchool(this.schoolId).subscribe({next:e=>{this.classes=e,e.length>0&&(this.selectedClassId=e[0]._id,this.loadExams()),this.isLoading=!1},error:e=>{this.toastr.error("Failed to load classes","Error"),this.isLoading=!1}})}loadAcademicYears(){this.academicYearService.getAllAcademicYears(this.schoolId).subscribe({next:e=>{this.academicYears=e,e.length>0&&this.academicYearService.getActiveAcademicYear(this.schoolId).subscribe({next:a=>{this.selectedAcademicYearId=a._id,this.loadExams()},error:a=>{this.toastr.error("Failed to load active year","Error"),this.isLoading=!1}})},error:e=>{this.toastr.error("Failed to load academic years","Error"),this.isLoading=!1}})}loadExams(){this.selectedAcademicYearId&&(this.isLoading=!0,this.examService.getExamsBySchool(this.schoolId,this.selectedAcademicYearId).subscribe({next:e=>{console.log(e),this.exams=e,this.exams.length>0?(this.selectedExamId=this.exams[0]._id,this.loadResults()):(this.isLoading=!1,this.exams=[],this.results=[])},error:e=>{this.toastr.error("Failed to load exams","Error"),this.isLoading=!1,this.exams=[],this.results=[]}}))}updatePublishStatus(){this.allPublished=this.results.length>0&&this.results.every(e=>!0===e.isPublished)}loadResults(){!this.selectedClassId||!this.selectedAcademicYearId||(this.isLoading=!0,this.resultService.getAllResultsForClass(this.selectedClassId,this.selectedAcademicYearId).subscribe({next:e=>{console.log(e),this.results=e.filter(a=>a.examId._id===this.selectedExamId).map(a=>{const n=a.totalMarksObtained||a.subjects?.reduce((d,b)=>d+(b.marksObtained||0),0)||0,r=a.totalMaxMarks||a.subjects?.reduce((d,b)=>d+(b.maxMarks||100),0)||0,c=r>0?n/r*100:0;return{...a,totalMarksObtained:n,totalMaxMarks:r,percentage:parseFloat(c.toFixed(2)),status:c>=33?"Pass":"Fail"}}),this.isLoading=!1},error:e=>{this.toastr.error("Failed to load results","Error"),this.isLoading=!1}}))}publishAllResults(){this.allPublished||this.isPublishing||(this.isPublishing=!0,this.resultService.publishExamResults({examId:this.selectedExamId,classId:this.selectedClassId,academicYearId:this.selectedAcademicYearId,schoolId:this.schoolId}).subscribe({next:()=>{this.toastr.success("All results published successfully!","Success"),this.results=this.results.map(e=>({...e,isPublished:!0,publishedAt:new Date})),this.updatePublishStatus(),this.isPublishing=!1},error:e=>{console.error("Publish error:",e),this.toastr.error("Failed to publish results. Please try again.","Error"),this.isPublishing=!1}}))}publishSingleResult(e){this.isPublishing=!0,this.resultService.publishSingleResult(e.studentId._id,e.examId._id).subscribe({next:a=>{this.toastr.success(`Published ${a.updated} result(s)!`,"Success");const n=this.results.findIndex(r=>r.studentId._id===e.studentId._id&&r.examId._id===e.examId._id);-1!==n&&(this.results[n].isPublished=!0,this.results[n].publishedAt=new Date,this.updatePublishStatus()),this.isPublishing=!1},error:a=>{this.toastr.error("Failed to publish result.","Error"),this.isPublishing=!1}})}getExamTitle(){return this.exams.find(e=>e._id===this.selectedExamId)?.examTitle||""}sort(e){this.sortKey===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortKey=e,this.sortOrder="asc")}get sortedResults(){return[...this.results].sort((e,a)=>{let n=e[this.sortKey],r=a[this.sortKey];return("studentId.name"===this.sortKey||"studentId.rollNo"===this.sortKey)&&(n=e.studentId[this.sortKey.split(".")[1]],r=a.studentId[this.sortKey.split(".")[1]]),"string"==typeof n?"asc"===this.sortOrder?n.localeCompare(r):r.localeCompare(n):"asc"===this.sortOrder?n-r:r-n})}openProgressCard(e){this.selectedResult={...e}}closeProgressCard(){this.selectedResult=null}stopPropagation(e){e.stopPropagation()}getGrade(e){return e>=90?"A":e>=75?"B":e>=60?"C":e>=35?"D":"E"}getTotalPassingMarks(e){return e.subjects?.reduce((a,n)=>a+(n.passingMarks||.4*n.maxMarks),0)||0}onClassChange(){this.results=[],this.loadExams()}onAcademicYearChange(){this.results=[],this.loadExams()}onExamChange(){this.loadResults()}static{this.\u0275fac=function(a){return new(a||s)(t.rXU(l.L),t.rXU(R.y),t.rXU(u.u),t.rXU(E.e),t.rXU(p.R),t.rXU(h.tw),t.rXU(it.g))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-admin-results"]],decls:30,vars:12,consts:[["loading",""],[1,"container-fluid"],[1,"header"],[1,"filters"],[1,"filter-group"],["for","class"],["id","class",3,"ngModelChange","change","ngModel","disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","academicYear"],["id","academicYear",3,"ngModelChange","change","ngModel","disabled"],["for","exam"],["id","exam",3,"ngModelChange","change","ngModel","disabled"],["class","result-table",4,"ngIf","ngIfElse"],["class","modal",3,"click",4,"ngIf"],[3,"value"],[1,"result-table"],[4,"ngIf"],["class","no-data",4,"ngIf"],[3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","result-row",4,"ngFor","ngForOf"],[1,"result-row"],[1,"status-badge",3,"ngClass"],["class","action-button publish-single",3,"click",4,"ngIf"],[1,"action-button","view",3,"click"],[1,"action-button","publish-single",3,"click"],[1,"no-data"],[1,"loading-overlay"],[1,"modal",3,"click"],[1,"progress-card",3,"click"],[1,"card-header"],["alt","School Logo",1,"school-logo",3,"src"],[1,"card-body"],[1,"student-info"],["src","assets/student-placeholder.png","alt","Student Photo",1,"student-photo"],[1,"info-details"],["class","progress-table",4,"ngIf"],["class","summary",4,"ngIf"],[1,"card-footer"],[1,"signatures"],["src","assets/school-seal.png","alt","School Seal",1,"seal"],[1,"grading-note"],[1,"close-button",3,"click"],[1,"progress-table"],[4,"ngFor","ngForOf"],[1,"total-row"],["colspan","2"],[1,"summary"]],template:function(a,n){if(1&a){const r=t.RV6();t.j41(0,"div",1)(1,"header",2)(2,"h2"),t.EFF(3,"All Results (Admin View)"),t.k0s()(),t.j41(4,"div",3)(5,"div",4)(6,"label",5),t.EFF(7,"Class"),t.k0s(),t.j41(8,"select",6),t.mxI("ngModelChange",function(d){return t.eBV(r),t.DH7(n.selectedClassId,d)||(n.selectedClassId=d),t.Njj(d)}),t.bIt("change",function(){return t.eBV(r),t.Njj(n.onClassChange())}),t.j41(9,"option",7),t.EFF(10,"Select Class"),t.k0s(),t.DNE(11,lt,2,2,"option",8),t.k0s()(),t.j41(12,"div",4)(13,"label",9),t.EFF(14,"Academic Year"),t.k0s(),t.j41(15,"select",10),t.mxI("ngModelChange",function(d){return t.eBV(r),t.DH7(n.selectedAcademicYearId,d)||(n.selectedAcademicYearId=d),t.Njj(d)}),t.bIt("change",function(){return t.eBV(r),t.Njj(n.onAcademicYearChange())}),t.j41(16,"option",7),t.EFF(17,"Select Academic Year"),t.k0s(),t.DNE(18,dt,2,2,"option",8),t.k0s()(),t.j41(19,"div",4)(20,"label",11),t.EFF(21,"Exam"),t.k0s(),t.j41(22,"select",12),t.mxI("ngModelChange",function(d){return t.eBV(r),t.DH7(n.selectedExamId,d)||(n.selectedExamId=d),t.Njj(d)}),t.bIt("change",function(){return t.eBV(r),t.Njj(n.onExamChange())}),t.j41(23,"option",7),t.EFF(24,"Select Exam"),t.k0s(),t.DNE(25,ct,2,2,"option",8),t.k0s()()(),t.DNE(26,xt,3,2,"div",13)(27,kt,3,0,"ng-template",null,0,t.C5r)(29,Et,58,16,"div",14),t.k0s()}if(2&a){const r=t.sdS(28);t.R7$(8),t.R50("ngModel",n.selectedClassId),t.Y8G("disabled",n.isLoading),t.R7$(3),t.Y8G("ngForOf",n.classes),t.R7$(4),t.R50("ngModel",n.selectedAcademicYearId),t.Y8G("disabled",n.isLoading),t.R7$(3),t.Y8G("ngForOf",n.academicYears),t.R7$(4),t.R50("ngModel",n.selectedExamId),t.Y8G("disabled",n.isLoading||!n.selectedClassId||!n.selectedAcademicYearId),t.R7$(3),t.Y8G("ngForOf",n.exams),t.R7$(),t.Y8G("ngIf",!n.isLoading)("ngIfElse",r),t.R7$(3),t.Y8G("ngIf",n.selectedResult)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.QX,o.YN,o.xH,o.y7,o.wz,o.BC,o.vS],styles:[".result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .details-row[_ngcontent-%COMP%]{background-color:#fafafa}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]{padding:15px}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:14px;color:#333;margin-bottom:10px;font-weight:500;border-bottom:2px solid #4a90e2;padding-bottom:4px;display:inline-block}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   .papers-table[_ngcontent-%COMP%]{margin-top:10px}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   .papers-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   .papers-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 10px;font-size:11px}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   .papers-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f1f3f5}.result-table[_ngcontent-%COMP%]   .result-papers[_ngcontent-%COMP%]   .papers-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #e8ecef}.container-fluid[_ngcontent-%COMP%]{padding:25px;background-color:#f5f7fa;min-height:100vh}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg,#4a90e2,#50c9c3);padding:12px 20px;border-radius:8px 8px 0 0;margin-bottom:15px}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;color:#fff;margin:0;font-weight:600;text-transform:uppercase;letter-spacing:.8px}.filters[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:15px;background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 8px #0000000d}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#34495e;font-size:12px}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;border-radius:4px;font-size:12px}.result-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:15px;box-shadow:0 2px 8px #0000000d;overflow-x:auto}.result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;text-align:left;font-size:12px;color:#333}.result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f1f3f5;font-weight:500;border-bottom:1px solid #e8ecef;cursor:pointer}.result-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .result-row[_ngcontent-%COMP%]:hover{background-color:#f9fafb}.result-table[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500}.result-table[_ngcontent-%COMP%]   .status-pass[_ngcontent-%COMP%]{background-color:#e6f4ea;color:#2e7d32}.result-table[_ngcontent-%COMP%]   .status-fail[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.result-table[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{padding:5px 10px;border:none;border-radius:4px;cursor:pointer;font-size:11px;margin-right:5px;transition:background-color .3s ease}.result-table[_ngcontent-%COMP%]   .action-button.view[_ngcontent-%COMP%]{background-color:#4a90e2;color:#fff}.result-table[_ngcontent-%COMP%]   .action-button.view[_ngcontent-%COMP%]:hover{background-color:#3b82f6}.no-data[_ngcontent-%COMP%]{text-align:center;padding:20px;font-size:12px;color:#666}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffe6;display:flex;align-items:center;justify-content:center;z-index:10;color:#7f8c8d}.modal[_ngcontent-%COMP%]{display:block;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080}.progress-card[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;width:80%;max-width:600px;border:2px solid #4a90e2;border-radius:10px;padding:20px;box-shadow:0 5px 15px #0000004d;overflow-y:auto;max-height:90vh}.progress-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{text-align:center;border-bottom:2px solid #4a90e2;padding-bottom:10px;margin-bottom:15px}.progress-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .school-logo[_ngcontent-%COMP%]{width:80px;margin-bottom:10px}.progress-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;color:#2c3e50;margin:0;font-weight:600}.progress-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:#7f8c8d;margin:5px 0}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .student-info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px;border:1px solid #ddd;padding:10px;border-radius:5px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .student-info[_ngcontent-%COMP%]   .student-photo[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;margin-right:15px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .student-info[_ngcontent-%COMP%]   .info-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;margin:2px 0;color:#333}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;color:#2c3e50;margin-bottom:10px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .progress-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:15px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .progress-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .progress-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;text-align:center;border:1px solid #ddd;font-size:12px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .progress-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f1f3f5;font-weight:500}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .progress-table[_ngcontent-%COMP%]   .total-row[_ngcontent-%COMP%]{font-weight:700;background-color:#e8ecef}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]{text-align:center;margin-top:15px}.progress-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;margin:5px 0;color:#333}.progress-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]{text-align:center;border-top:2px solid #4a90e2;padding-top:10px;margin-top:15px}.progress-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:#7f8c8d;margin:5px 0}.progress-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .signatures[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-top:10px}.progress-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .signatures[_ngcontent-%COMP%]   .seal[_ngcontent-%COMP%]{width:50px;vertical-align:middle}.progress-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .grading-note[_ngcontent-%COMP%]{font-size:10px;color:#7f8c8d;margin-top:10px}.progress-card[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:none;border:none;font-size:24px;color:#ff4d4f;cursor:pointer}.progress-card[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{color:#d9363e}"]})}}return s})();const It=(s,i)=>({"bg-success":s,"bg-danger":i});function Mt(s,i){if(1&s&&(t.j41(0,"div",31),t.EFF(1),t.k0s()),2&s){const e=t.XpG(3);t.R7$(),t.SpI(" Marks must be between 0 and ",e.maxMarks,". ")}}function Ot(s,i){if(1&s&&(t.j41(0,"div",8)(1,"div",9)(2,"div",19)(3,"h5",3),t.nrm(4,"i",20),t.EFF(5,"Edit Marks"),t.k0s()(),t.j41(6,"div",12)(7,"form",21)(8,"div",13)(9,"div",22)(10,"label",23),t.EFF(11,"Marks Obtained "),t.j41(12,"span",24),t.EFF(13,"*"),t.k0s()(),t.j41(14,"div",25),t.nrm(15,"input",26),t.j41(16,"span",27),t.EFF(17),t.k0s()(),t.DNE(18,Mt,2,1,"div",28),t.k0s(),t.j41(19,"div",29)(20,"label",15),t.EFF(21,"Percentage"),t.k0s(),t.nrm(22,"input",16),t.nI1(23,"number"),t.k0s(),t.j41(24,"div",29)(25,"label",15),t.EFF(26,"Status"),t.k0s(),t.j41(27,"div")(28,"span",30),t.EFF(29),t.k0s()()()()()()()()),2&s){let e;const a=t.XpG(2);t.R7$(7),t.Y8G("formGroup",a.marksForm),t.R7$(8),t.Y8G("max",a.maxMarks)("disabled",a.isLoading),t.R7$(2),t.SpI("/ ",a.maxMarks,""),t.R7$(),t.Y8G("ngIf",(null==(e=a.marksForm.get("marksObtained"))?null:e.invalid)&&(null==(e=a.marksForm.get("marksObtained"))?null:e.touched)),t.R7$(4),t.Y8G("value",t.i5U(23,8,a.getPercentage(),"1.1-1")),t.R7$(6),t.Y8G("ngClass",t.l_i(11,It,a.getPercentage()>=33,a.getPercentage()<33)),t.R7$(),t.SpI(" ",a.getPercentage()>=33?"Pass":"Fail"," ")}}function Pt(s,i){1&s&&t.nrm(0,"span",39)}function yt(s,i){if(1&s){const e=t.RV6();t.j41(0,"div",32)(1,"div",33)(2,"button",34),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.cancel())}),t.nrm(3,"i",35),t.EFF(4,"Cancel "),t.k0s(),t.j41(5,"button",36),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.submitMarks())}),t.nrm(6,"i",37),t.EFF(7,"Update Marks "),t.DNE(8,Pt,1,0,"span",38),t.k0s()()()}if(2&s){const e=t.XpG(2);t.R7$(2),t.Y8G("disabled",e.isLoading),t.R7$(3),t.Y8G("disabled",e.isLoading||e.marksForm.invalid),t.R7$(3),t.Y8G("ngIf",e.isLoading)}}function $t(s,i){if(1&s&&(t.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"h5",3),t.nrm(5,"i",11),t.EFF(6,"Result Information"),t.k0s()(),t.j41(7,"div",12)(8,"div",13)(9,"div",14)(10,"label",15),t.EFF(11,"Exam"),t.k0s(),t.nrm(12,"input",16),t.k0s(),t.j41(13,"div",14)(14,"label",15),t.EFF(15,"Student"),t.k0s(),t.nrm(16,"input",16),t.k0s(),t.j41(17,"div",14)(18,"label",15),t.EFF(19,"Subject"),t.k0s(),t.nrm(20,"input",16),t.k0s()()()()(),t.DNE(21,Ot,30,14,"div",17)(22,yt,9,3,"div",18),t.k0s()),2&s){const e=t.XpG();t.R7$(12),t.Y8G("value",(null==e.result||null==e.result.examId?null:e.result.examId.examTitle)||"N/A"),t.R7$(4),t.Y8G("value",(null==e.result||null==e.result.studentId?null:e.result.studentId.name)+" (Roll No: "+((null==e.result||null==e.result.studentId?null:e.result.studentId.rollNo)||"N/A")+")"),t.R7$(4),t.Y8G("value",(null==e.result||null==e.result.subjectId?null:e.result.subjectId.name)||"N/A"),t.R7$(),t.Y8G("ngIf",e.result),t.R7$(),t.Y8G("ngIf",e.result)}}function St(s,i){1&s&&(t.j41(0,"div",40)(1,"div",41)(2,"span",42),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",43),t.EFF(5,"Loading result..."),t.k0s()())}let Yt=(()=>{class s{constructor(e,a,n,r,c,d,b){this.route=e,this.router=a,this.resultService=n,this.authService=r,this.toastr=c,this.fb=d,this.cdr=b,this.resultId="",this.result=null,this.isLoading=!1,this.maxMarks=100,this.schoolId=null,this.marksForm=this.fb.group({marksObtained:[0,[o.k0.required,o.k0.min(0)]]})}ngOnInit(){return this.schoolId=this.authService.getSchoolId(),this.schoolId?(this.resultId=this.route.snapshot.paramMap.get("resultId")||"",this.resultId?void this.loadResult():(this.toastr.error("Invalid result ID","Error"),void this.router.navigate(["/result/result-list"]))):(this.toastr.error("School ID is missing. Please log in again.","Error"),void this.router.navigate(["/auth/login"]))}loadResult(){this.isLoading=!0,this.resultService.getResultById(this.resultId).subscribe({next:e=>{if(!e.subjectId)return this.toastr.error("This is not a partial result","Error"),void this.router.navigate(["/result/result-list"]);this.result=e,this.maxMarks=e.maxMarks||100,this.marksForm.get("marksObtained")?.setValidators([o.k0.required,o.k0.min(0),o.k0.max(this.maxMarks)]),this.marksForm.get("marksObtained")?.setValue(e.marksObtained),this.marksForm.get("marksObtained")?.updateValueAndValidity(),this.cdr.detectChanges()},error:e=>this.handleError("load result",e),complete:()=>this.isLoading=!1})}submitMarks(){if(this.marksForm.invalid)return this.toastr.warning("Please enter valid marks (0 to "+this.maxMarks+").","Validation Error"),void this.marksForm.markAllAsTouched();this.isLoading=!0,this.resultService.updatePartialResult(this.resultId,{marksObtained:this.marksForm.value.marksObtained}).subscribe({next:()=>{this.toastr.success("Marks updated successfully!","Success"),this.router.navigate(["/result/result-list"])},error:a=>this.handleError("update marks",a),complete:()=>this.isLoading=!1})}getPercentage(){return(this.marksForm.get("marksObtained")?.value||0)/this.maxMarks*100}handleError(e,a){console.error(`Error ${e}:`,a);let n=`Failed to ${e}. Please try again.`;a?.error?.error?n=a.error.error:a?.message?n=a.message:a?.error&&(n="string"==typeof a.error?a.error:JSON.stringify(a.error)),this.toastr.error(n,`${e.charAt(0).toUpperCase()+e.slice(1)} Error`),this.isLoading=!1}cancel(){this.router.navigate(["/result/result-list"])}static{this.\u0275fac=function(a){return new(a||s)(t.rXU(_.nX),t.rXU(_.Ix),t.rXU(l.L),t.rXU(u.u),t.rXU(h.tw),t.rXU(o.ok),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-edit-result"]],decls:10,vars:3,consts:[["loadingSpinner",""],[1,"container-fluid","p-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],[1,"fas","fa-edit","me-2","text-primary"],[1,"btn","btn-primary",3,"click","disabled"],["class","row g-3 mb-4",4,"ngIf","ngIfElse"],[1,"row","g-3","mb-4"],[1,"col-12"],[1,"card","shadow-sm","border-0"],[1,"card-header","bg-primary","text-white"],[1,"fas","fa-info-circle","me-2"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],[1,"form-label"],["disabled","",1,"form-control",3,"value"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],[1,"card-header","bg-success","text-white"],[1,"fas","fa-edit","me-2"],[3,"formGroup"],[1,"col-md-6"],["for","marksObtained",1,"form-label"],[1,"text-danger"],[1,"input-group"],["type","number","id","marksObtained","formControlName","marksObtained","min","0",1,"form-control",3,"max","disabled"],[1,"input-group-text"],["class","text-danger small mt-1",4,"ngIf"],[1,"col-md-3"],[1,"badge",3,"ngClass"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-12","text-end"],["type","button",1,"btn","btn-secondary","me-2",3,"click","disabled"],[1,"fas","fa-arrow-left","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save","me-1"],["class","spinner-border spinner-border-sm ms-2","role","status",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","ms-2"],[1,"loading-overlay","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"ms-3","mb-0"]],template:function(a,n){if(1&a){const r=t.RV6();t.j41(0,"div",1)(1,"header",2)(2,"h2",3),t.nrm(3,"i",4),t.EFF(4,"Edit Marks"),t.k0s(),t.j41(5,"button",5),t.bIt("click",function(){return t.eBV(r),t.Njj(n.cancel())}),t.EFF(6," Result List "),t.k0s()(),t.DNE(7,$t,23,5,"div",6)(8,St,6,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&a){const r=t.sdS(9);t.R7$(5),t.Y8G("disabled",n.isLoading),t.R7$(2),t.Y8G("ngIf",!n.isLoading)("ngIfElse",r)}},dependencies:[g.MD,g.YU,g.bT,g.QX,o.X1,o.qT,o.me,o.Q0,o.BC,o.cb,o.VZ,o.zX,o.j4,o.JD,o.YN],styles:[".loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#fffc;z-index:1000}.card[_ngcontent-%COMP%]{border-radius:.5rem}.card-header[_ngcontent-%COMP%]{font-weight:500}.input-group-text[_ngcontent-%COMP%]{background-color:#f8f9fa}.invalid-feedback[_ngcontent-%COMP%]{font-size:.8rem}"]})}}return s})();var Tt=m(4755);const At=[{path:"result-list",component:G,canActivate:[F.q],data:{roles:["teacher","admin"]}},{path:"admin-results",component:jt,canActivate:[F.q],data:{roles:["admin"]}},{path:"create-result",component:at,canActivate:[F.q],data:{roles:["teacher","admin"]}},{path:"edit/:resultId",component:Yt,canActivate:[F.q],data:{roles:["teacher","admin"]}},{path:"my-result",canActivate:[F.q],data:{roles:["student"]},component:Tt.StudentResultComponent}]}}]);