"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[253],{253:(C,b,a)=>{a.r(b),a.d(b,{classSubjectManagementRoute:()=>y});var h=a(177),m=a(9417),f=a(8359),e=a(4438),p=a(3891),_=a(5794);function n(r,c){if(1&r&&(e.j41(0,"div",21),e.EFF(1),e.k0s()),2&r){const s=e.XpG();e.R7$(),e.SpI(" ",s.error," ")}}function i(r,c){if(1&r&&(e.j41(0,"div",22),e.EFF(1),e.k0s()),2&r){const s=e.XpG();e.R7$(),e.SpI(" ",s.message," ")}}function d(r,c){if(1&r&&(e.j41(0,"option",23),e.EFF(1),e.k0s()),2&r){const s=c.$implicit;e.Y8G("value",s._id),e.R7$(),e.SpI(" ",s.name," ")}}function u(r,c){1&r&&e.nrm(0,"span",24)}function R(r,c){1&r&&e.nrm(0,"span",24)}function v(r,c){1&r&&e.nrm(0,"span",24)}function I(r,c){if(1&r){const s=e.RV6();e.j41(0,"tr",32)(1,"td",33),e.EFF(2),e.k0s(),e.j41(3,"td",33),e.EFF(4),e.k0s(),e.j41(5,"td",33),e.EFF(6),e.k0s(),e.j41(7,"td",33),e.EFF(8),e.k0s(),e.j41(9,"td",33),e.EFF(10),e.k0s(),e.j41(11,"td",33)(12,"input",34),e.mxI("ngModelChange",function(t){const l=e.eBV(s).$implicit;return e.DH7(l.newRollNo,t)||(l.newRollNo=t),e.Njj(t)}),e.k0s(),e.j41(13,"button",35),e.bIt("click",function(){const t=e.eBV(s).$implicit,l=e.XpG(2);return e.Njj(l.assignRollNumberToStudent(t))}),e.DNE(14,v,1,0,"span",16),e.EFF(15," Assign "),e.k0s()()()}if(2&r){const s=c.$implicit,o=e.XpG(2);e.R7$(2),e.JRh(s.admissionNo),e.R7$(2),e.JRh(s.name),e.R7$(2),e.JRh((null==s.classId?null:s.classId.name)||"N/A"),e.R7$(2),e.JRh(s.section.join(", ")),e.R7$(2),e.JRh(s.rollNo||"Not assigned"),e.R7$(2),e.R50("ngModel",s.newRollNo),e.R7$(),e.Y8G("disabled",o.loading),e.R7$(),e.Y8G("ngIf",o.loading)}}function N(r,c){if(1&r&&(e.j41(0,"div",25)(1,"h3",26),e.EFF(2),e.k0s(),e.j41(3,"div",27)(4,"table",28)(5,"thead",29)(6,"tr")(7,"th",30),e.EFF(8,"Admission No"),e.k0s(),e.j41(9,"th",30),e.EFF(10,"Name"),e.k0s(),e.j41(11,"th",30),e.EFF(12,"Class"),e.k0s(),e.j41(13,"th",30),e.EFF(14,"Section"),e.k0s(),e.j41(15,"th",30),e.EFF(16,"Roll Number"),e.k0s(),e.j41(17,"th",30),e.EFF(18,"Action"),e.k0s()()(),e.j41(19,"tbody"),e.DNE(20,I,16,8,"tr",31),e.k0s()()()()),2&r){const s=e.XpG();e.Y8G("@slideInOut",void 0),e.R7$(2),e.SpI("Students in ",s.selectedClassName,""),e.R7$(18),e.Y8G("ngForOf",s.students)}}function j(r,c){1&r&&(e.j41(0,"div",36),e.nrm(1,"i",37),e.j41(2,"p"),e.EFF(3,"Please select a class to view students."),e.k0s()())}function M(r,c){1&r&&(e.j41(0,"div",38),e.nrm(1,"div",24),e.k0s())}const y=[{path:"list",loadComponent:()=>a.e(809).then(a.bind(a,809)).then(r=>r.ClassSubjectComponent)},{path:"combined-class-and-subject",loadComponent:()=>a.e(8877).then(a.bind(a,8877)).then(r=>r.CombinedClassSubjectManagementComponent)},{path:"assign-roll-numbers",component:(()=>{class r{constructor(s,o){this.classSubjectService=s,this.toastr=o,this.classes=[],this.selectedClassId=null,this.selectedClassName=null,this.students=[],this.message=null,this.error=null,this.loading=!1,this.subscriptions=new f.yU}ngOnInit(){this.fetchClasses()}ngOnDestroy(){this.subscriptions.unsubscribe()}fetchClasses(){const s=localStorage.getItem("schoolId");if(!s)return this.error="School ID not found. Please log in again.",void this.toastr.error(this.error,"Error");const o=this.classSubjectService.getClassesBySchool(s).subscribe({next:t=>{this.classes=t,this.error=null},error:t=>{this.error="Error fetching classes: "+(t.error?.message||t.message),this.toastr.error(this.error,"Error")}});this.subscriptions.add(o)}fetchStudents(s){const o=localStorage.getItem("activeAcademicYearId");if(!o)return this.error="Active academic year not found. Please log in again or select an academic year.",void this.toastr.error(this.error,"Error");this.loading=!0,this.error=null;const t=this.classSubjectService.getStudentsByClass(s,o).subscribe({next:l=>{this.students=l.students.map(g=>({...g,newRollNo:g.rollNo||""})),0===this.students.length&&this.toastr.info("No students found for this class.","Info"),this.loading=!1},error:l=>{this.error="Error fetching students: "+(l.error?.message||l.message),this.toastr.error(this.error,"Error"),this.students=[],this.loading=!1}});this.subscriptions.add(t)}assignRollNumbers(){if(!this.selectedClassId)return this.error="Please select a class",void this.toastr.warning(this.error,"Warning");this.loading=!0,this.message=null,this.error=null;const s=this.classSubjectService.assignRollNumbers(this.selectedClassId).subscribe({next:o=>{this.loading=!1,this.message=o.message,this.toastr.success(this.message,"Success"),this.selectedClassId&&this.fetchStudents(this.selectedClassId)},error:o=>{this.loading=!1,this.error="Error assigning roll numbers: "+(o.error?.message||o.message),this.toastr.error(this.error,"Error")}});this.subscriptions.add(s)}assignRollNumbersAlphabetically(){if(!this.selectedClassId)return this.error="Please select a class",void this.toastr.warning(this.error,"Warning");this.loading=!0,this.message=null,this.error=null;const s=this.classSubjectService.assignRollNumbersAlphabetically(this.selectedClassId).subscribe({next:o=>{this.loading=!1,this.message=o.message,this.toastr.success(this.message,"Success"),this.selectedClassId&&this.fetchStudents(this.selectedClassId)},error:o=>{this.loading=!1,this.error="Error assigning roll numbers alphabetically: "+(o.error?.message||o.message),this.toastr.error(this.error,"Error")}});this.subscriptions.add(s)}assignRollNumberToStudent(s){if(!s.newRollNo)return this.error=`Please enter a roll number for ${s.name} (Admission No: ${s.admissionNo})`,void this.toastr.warning(this.error,"Warning");this.loading=!0,this.message=null,this.error=null;const o=this.classSubjectService.assignRollNumberToStudent(s._id,s.newRollNo).subscribe({next:t=>{if(this.loading=!1,this.message=t.message||"Roll number assigned successfully",this.toastr.success(this.message,"Success"),t.student){const l=this.students.findIndex(g=>g._id===s._id);l>-1&&(this.students[l].rollNo=t.student.rollNo,this.students[l].newRollNo=t.student.rollNo)}this.selectedClassId&&this.fetchStudents(this.selectedClassId)},error:t=>{this.loading=!1,this.error="Error assigning roll number: "+(t.error?.message||t.message),this.toastr.error(this.error,"Error")}});this.subscriptions.add(o)}onClassChange(s){this.selectedClassId=s.target.value,this.selectedClassName=this.classes.find(t=>t._id===this.selectedClassId)?.name||null,this.students=[],this.message=null,this.error=null,this.selectedClassId&&this.fetchStudents(this.selectedClassId)}static{this.\u0275fac=function(o){return new(o||r)(e.rXU(p.e),e.rXU(_.tw))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-assign-roll-numbers"]],decls:29,vars:13,consts:[[1,"container-fluid","py-6","bg-gray-50","min-h-screen"],[1,"row","justify-content-center"],[1,"col-12","col-lg-12"],[1,"card","bg-white","shadow-xl","rounded-xl","overflow-hidden"],[1,"card-header","bg-gradient-to-r","from-blue-700","to-blue-900","text-white","p-2"],[1,"text-xl","font-semibold",2,"color","whitesmoke"],[1,"card-body","p-6"],["class","alert alert-danger mb-4","role","alert",4,"ngIf"],["class","alert alert-success mb-4","role","alert",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-6"],["for","classSelect",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"custom-select-wrapper"],["id","classSelect",1,"custom-select",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn-primary",3,"click","disabled"],["class","spinner",4,"ngIf"],[1,"btn-secondary",3,"click","disabled"],["class","data-grid-container",4,"ngIf"],["class","text-center py-6 text-gray-500",4,"ngIf"],["class","loading-overlay",4,"ngIf"],["role","alert",1,"alert","alert-danger","mb-4"],["role","alert",1,"alert","alert-success","mb-4"],[3,"value"],[1,"spinner"],[1,"data-grid-container"],[1,"text-lg","font-medium","text-gray-700","mb-4"],[1,"data-grid-wrapper","overflow-x-auto"],[1,"data-grid","w-full"],[1,"bg-blue-100","sticky","top-0","z-10"],[1,"p-2","text-left"],["class","hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","transition-colors"],[1,"p-2"],["type","text","placeholder","Enter roll number",1,"input-field",3,"ngModelChange","ngModel"],[1,"btn-action",3,"click","disabled"],[1,"text-center","py-6","text-gray-500"],[1,"fas","fa-exclamation-circle","text-2xl","mb-2"],[1,"loading-overlay"]],template:function(o,t){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h2",5),e.EFF(6,"Assign Roll Numbers"),e.k0s()(),e.j41(7,"div",6),e.DNE(8,n,2,1,"div",7)(9,i,2,1,"div",8),e.j41(10,"div",9)(11,"div")(12,"label",10),e.EFF(13,"Select Class"),e.k0s(),e.j41(14,"div",11)(15,"select",12),e.mxI("ngModelChange",function(g){return e.DH7(t.selectedClassId,g)||(t.selectedClassId=g),g}),e.bIt("change",function(g){return t.onClassChange(g)}),e.j41(16,"option",13),e.EFF(17,"Select a class"),e.k0s(),e.DNE(18,d,2,2,"option",14),e.k0s()()()(),e.j41(19,"div",9)(20,"button",15),e.bIt("click",function(){return t.assignRollNumbers()}),e.DNE(21,u,1,0,"span",16),e.EFF(22),e.k0s(),e.j41(23,"button",17),e.bIt("click",function(){return t.assignRollNumbersAlphabetically()}),e.DNE(24,R,1,0,"span",16),e.EFF(25),e.k0s()(),e.DNE(26,N,21,3,"div",18)(27,j,4,0,"div",19)(28,M,2,0,"div",20),e.k0s()()()()()),2&o&&(e.R7$(8),e.Y8G("ngIf",t.error),e.R7$(),e.Y8G("ngIf",t.message),e.R7$(6),e.R50("ngModel",t.selectedClassId),e.R7$(3),e.Y8G("ngForOf",t.classes),e.R7$(2),e.Y8G("disabled",t.loading||!t.selectedClassId),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.SpI(" ",t.loading?"Assigning...":"Assign to All (Creation Order)"," "),e.R7$(),e.Y8G("disabled",t.loading||!t.selectedClassId),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.SpI(" ",t.loading?"Assigning...":"Assign Alphabetically"," "),e.R7$(),e.Y8G("ngIf",t.students.length>0),e.R7$(),e.Y8G("ngIf",0===t.students.length&&!t.loading),e.R7$(),e.Y8G("ngIf",t.loading))},dependencies:[h.MD,h.Sq,h.bT,m.YN,m.xH,m.y7,m.me,m.wz,m.BC,m.vS],styles:['@import"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap";.container-fluid[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;background-color:#f5f7fa;padding-top:1.5rem;padding-bottom:1.5rem}.card[_ngcontent-%COMP%]{border:none;border-radius:.75rem;overflow:hidden;box-shadow:0 4px 12px #0000000d;transition:transform .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-4px)}.card-header[_ngcontent-%COMP%]{padding:1rem;background:linear-gradient(90deg,#4a90e2,#50c9c3);color:#fff!important}.card-body[_ngcontent-%COMP%]{padding:2rem}.custom-select-wrapper[_ngcontent-%COMP%]{position:relative}.custom-select[_ngcontent-%COMP%]{width:100%;padding:.75rem 1.5rem;border:2px solid #e2e8f0;border-radius:.5rem;background:#fff url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="%234a90e2"><path d="M7.293 4.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 011.414-1.414L6 6.586l2.293-2.293z"/></svg>\') no-repeat right .75rem center;background-size:12px;font-size:.95rem;color:#2d3748;appearance:none;cursor:pointer;transition:border-color .3s ease,box-shadow .3s ease}.custom-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a90e2;box-shadow:0 0 0 3px #4a90e233}.alert[_ngcontent-%COMP%]{padding:1rem;border-radius:.5rem;font-size:.95rem;margin-bottom:1rem}.alert-success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}.alert-danger[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(90deg,#ff9800,#ffb74d);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .2s ease;width:100%}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#e68a00,#ff9800);transform:translateY(-2px)}.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(90deg,#4a90e2,#63b3ed);color:#fff;padding:.75rem 1.5rem;border:none;border-radius:.5rem;font-size:1rem;font-weight:500;cursor:pointer;transition:background .3s ease,transform .2s ease;width:100%}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#357abd,#4a90e2);transform:translateY(-2px)}.btn-primary[_ngcontent-%COMP%]:disabled, .btn-secondary[_ngcontent-%COMP%]:disabled{background:#a0aec0;cursor:not-allowed;transform:none}.btn-action[_ngcontent-%COMP%]{background:linear-gradient(90deg,#2196f3,#42a5f5);color:#fff;padding:.5rem 1rem;border:none;border-radius:.375rem;font-size:.9rem;cursor:pointer;transition:background .3s ease}.btn-action[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(90deg,#1976d2,#2196f3)}.input-field[_ngcontent-%COMP%]{padding:.5rem;border:2px solid #e2e8f0;border-radius:.375rem;font-size:.9rem;width:100px;margin-right:.5rem;transition:border-color .3s ease}.input-field[_ngcontent-%COMP%]:focus{border-color:#4a90e2;outline:none}.data-grid-container[_ngcontent-%COMP%]{margin-top:1.5rem}.data-grid-wrapper[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:.5rem}.data-grid[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0}.data-grid[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f7fa;color:#2d3748;font-weight:500;padding:.75rem;text-align:left;border-bottom:2px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid #e2e8f0}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fafafa}.data-grid[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#edf2f7}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000001a;display:flex;justify-content:center;align-items:center;z-index:20}.spinner[_ngcontent-%COMP%]{width:2rem;height:2rem;border:3px solid #f3f3f3;border-top:3px solid #4a90e2;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:.5rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.data-grid[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-grid[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:.5rem;font-size:.9rem}}']})}}return r})()}]},3891:(C,b,a)=>{a.d(b,{e:()=>e});var h=a(1626),m=a(2525),f=a(4438);let e=(()=>{class p{constructor(n){this.http=n,this.apiUrl=m.c.apiUrl}getClassesBySchool(n){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${n}`)}getStudentsByClass(n,i){const d=`${this.apiUrl}/api/students/get-student-by-class/${n}`,u=(new h.Nl).set("academicYearId",i);return this.http.get(d,{params:u})}assignRollNumbers(n){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${n}`,{})}assignRollNumbersAlphabetically(n){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${n}`,{})}assignRollNumberToStudent(n,i){return this.http.put(`${this.apiUrl}/api/students/${n}/assign-roll-number`,{rollNo:i})}createClass(n){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,n)}deleteAssignment(n){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:n})}createSubject(n){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,n)}getSubjects(n){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${n}`)}getTeachers(n){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${n}`)}getCombinedAssignments(n,i){const d=(new h.Nl).set("academicYearId",i);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${n}`,{params:d})}assignSubjectToClass(n,i,d,u){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:n,subjectId:i,teacherId:d,academicYearId:u})}updateAssignment(n){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,n)}getAssignmentsByTeacher(n,i,d){let u=(new h.Nl).set("academicYearId",i);return d&&(u=u.set("date",d)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${n}`,{params:u})}updateAttendanceTeachers(n,i,d){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:n,attendanceTeacher:i,substituteAttendanceTeachers:d})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(i){return new(i||p)(f.KVO(h.Qq))}}static{this.\u0275prov=f.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()}}]);