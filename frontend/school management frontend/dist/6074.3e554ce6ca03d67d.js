"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[6074],{3891:(C,b,l)=>{l.d(b,{e:()=>v});var p=l(1626),a=l(2525),t=l(4438);let v=(()=>{class _{constructor(s){this.http=s,this.apiUrl=a.c.apiUrl}getClassesBySchool(s){return this.http.get(`${this.apiUrl}/api/class-subject-management/classes/${s}`)}getStudentsByClass(s,i){const c=`${this.apiUrl}/api/students/get-student-by-class/${s}`,m=(new p.Nl).set("academicYearId",i);return this.http.get(c,{params:m})}assignRollNumbers(s){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers?classId=${s}`,{})}assignRollNumbersAlphabetically(s){return this.http.post(`${this.apiUrl}/api/students/assign-roll-numbers-alphabetically?classId=${s}`,{})}assignRollNumberToStudent(s,i){return this.http.put(`${this.apiUrl}/api/students/${s}/assign-roll-number`,{rollNo:i})}createClass(s){return this.http.post(`${this.apiUrl}/api/class-subject-management/classes`,s)}deleteAssignment(s){return this.http.delete(`${this.apiUrl}/api/class-subject-management/assign-subject`,{body:s})}createSubject(s){return this.http.post(`${this.apiUrl}/api/class-subject-management/subject`,s)}getSubjects(s){return this.http.get(`${this.apiUrl}/api/class-subject-management/subjects/${s}`)}getTeachers(s){return this.http.get(`${this.apiUrl}/api/class-subject-management/teachers/by-school/${s}`)}getCombinedAssignments(s,i){const c=(new p.Nl).set("academicYearId",i);return this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/${s}`,{params:c})}assignSubjectToClass(s,i,c,m){return this.http.post(`${this.apiUrl}/api/class-subject-management/assign-subject`,{classId:s,subjectId:i,teacherId:c,academicYearId:m})}updateAssignment(s){return this.http.put(`${this.apiUrl}/api/class-subject-management/assign-subject`,s)}getAssignmentsByTeacher(s,i,c){let m=(new p.Nl).set("academicYearId",i);return c&&(m=m.set("date",c)),this.http.get(`${this.apiUrl}/api/class-subject-management/assignments/teacher/${s}`,{params:m})}updateAttendanceTeachers(s,i,c){return this.http.put(`${this.apiUrl}/api/class-subject-management/update-attendance-teachers`,{classId:s,attendanceTeacher:i,substituteAttendanceTeachers:c})}getTeacherAttendanceClasses(){return this.http.get(`${this.apiUrl}/api/class-subject-management/teacher-classes`)}static{this.\u0275fac=function(i){return new(i||_)(t.KVO(p.Qq))}}static{this.\u0275prov=t.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},6074:(C,b,l)=>{l.r(b),l.d(b,{StudentProgressReportComponent:()=>S});var p=l(177),a=l(9417),t=l(4438),v=l(3891),_=l(5794),P=l(749),s=l(998);const i=o=>({"is-invalid":o});function c(o,d){1&o&&(t.j41(0,"div",7),t.nrm(1,"div",8),t.k0s())}function m(o,d){if(1&o&&(t.j41(0,"option",22),t.EFF(1),t.k0s()),2&o){const e=d.$implicit;t.Y8G("value",e._id),t.R7$(),t.SpI(" ",e.name," ")}}function x(o,d){1&o&&(t.j41(0,"div",23),t.EFF(1," Class is required "),t.k0s())}function I(o,d){1&o&&(t.j41(0,"div",23),t.EFF(1," Valid grades required "),t.k0s())}function F(o,d){1&o&&(t.j41(0,"div",23),t.EFF(1," Comments required (max 160 chars) "),t.k0s())}function E(o,d){if(1&o&&(t.j41(0,"tr",34)(1,"td",35),t.EFF(2),t.k0s(),t.j41(3,"td")(4,"div",36)(5,"div",37)(6,"div",38),t.EFF(7),t.k0s()(),t.j41(8,"div")(9,"div",39),t.EFF(10),t.k0s()()()(),t.j41(11,"td",40),t.EFF(12),t.k0s(),t.j41(13,"td"),t.nrm(14,"input",41),t.DNE(15,I,2,0,"div",17),t.k0s(),t.j41(16,"td"),t.nrm(17,"textarea",42),t.DNE(18,F,2,0,"div",17),t.k0s()()),2&o){let e,r,n,h;const f=d.$implicit,g=d.index,u=t.XpG(3);t.Y8G("formGroupName",g),t.R7$(2),t.JRh(g+1),t.R7$(5),t.SpI(" ",u.getInitials(f.name)," "),t.R7$(3),t.JRh(f.name),t.R7$(2),t.JRh(f.admissionNo),t.R7$(2),t.Y8G("ngClass",t.eq3(9,i,(null==(e=u.studentProgress.controls[g].get("grades"))?null:e.invalid)&&(null==(e=u.studentProgress.controls[g].get("grades"))?null:e.touched))),t.R7$(),t.Y8G("ngIf",(null==(r=u.studentProgress.controls[g].get("grades"))?null:r.invalid)&&(null==(r=u.studentProgress.controls[g].get("grades"))?null:r.touched)),t.R7$(2),t.Y8G("ngClass",t.eq3(11,i,(null==(n=u.studentProgress.controls[g].get("comments"))?null:n.invalid)&&(null==(n=u.studentProgress.controls[g].get("comments"))?null:n.touched))),t.R7$(),t.Y8G("ngIf",(null==(h=u.studentProgress.controls[g].get("comments"))?null:h.invalid)&&(null==(h=u.studentProgress.controls[g].get("comments"))?null:h.touched))}}function O(o,d){if(1&o&&(t.j41(0,"div",43)(1,"div",44)(2,"div",45)(3,"div",46)(4,"div",37)(5,"div",38),t.EFF(6),t.k0s()(),t.j41(7,"div")(8,"h6",47),t.EFF(9),t.k0s(),t.j41(10,"small",48),t.EFF(11),t.k0s()()(),t.j41(12,"div",49)(13,"label",50),t.EFF(14,"Grades"),t.k0s(),t.nrm(15,"input",51),t.k0s(),t.j41(16,"div",49)(17,"label",50),t.EFF(18,"Comments"),t.k0s(),t.nrm(19,"textarea",52),t.k0s()()()()),2&o){const e=d.$implicit,r=d.index,n=t.XpG(3);t.Y8G("formGroupName",r),t.R7$(6),t.SpI(" ",n.getInitials(e.name)," "),t.R7$(3),t.JRh(e.name),t.R7$(2),t.SpI("Adm: ",e.admissionNo,"")}}function j(o,d){if(1&o&&(t.j41(0,"div",24)(1,"div",25)(2,"table",26)(3,"thead")(4,"tr")(5,"th",27),t.EFF(6,"#"),t.k0s(),t.j41(7,"th",28),t.EFF(8,"Student Name"),t.k0s(),t.j41(9,"th",29),t.EFF(10,"Admission No"),t.k0s(),t.j41(11,"th",30),t.EFF(12,"Grades"),t.k0s(),t.j41(13,"th",30),t.EFF(14,"Comments"),t.k0s()()(),t.j41(15,"tbody"),t.DNE(16,E,19,13,"tr",31),t.k0s()()(),t.j41(17,"div",32),t.DNE(18,O,20,4,"div",33),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(16),t.Y8G("ngForOf",e.students),t.R7$(2),t.Y8G("ngForOf",e.students)}}function M(o,d){1&o&&t.nrm(0,"span",53)}function R(o,d){if(1&o){const e=t.RV6();t.j41(0,"div",9)(1,"form",10),t.bIt("ngSubmit",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onSubmit())}),t.j41(2,"div",11)(3,"label",12),t.EFF(4,"Select Class "),t.j41(5,"span",13),t.EFF(6,"*"),t.k0s()(),t.j41(7,"select",14),t.bIt("change",function(n){t.eBV(e);const h=t.XpG();return t.Njj(h.onClassChange(n))}),t.j41(8,"option",15),t.EFF(9,"Choose a class..."),t.k0s(),t.DNE(10,m,2,2,"option",16),t.k0s(),t.DNE(11,x,2,0,"div",17),t.k0s(),t.DNE(12,j,19,2,"div",18),t.j41(13,"div",19)(14,"button",20),t.DNE(15,M,1,0,"span",21),t.EFF(16),t.k0s()()()()}if(2&o){let e,r;const n=t.XpG();t.R7$(),t.Y8G("formGroup",n.reportForm),t.R7$(6),t.Y8G("ngClass",t.eq3(8,i,(null==(e=n.reportForm.get("classId"))?null:e.invalid)&&(null==(e=n.reportForm.get("classId"))?null:e.touched))),t.R7$(3),t.Y8G("ngForOf",n.classList),t.R7$(),t.Y8G("ngIf",(null==(r=n.reportForm.get("classId"))?null:r.invalid)&&(null==(r=n.reportForm.get("classId"))?null:r.touched)),t.R7$(),t.Y8G("ngIf",n.students.length>0),t.R7$(2),t.Y8G("disabled",n.reportForm.invalid||n.loading||0===n.students.length),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.SpI(" ",n.loading?"Saving Reports...":"Save All Reports"," ")}}let S=(()=>{class o{constructor(e,r,n,h,f){this.fb=e,this.classSubjectService=r,this.toastr=n,this.router=h,this.studentService=f,this.students=[],this.loading=!1,this.assignments=[],this.classList=[],this.selectedClassId="",this.selectedAcademicYearId=localStorage.getItem("activeAcademicYearId")||"",this.selectedSchoolId=localStorage.getItem("schoolId")||"",this.teacherId=localStorage.getItem("teacherId")||localStorage.getItem("userId")||"",this.reportForm=this.fb.group({classId:["",a.k0.required],studentProgress:this.fb.array([])})}get studentProgress(){return this.reportForm.get("studentProgress")}ngOnInit(){this.validateSession(),this.loadTeacherAssignments()}validateSession(){if(!this.selectedSchoolId||!this.selectedAcademicYearId||!this.teacherId)return this.toastr.error("Session data missing. Please log in again.","Error"),void this.router.navigate(["/login"])}loadTeacherAssignments(){this.loading=!0;const e=(new Date).toISOString().split("T")[0];this.classSubjectService.getAssignmentsByTeacher(this.teacherId,this.selectedAcademicYearId,e).subscribe({next:r=>{this.assignments=r,this.classList=[...new Map(this.assignments.map(n=>[n.classId._id,{_id:n.classId._id,name:n.classId.name}])).values()],this.loading=!1,0===this.classList.length&&this.toastr.warning("No classes assigned to you for this academic year.","Warning")},error:r=>{this.loading=!1,this.toastr.error("Failed to load assignments: "+r.message,"Error")}})}onClassChange(e){const r=e.target.value;this.selectedClassId=r,this.reportForm.get("classId")?.setValue(r),this.loadStudents()}loadStudents(){if(!this.selectedClassId)return this.students=[],void this.studentProgress.clear();this.loading=!0,this.studentService.getStudentsByClass(this.selectedClassId,this.selectedAcademicYearId).subscribe({next:e=>{this.students=Array.isArray(e)?e:e?.students||e?.data||[],this.studentProgress.clear(),this.students.forEach(r=>{this.studentProgress.push(this.fb.group({studentId:[r._id,a.k0.required],grades:["",[a.k0.required,a.k0.pattern(/^[A-Za-z0-9\s,:;]+$/)]],comments:["",[a.k0.required,a.k0.maxLength(160)]]}))}),0===this.students.length&&this.toastr.warning("No students found in this class.","Warning"),this.loading=!1},error:e=>{this.loading=!1,this.toastr.error("Failed to load students: "+e.message,"Error")}})}onSubmit(){this.reportForm.invalid?this.toastr.error("Please fill all required fields for all students.","Error"):(this.loading=!0,this.studentService.studentProgressReport({studentProgress:this.studentProgress.value}).subscribe({next:()=>{this.toastr.success("Progress reports saved successfully!","Success"),this.reportForm.reset(),this.studentProgress.clear(),this.students=[],this.selectedClassId="",this.loading=!1},error:r=>{this.toastr.error("Failed to save reports: "+(r.error?.message||r.message),"Error"),this.loading=!1}}))}getInitials(e){return e?.trim().split(" ").map(r=>r[0]?.toUpperCase()).join("").slice(0,2)||"??"}static{this.\u0275fac=function(r){return new(r||o)(t.rXU(a.ok),t.rXU(v.e),t.rXU(_.tw),t.rXU(P.Ix),t.rXU(s.b))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-student-progress-report"]],decls:9,vars:2,consts:[[1,"progress-report-container"],[1,"header-section"],[1,"header-card"],[1,"title"],[1,"subtitle"],["class","text-center py-5",4,"ngIf"],["class","controls-card",4,"ngIf"],[1,"text-center","py-5"],[1,"spinner-border","text-primary","spinner-large"],[1,"controls-card"],[3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","fw-600"],[1,"text-danger"],["id","classId","formControlName","classId",1,"form-select","form-select-lg","shadow-sm",3,"change","ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["class","mt-4","formArrayName","studentProgress",4,"ngIf"],[1,"mt-5"],["type","submit",1,"btn","btn-primary","btn-lg","w-100","shadow-lg",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[3,"value"],[1,"invalid-feedback"],["formArrayName","studentProgress",1,"mt-4"],[1,"table-responsive","d-none","d-lg-block"],[1,"table","professional-table","table-hover","align-middle"],["width","5%"],["width","30%"],["width","15%"],["width","25%"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"d-block","d-lg-none"],["class","student-mobile-card mb-4",3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"text-center","fw-bold"],[1,"d-flex","align-items-center"],[1,"avatar-sm","me-3"],[1,"avatar-placeholder"],[1,"fw-600"],[1,"text-center"],["type","text","formControlName","grades","placeholder","e.g., Math: A, Science: B",1,"form-control",3,"ngClass"],["rows","2","formControlName","comments","placeholder","Enter comments...",1,"form-control",3,"ngClass"],[1,"student-mobile-card","mb-4",3,"formGroupName"],[1,"card","shadow-sm","border-0"],[1,"card-body"],[1,"d-flex","align-items-center","mb-3"],[1,"mb-0","fw-bold"],[1,"text-muted"],[1,"mb-3"],[1,"form-label","small","text-muted"],["type","text","formControlName","grades","placeholder","Math: A, Science: B",1,"form-control"],["rows","3","formControlName","comments","placeholder","Great improvement...",1,"form-control"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(r,n){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),t.EFF(4,"Weekly Progress Report"),t.k0s(),t.j41(5,"p",4),t.EFF(6,"Submit grades and feedback for your students"),t.k0s()()(),t.DNE(7,c,2,0,"div",5)(8,R,17,10,"div",6),t.k0s()),2&r&&(t.R7$(7),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("ngIf",!n.loading))},dependencies:[p.MD,p.YU,p.Sq,p.bT,a.X1,a.qT,a.xH,a.y7,a.me,a.wz,a.BC,a.cb,a.j4,a.JD,a.$R,a.v8],styles:[".progress-report-container[_ngcontent-%COMP%]{padding:16px;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;font-family:Poppins,sans-serif}.progress-report-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]{margin-bottom:24px}.progress-report-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]{background:#fffffff7;border-radius:20px;padding:28px;text-align:center;box-shadow:0 8px 25px #0000001a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.progress-report-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;background:linear-gradient(135deg,#4a90e2,#50c9c3);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0}.progress-report-container[_ngcontent-%COMP%]   .header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#64748b;font-size:1.1rem;margin-top:8px}.progress-report-container[_ngcontent-%COMP%]   .controls-card[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:28px;box-shadow:0 12px 35px #0000001f;border:1px solid #e2e8f0}.progress-report-container[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{padding:14px;font-size:1.1rem;border-radius:16px;border:2px solid #cbd5e0;transition:all .3s}.progress-report-container[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]:focus{border-color:#4a90e2;box-shadow:0 0 0 4px #4a90e233}.progress-report-container[_ngcontent-%COMP%]   .professional-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;font-size:.85rem;text-transform:uppercase;letter-spacing:.8px;font-weight:600}.progress-report-container[_ngcontent-%COMP%]   .avatar-sm[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#4a90e2,#50c9c3);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:.9rem;flex-shrink:0}.progress-report-container[_ngcontent-%COMP%]   .avatar-placeholder[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#4a90e2,#50c9c3);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600;font-size:1rem}.progress-report-container[_ngcontent-%COMP%]   .student-mobile-card[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{border-radius:18px;border:1px solid #e2e8f0;transition:transform .2s}.progress-report-container[_ngcontent-%COMP%]   .student-mobile-card[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 12px 30px #00000026}.progress-report-container[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4a90e2,#50c9c3);border:none;border-radius:30px;padding:16px;font-size:1.1rem;font-weight:600;box-shadow:0 8px 25px #4a90e266}.progress-report-container[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 12px 35px #4a90e280}"]})}}return o})()}}]);