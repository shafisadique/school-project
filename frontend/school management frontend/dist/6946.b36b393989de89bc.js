"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[6946],{6946:($,h,r)=>{r.r(h),r.d(h,{AnnouncementCreateComponent:()=>T});var e=r(4438),a=r(9417),m=r(749),u=r(5794),c=r(177),p=r(1626),f=r(6561),d=r(2525);let g=(()=>{class s{constructor(){this.http=(0,e.WQX)(p.Qq),this.baseUrl=d.c.apiUrl}create(t){return this.http.post(`${this.baseUrl}/api/auth/announcements`,t)}getList(t=1,i=10){return this.http.get(`${this.baseUrl}/api/auth/announcements?page=${t}&limit=${i}`)}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();function b(s,l){1&s&&(e.j41(0,"div",27),e.EFF(1," Title is required "),e.k0s())}function v(s,l){1&s&&(e.j41(0,"div",27),e.EFF(1," Message is required "),e.k0s())}function x(s,l){if(1&s){const t=e.RV6();e.j41(0,"button",28),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.onToggleChange(n.key))}),e.EFF(1),e.k0s()}if(2&s){const t=l.$implicit,i=e.XpG();e.AVh("active",i.activeToggle===t.key),e.R7$(),e.SpI(" ",t.label," ")}}function k(s,l){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",39),e.bIt("change",function(n){const o=e.eBV(t).$implicit,U=e.XpG(2);return e.Njj(U.onUserToggle(o._id,n))}),e.k0s()(),e.j41(3,"td",40),e.EFF(4),e.k0s(),e.j41(5,"td",41),e.EFF(6),e.k0s()()}if(2&s){const t=l.$implicit,i=e.XpG(2);e.R7$(2),e.Y8G("id","user-"+t._id)("checked",i.isUserSelected(t._id)),e.R7$(2),e.JRh(t.name),e.R7$(2),e.SpI(" ",t.phone||t.email||"No contact"," ")}}function F(s,l){if(1&s&&(e.j41(0,"div",42)(1,"strong"),e.EFF(2),e.k0s(),e.EFF(3),e.k0s()),2&s){const t=e.XpG(2);e.R7$(2),e.JRh(t.getSelectedCount()),e.R7$(),e.SpI(" selected out of ",t.users.length," ")}}function C(s,l){if(1&s){const t=e.RV6();e.j41(0,"div",29)(1,"div",30)(2,"input",31),e.bIt("change",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.selectAll(n))}),e.k0s(),e.j41(3,"label",32),e.EFF(4),e.k0s()(),e.j41(5,"div",33)(6,"table",34)(7,"thead",35)(8,"tr")(9,"th"),e.nrm(10,"input",36),e.k0s(),e.j41(11,"th"),e.EFF(12,"Name"),e.k0s(),e.j41(13,"th"),e.EFF(14,"Contact"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,k,7,4,"tr",37),e.k0s()()(),e.DNE(17,F,4,2,"div",38),e.k0s()}if(2&s){const t=e.XpG();e.R7$(2),e.Y8G("checked",t.isAllSelected()),e.R7$(2),e.SpI(" Select All (",t.users.length,") "),e.R7$(12),e.Y8G("ngForOf",t.users),e.R7$(),e.Y8G("ngIf",t.getSelectedCount()>0)}}function _(s,l){if(1&s&&(e.j41(0,"div",43),e.nrm(1,"i",44),e.j41(2,"p"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG();e.R7$(3),e.SpI("No ",t.activeToggle,"s found")}}function j(s,l){1&s&&e.nrm(0,"span",45)}let T=(()=>{class s{constructor(){this.fb=(0,e.WQX)(a.ok),this.authService=(0,e.WQX)(f.u),this.toastr=(0,e.WQX)(u.tw),this.router=(0,e.WQX)(m.Ix),this.http=(0,e.WQX)(p.Qq),this.announcementService=(0,e.WQX)(g),this.form=this.fb.group({title:["",[a.k0.required]],body:["",[a.k0.required]]}),this.schoolId=this.authService.getUserSchoolId(),this.loading=!1,this.activeToggle="",this.users=[],this.selectedUsers=[],this.toggles=[{key:"teacher",label:"Teachers"},{key:"student",label:"Students"},{key:"parent",label:"Parents"}]}onToggleChange(t){if(this.activeToggle===t)return this.activeToggle="",this.users=[],void(this.selectedUsers=[]);this.activeToggle=t,this.loadUsers(t)}loadUsers(t){this.loading=!0,this.selectedUsers=[];let i=`${d.c.apiUrl}/api/${t}s/list?all=true&schoolId=${this.schoolId}`;"parent"===t&&(i=`${d.c.apiUrl}/api/students/list?all=true&schoolId=${this.schoolId}`),this.http.get(i).subscribe({next:n=>{this.users="parent"===t?n.students.map(o=>({_id:o._id,name:`Parent of ${o.name}`,email:o.email,phone:o.parents?.fatherPhone||o.parents?.motherPhone})).filter(o=>o.phone):"teacher"===t?n.data.map(o=>({_id:o.userId._id,name:o.name,email:o.email,phone:o.phone})):n.students||n.data||[],this.loading=!1},error:n=>{this.toastr.error("Load failed"),this.loading=!1}})}selectAll(t){const i=t.target.checked;this.users.forEach(n=>{if(i)this.selectedUsers.includes(n._id)||this.selectedUsers.push(n._id);else{const o=this.selectedUsers.indexOf(n._id);o>-1&&this.selectedUsers.splice(o,1)}})}onUserToggle(t,i){if(i.target.checked)this.selectedUsers.includes(t)||this.selectedUsers.push(t);else{const o=this.selectedUsers.indexOf(t);o>-1&&this.selectedUsers.splice(o,1)}}isUserSelected(t){return this.selectedUsers.includes(t)}isAllSelected(){return this.users.length>0&&this.selectedUsers.length===this.users.length}getSelectedCount(){return this.selectedUsers.length}onSubmit(){if(this.form.invalid||0===this.selectedUsers.length)return void this.toastr.warning("Fill form and select users");this.loading=!0;const t={...this.form.value,body:this.form.value.body};this.activeToggle&&(t.targetRoles=[this.activeToggle]),this.selectedUsers.length>0&&(t.targetUsers=this.selectedUsers),console.log("FINAL PAYLOAD \u2192",t),this.announcementService.create(t).subscribe({next:()=>{this.toastr.success(`Sent to ${this.selectedUsers.length} users!`),this.router.navigate(["/announcement"])},error:i=>this.toastr.error("Failed"),complete:()=>this.loading=!1})}get f(){return this.form.controls}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-announcement-create"]],decls:42,vars:9,consts:[[1,"container-fluid","py-3","py-md-4"],[1,"row","justify-content-center"],[1,"col-12","col-lg-10","col-xl-9"],[1,"header-section","mb-4"],[1,"header-card"],[1,"title"],[1,"subtitle"],[1,"form-section"],[1,"form-card"],[1,"fas","fa-bullhorn","me-2"],[1,"row","g-3",3,"ngSubmit","formGroup"],[1,"col-12"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","title","placeholder","e.g., Parent-Teacher Meeting on Friday",1,"form-control","form-control-sm"],["class","text-danger small mt-1",4,"ngIf"],["formControlName","body","rows","5","placeholder","Write your announcement here...",1,"form-control","form-control-sm"],[1,"col-12","mt-4"],[1,"mb-3"],["role","group",1,"btn-group","w-100","mb-3"],["type","button","class","btn btn-outline-primary flex-fill",3,"active","click",4,"ngFor","ngForOf"],["class","border rounded p-3 bg-light",4,"ngIf"],["class","text-center text-muted py-4",4,"ngIf"],[1,"col-12","mt-4","text-end"],["type","submit",1,"btn-material","btn-success",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"fas","fa-paper-plane","me-2"],[1,"text-danger","small","mt-1"],["type","button",1,"btn","btn-outline-primary","flex-fill",3,"click"],[1,"border","rounded","p-3","bg-light"],[1,"form-check","mb-3"],["type","checkbox","id","selectAll",1,"form-check-input",3,"change","checked"],["for","selectAll",1,"form-check-label","fw-bold"],[1,"table-responsive",2,"max-height","300px"],[1,"table","table-sm","table-hover"],[1,"table-secondary"],["type","checkbox","disabled",""],[4,"ngFor","ngForOf"],["class","alert alert-info small mt-3",4,"ngIf"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"fw-medium"],[1,"small","text-muted"],[1,"alert","alert-info","small","mt-3"],[1,"text-center","text-muted","py-4"],[1,"fas","fa-users","fa-2x","mb-3"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h1",5),e.EFF(6,"Create Announcement"),e.k0s(),e.j41(7,"p",6),e.EFF(8,"Send important messages to teachers, parents, or students"),e.k0s()()(),e.j41(9,"div",7)(10,"div",8)(11,"fieldset")(12,"legend"),e.nrm(13,"i",9),e.EFF(14," New Announcement"),e.k0s(),e.j41(15,"form",10),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(16,"div",11)(17,"label",12),e.EFF(18,"Title "),e.j41(19,"span",13),e.EFF(20,"*"),e.k0s()(),e.nrm(21,"input",14),e.DNE(22,b,2,0,"div",15),e.k0s(),e.j41(23,"div",11)(24,"label",12),e.EFF(25,"Message "),e.j41(26,"span",13),e.EFF(27,"*"),e.k0s()(),e.nrm(28,"textarea",16),e.DNE(29,v,2,0,"div",15),e.k0s(),e.j41(30,"div",17)(31,"h5",18),e.EFF(32,"Send To"),e.k0s(),e.j41(33,"div",19),e.DNE(34,x,2,3,"button",20),e.k0s(),e.DNE(35,C,18,4,"div",21)(36,_,4,1,"div",22),e.k0s(),e.j41(37,"div",23)(38,"button",24),e.DNE(39,j,1,0,"span",25),e.nrm(40,"i",26),e.EFF(41),e.k0s()()()()()()()()()),2&i&&(e.R7$(15),e.Y8G("formGroup",n.form),e.R7$(7),e.Y8G("ngIf",n.f.title.invalid&&n.f.title.touched),e.R7$(7),e.Y8G("ngIf",n.f.body.invalid&&n.f.body.touched),e.R7$(5),e.Y8G("ngForOf",n.toggles),e.R7$(),e.Y8G("ngIf",n.activeToggle&&n.users.length>0),e.R7$(),e.Y8G("ngIf",n.activeToggle&&0===n.users.length&&!n.loading),e.R7$(2),e.Y8G("disabled",n.loading||n.form.invalid||0===n.selectedUsers.length),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(2),e.SpI(" Send to ",n.getSelectedCount()||0," Recipients "))},dependencies:[m.iI,a.X1,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,c.MD,c.Sq,c.bT],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap";@import"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css";@charset "UTF-8";.container-fluid[_ngcontent-%COMP%]{padding:16px;font-family:Poppins,sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh}.header-section[_ngcontent-%COMP%]   .header-card[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]   .form-card[_ngcontent-%COMP%]{background:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:12px;box-shadow:0 2px 4px -1px #00000014,0 1px 2px -1px #0000000a;border:1px solid #e5e7eb;padding:28px}legend[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:.7rem 1.6rem;border-radius:10px;font-weight:600;font-size:1.1rem;letter-spacing:1px;float:none;width:auto;margin:0 0 1.5rem;box-shadow:0 4px 15px #667eea4d}.btn-material.btn-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);padding:12px 28px;font-size:1rem;border-radius:50px;box-shadow:0 2px 4px -1px #00000014,0 1px 2px -1px #0000000a;transition:all .3s ease}.btn-material.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px #667eea26}']})}}return s})()}}]);