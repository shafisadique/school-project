<div class="container-fluid">
    <header class="header">
        <h2>Result Form</h2>
    </header>
    <div class="result-form" *ngIf="!isLoading; else loadingSpinner">
      <!-- Basic Information Section -->
      <div class="form-section">
        <h3>Basic Information</h3>
        <div class="grid-container">
          <div class="grid-column">
            <div class="form-group">
              <label for="academicYear">Academic Year</label>
              <select id="academicYear" [(ngModel)]="selectedAcademicYearId" (ngModelChange)="onAcademicYearChange()" name="academicYear" required>
                <option value="">Select Academic Year</option>
                <option *ngFor="let year of academicYears" [value]="year._id">{{ year.name }}</option>
              </select>
            </div>
          </div>
  
          <div class="grid-column">
            <div class="form-group">
              <label for="exam">Exam</label>
              <select id="exam" [(ngModel)]="selectedExamId" (ngModelChange)="onExamChange()" [disabled]="!selectedAcademicYearId" name="exam" required>
                <option value="">Select Exam</option>
                <option *ngFor="let exam of exams" [value]="exam._id">{{ exam.examTitle }}</option>
              </select>
            </div>
          </div>
  
          <div class="grid-column">
            <div class="form-group">
              <label for="class">Class</label>
              <select id="class" [(ngModel)]="selectedClassId" (ngModelChange)="onClassChange()" [disabled]="!selectedExamId" name="class" required>
                <option value="">Select Class</option>
                <option *ngFor="let class of classes" [value]="class._id">{{ class.name }}</option>
              </select>
            </div>
          </div>
  
          <div class="grid-column">
            <div class="form-group">
              <label for="student">Student</label>
              <select id="student" [(ngModel)]="selectedStudentId" [disabled]="!selectedClassId" name="student" required>
                <option value="">Select Student</option>
                <option *ngFor="let student of students" [value]="student._id">
                  {{ student.name }} (Roll No: {{ student.rollNo || 'N/A' }})
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Marks Entry Section -->
      <div class="form-section" *ngIf="subjects.length > 0">
        <h3>Enter Marks</h3>
        <div class="marks-table">
          <table>
            <thead>
              <tr>
                <th>Subject</th>
                <th>Marks Obtained</th>
                <th>Max Marks</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let subject of subjects; let i = index">
                <td>{{ subject.subjectId.name }}</td>
                <td>
                  <input type="number" [(ngModel)]="subject.marksObtained" [name]="'marksObtained-' + i" min="0" [max]="subject.maxMarks" required />
                </td>
                <td>{{ subject.maxMarks }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
  
      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="submit-button" (click)="createResult()" [disabled]="!selectedStudentId || !subjects.length || isLoading">
          Create Result
        </button>
        <button type="button" class="cancel-button" (click)="resetForm()" [disabled]="isLoading">
          Reset
        </button>
        <button type="button" class="back-button" [disabled]="isLoading" (click)="router.navigate(['/result-list'])">
          Back to List
        </button>
      </div>
    </div>
  
    <!-- Loading Spinner -->
    <ng-template #loadingSpinner>
      <div class="spinner">
        <div class="spinner-icon"></div>
        Loading...
      </div>
    </ng-template>
  </div>