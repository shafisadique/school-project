<div class="container-fluid py-3 py-md-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-9">
      <app-card cardTitle="Update Teacher">

        <form *ngIf="form" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
          <div class="row g-3">

            <!-- Personal Details -->
            <fieldset class="form-section">
              <legend>Personal Details</legend>
              
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <label class="form-label">Name <span class="text-danger">*</span></label>
                  <input type="text" class="form-control form-control-sm" formControlName="name" placeholder="Full name">
                  <div class="text-danger small mt-1" *ngIf="submitted && f['name'].errors?.['required']">
                    Name is required
                  </div>
                  <div class="text-danger small mt-1" *ngIf="submitted && f['name'].errors?.['minlength']">
                    Minimum 2 characters
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <label class="form-label">Email</label>
                  <input type="email" class="form-control form-control-sm" formControlName="email" placeholder="teacher@example.com">
                </div>

                <div class="col-12 col-md-4">
                  <label class="form-label">Phone</label>
                  <input type="text" class="form-control form-control-sm" formControlName="phone" placeholder="10 digits">
                  <div class="text-danger small mt-1" *ngIf="submitted && f['phone'].errors?.['pattern']">
                    10 digits only
                  </div>
                </div>

                <div class="col-12 col-md-4">
                  <label class="form-label">Gender <span class="text-danger">*</span></label>
                  <select class="form-select form-select-sm" formControlName="gender">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="text-danger small mt-1" *ngIf="submitted && f['gender'].errors?.['required']">
                    Gender required
                  </div>
                </div>

                <div class="col-12 col-md-4">
                  <label class="form-label">Designation <span class="text-danger">*</span></label>
                  <input type="text" class="form-control form-control-sm" formControlName="designation" placeholder="e.g., Math Teacher">
                  <div class="text-danger small mt-1" *ngIf="submitted && f['designation'].errors?.['required']">
                    Designation required
                  </div>
                </div>

                <div class="col-12">
                  <label class="form-label">Status <span class="text-danger">*</span></label>
                  <select class="form-select form-select-sm" formControlName="status">
                    <option [value]="true">Active</option>
                    <option [value]="false">Inactive</option>
                  </select>
                </div>
              <div class="col-12 col-md-6">
                <label>Qualification</label>
                <input type="text" class="form-control form-control-sm" formControlName="qualification">
              </div>

              <div class="col-12 col-md-6">
                <label>Joining Date</label>
                <input type="date" class="form-control form-control-sm" formControlName="joiningDate">
              </div>

              <div class="col-12 col-md-6">
                <label>Date of Birth</label>
                <input type="date" class="form-control form-control-sm" formControlName="dateOfBirth">
              </div>
              </div>
            </fieldset>

            <!-- Professional Details -->
            <fieldset class="form-section">
              <legend>Professional Details</legend>

              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label">Subjects Taught <span class="text-danger">*</span></label>
                  <ng-select 
                    [items]="subjectsList"
                    formControlName="subjects"
                    [multiple]="true"
                    placeholder="Select subjects"
                    [closeOnSelect]="false"
                    class="form-select-sm">
                  </ng-select>
                  <div class="text-danger small mt-1" *ngIf="submitted && f['subjects'].errors?.['minlength']">
                    Select at least one subject
                  </div>
                </div>
              </div>
            </fieldset>

            <!-- Profile Picture -->
            <fieldset class="form-section">
              <legend>Profile Picture</legend>

              <div class="row g-3 align-items-center">
                <div class="col-12 col-md-6">
                  <label class="form-label">Upload New Profile Picture (Optional)</label>
                  <input type="file" class="form-control form-control-sm" accept="image/png,image/jpeg,image/jpg"
                         (change)="onFileSelect($event)">
                  <div class="text-danger small mt-1" *ngIf="fileError">{{ fileError }}</div>
                </div>

                <div class="col-12 col-md-6 text-center" *ngIf="imagePreview">
                  <img [src]="imagePreview" alt="Preview" class="img-thumbnail" style="max-height: 110px;">
                </div>
              </div>
            </fieldset>

            <!-- Server Error -->
            <div class="col-12" *ngIf="serverError">
              <div class="alert alert-danger small p-2">{{ serverError }}</div>
            </div>

            <!-- Submit -->
            <div class="col-12 d-flex justify-content-end gap-2">
              <button type="submit" class="btn btn-primary btn-sm" [disabled]="loading || form.invalid">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
                {{ loading ? 'Updating...' : 'Update Teacher' }}
              </button>
            </div>

          </div>

          <!-- Additional Details -->
          <fieldset class="form-section">
            <legend>Additional Details (Optional)</legend>

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label">Address</label>
                <textarea class="form-control form-control-sm" formControlName="address" rows="2"></textarea>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Blood Group</label>
                <select class="form-select form-select-sm" formControlName="bloodGroup">
                  <option value="">Select</option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                </select>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Emergency Contact Name</label>
                <input type="text" class="form-control form-control-sm" formControlName="emergencyContactName">
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Emergency Contact Phone</label>
                <input type="text" class="form-control form-control-sm" formControlName="emergencyContactPhone" placeholder="10 digits">
                <div class="text-danger small mt-1" *ngIf="submitted && f['emergencyContactPhone'].errors?.['pattern']">
                  10 digits only
                </div>
              </div>

              <div class="col-12 col-md-6">
                <label class="form-label">Leave Balance (days)</label>
                <input type="number" min="0" class="form-control form-control-sm" formControlName="leaveBalance">
              </div>
            </div>
          </fieldset>
        </form>

      </app-card>
    </div>
  </div>
</div>