<!-- src/app/student/assignments/student-assignments-list.component.html -->
<!-- Production-level: Cards on mobile (stack), table on desktop. Pull-to-refresh ready, ARIA, lazy loading. -->

<div class="min-h-screen bg-gray-50 py-4 px-2 sm:px-4">
  <!-- Header -->
  <div class="max-w-5xl mx-auto mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">My Assignments</h1>
    <p class="text-gray-600 mt-1">Upcoming tasks from your classes</p>
  </div>

  <!-- Loading / Error -->
  <div *ngIf="loading" class="max-w-5xl mx-auto text-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-2"></div>
    <p>Loading assignments...</p>
  </div>

  <div *ngIf="error" class="max-w-5xl mx-auto p-4 bg-red-50 border border-red-200 rounded-md mb-6">
    <p class="text-red-800">{{ error }}</p>
    <button class="mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" (click)="retryLoad()">
      Retry
    </button>
  </div>

  <!-- No Assignments -->
  <div *ngIf="!loading && !error && assignments.length === 0" class="max-w-5xl mx-auto text-center py-12 text-gray-500">
    <div class="text-6xl mb-4">ðŸ“š</div>
    <h2 class="text-xl font-semibold mb-2">No assignments yet</h2>
    <p>Check back later for new tasks from your teachers.</p>
  </div>

  <!-- Assignments (Cards on Mobile, Table on Desktop) -->
  <div *ngIf="assignments.length > 0" class="max-w-5xl mx-auto space-y-4">
    <!-- Mobile: Cards -->
    <div class="md:hidden space-y-4">
      <div *ngFor="let a of assignments" 
           class="bg-white rounded-lg shadow-sm border p-4 hover:shadow-md transition-shadow"
           [ngClass]="getStatusClass(a)">
        <div class="flex justify-between items-start mb-2">
          <h3 class="font-semibold text-gray-900 text-lg">{{ a.title }}</h3>
          <span class="px-2 py-1 rounded-full text-xs font-medium" 
                [ngClass]="{
                  'bg-red-100 text-red-800': a.isOverdue,
                  'bg-green-100 text-green-800': a.hasSubmitted && a.grade !== null,
                  'bg-blue-100 text-blue-800': a.hasSubmitted && a.grade === null,
                  'bg-gray-100 text-gray-800': !a.hasSubmitted
                }">
            {{ getStatusText(a) }}
          </span>
        </div>
        <p class="text-sm text-gray-600 mb-3 line-clamp-2">{{ a.description }}</p>
        <div class="grid grid-cols-2 gap-2 text-xs text-gray-500 mb-3">
          <span>Subject: {{ a.subjectId.name }}</span>
          <span>Class: {{ a.classId.name }}</span>
        </div>
        <div class="text-sm mb-3">
          <span class="font-medium">Due: </span>
          <span [class.text-red-600]="a.isOverdue">{{ formatDate(a.dueDate) }}</span>
          <small *ngIf="a.isOverdue && a.daysUntilDue" class="block text-red-600 text-xs">
            Overdue {{ abs(a.daysUntilDue) }} day{{ abs(a.daysUntilDue) === 1 ? '' : 's' }}
          </small>
          <small *ngIf="!a.isOverdue && a.daysUntilDue && a.daysUntilDue > 0" class="block text-green-600 text-xs">
            {{ a.daysUntilDue }} day{{ a.daysUntilDue === 1 ? '' : 's' }} left
          </small>
        </div>
        <button 
          class="w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors text-sm"
          (click)="viewDetails(a._id)"
          [attr.aria-label]="'View details for ' + a.title">
          View Details â†’
        </button>
      </div>
    </div>

    <!-- Desktop: Table -->
    <div class="hidden md:block overflow-x-auto">
      <table class="min-w-full bg-white border rounded-lg shadow-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Title</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Subject</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Class</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Due Date</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Status</th>
            <th class="px-4 py-3 text-left text-sm font-semibold text-gray-900">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <tr *ngFor="let a of assignments" 
              class="hover:bg-gray-50 transition-colors"
              [ngClass]="getStatusClass(a)">
            <td class="px-4 py-4">
              <div class="font-medium text-gray-900">{{ a.title }}</div>
              <div class="text-sm text-gray-500 line-clamp-2" *ngIf="a.description">
                {{ a.description }}
              </div>
            </td>
            <td class="px-4 py-4 text-sm text-gray-900">{{ a.subjectId.name }}</td>
            <td class="px-4 py-4 text-sm text-gray-900">{{ a.classId.name }}</td>
            <td class="px-4 py-4">
              <div [class.text-red-600]="a.isOverdue" class="font-medium">
                {{ formatDate(a.dueDate) }}
              </div>
              <div *ngIf="a.isOverdue && a.daysUntilDue" class="text-xs text-red-600">
                Overdue {{ abs(a.daysUntilDue) }} day{{ abs(a.daysUntilDue) === 1 ? '' : 's' }}
              </div>
              <div *ngIf="!a.isOverdue && a.daysUntilDue && a.daysUntilDue > 0" class="text-xs text-green-600">
                {{ a.daysUntilDue }} day{{ a.daysUntilDue === 1 ? '' : 's' }} left
              </div>
            </td>
            <td class="px-4 py-4">
              <span class="inline-flex px-2 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-red-100 text-red-800': a.isOverdue,
                      'bg-green-100 text-green-800': a.hasSubmitted && a.grade !== null,
                      'bg-blue-100 text-blue-800': a.hasSubmitted && a.grade === null,
                      'bg-gray-100 text-gray-800': !a.hasSubmitted
                    }">
                {{ getStatusText(a) }}
              </span>
            </td>
            <td class="px-4 py-4">
              <button 
                class="text-indigo-600 hover:text-indigo-900 font-medium text-sm"
                (click)="viewDetails(a._id)"
                [attr.aria-label]="'View details for ' + a.title">
                View Details â†’
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Refresh Button (Production: For manual retry) -->
    <div *ngIf="assignments.length > 0" class="max-w-5xl mx-auto mt-6 text-center">
      <button 
        class="px-4 py-2 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50"
        (click)="loadAssignments(true)"
        [disabled]="refreshing">
        {{ refreshing ? 'Refreshing...' : 'Refresh List' }}
      </button>
    </div>
  </div>
</div>