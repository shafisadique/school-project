<div class="assignment-details-wrapper">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
    
      <div class="header-title">
        <h1 class="title">Assignment Details</h1>
        <p class="subtitle">Complete your work and submit on time</p>
      </div>
        <button class="btn-back" (click)="goBack()" aria-label="Back to assignments">
        Back to Assignments
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner-large"></div>
    <p>Loading assignment details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-card">
    <div class="error-icon">Warning</div>
    <h3>Failed to Load Assignment</h3>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="goBack()">Go Back</button>
  </div>

  <!-- Assignment Content -->
  <div *ngIf="!loading && !error && assignment" class="assignment-card">
    <!-- Title & Description -->
    <div class="card-section title-section">
      <h1 class="assignment-title">{{ assignment.title }}</h1>
      <p class="assignment-description">{{ assignment.description }}</p>
    </div>

    <!-- Metadata Grid -->
    <div class="metadata-grid">
      <div class="meta-item">
        <span class="label">Subject</span>
        <span class="value">{{ assignment.subjectId?.name || '—' }}</span>
      </div>
      <div class="meta-item">
        <span class="label">Class</span>
        <span class="value">{{ assignment.classId?.name || '—' }}</span>
      </div>
      <div class="meta-item">
        <span class="label">Due Date</span>
        <div class="value">
          <div class="due-date" [class.overdue]="assignment.isOverdue">
            {{ formatDate(assignment.dueDate) }}
          </div>
          <div class="due-status" [class.overdue]="assignment.isOverdue">
            {{ getDueStatus() }}
          </div>
        </div>
      </div>
      <div class="meta-item">
        <span class="label">Teacher</span>
        <span class="value">{{ assignment.teacherId?.name || '—' }}</span>
      </div>
    </div>

    <!-- Submission Status -->
    <div class="submission-status-card">
      <h2 class="section-title">Your Submission</h2>
      <div class="status-content">
        <div class="status-badge" [ngClass]="getSubmissionBadgeClass()">
          {{ getSubmissionStatus() }}
        </div>
        <div *ngIf="assignment.hasSubmitted && assignment.grade !== null" class="grade-info">
          <span class="grade">{{ assignment.grade }}/100</span>
          <div *ngIf="assignment.comments" class="comment-bubble">
            "{{ assignment.comments }}"
          </div>
        </div>
        <p *ngIf="!assignment.hasSubmitted" class="submission-note">
          Complete on paper and submit in school. Your teacher will record it.
        </p>
      </div>
    </div>

    <!-- Attachments -->
    <div class="attachments-section" *ngIf="fileUrls.length > 0">
      <h2 class="section-title">Attached Files ({{ fileUrls.length }})</h2>
      <div class="files-grid">
        <div *ngFor="let file of fileUrls; let i = index" class="file-card">
          <div class="file-header">
            <h3 class="file-name">{{ file.name }}</h3>
            <p class="file-index">File {{ i + 1 }} of {{ fileUrls.length }}</p>
          </div>

          <!-- PDF Viewer -->
          <div *ngIf="file.isPdf" class="file-preview">
            <iframe [src]="safeUrl(file.url)" title="PDF Preview" class="pdf-viewer"></iframe>
          </div>

          <!-- Image Preview -->
          <div *ngIf="!file.isPdf && isImage(file.url)" class="file-preview">
            <img [src]="file.url" [alt]="file.name" class="image-preview" (error)="onImageError($event)" loading="lazy" />
          </div>

          <!-- Download Button -->
          <button class="btn-download" (click)="downloadFile(file.url, file.name)">
            Download File
          </button>
        </div>
      </div>

      <p class="files-note">
        Use these materials to complete your assignment.
      </p>
    </div>

    <!-- No Attachments -->
    <div *ngIf="fileUrls.length === 0" class="no-attachments">
      <p>No files attached to this assignment.</p>
    </div>

    <!-- Footer -->
    <div class="card-footer">
      <button class="btn-back-footer" (click)="goBack()">
        Back to Assignments
      </button>
    </div>
  </div>
</div>