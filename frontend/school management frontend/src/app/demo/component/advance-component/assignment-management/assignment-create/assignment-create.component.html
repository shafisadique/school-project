<div class="assignment-create-container">
  <!-- Premium Header -->
  <div class="header-section">
    <div class="header-card">
      <h1 class="title">Create Assignment</h1>
      <p class="subtitle">Assign homework, worksheets, or projects to your students</p>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary spinner-large" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Main Form Card -->
  <div class="controls-card" *ngIf="!isLoading">
    <form [formGroup]="assignmentForm" (ngSubmit)="handleUpload()" novalidate>
      <!-- Assignment Details -->
      <fieldset class="form-section">
        <legend>Assignment Details</legend>
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Title <span class="text-danger">*</span></label>
            <input type="text" class="form-control form-control-lg" formControlName="title" 
                   placeholder="e.g. Math Worksheet Chapter 5">
            <div class="text-danger small mt-1" *ngIf="assignmentForm.get('title')?.invalid && assignmentForm.get('title')?.touched">
              Title is required (max 100 characters)
            </div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Due Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control form-control-lg" formControlName="dueDate" [min]="today">
            <div class="text-danger small mt-1" *ngIf="assignmentForm.get('dueDate')?.invalid && assignmentForm.get('dueDate')?.touched">
              Please select a valid future date
            </div>
          </div>

          <div class="col-12">
            <label class="form-label">Description <span class="text-danger">*</span></label>
            <textarea class="form-control" rows="4" formControlName="description"
                      placeholder="Explain what students need to do..."></textarea>
            <div class="text-danger small mt-1" *ngIf="assignmentForm.get('description')?.invalid && assignmentForm.get('description')?.touched">
              Description is required (max 500 characters)
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Class & Subject -->
      <fieldset class="form-section">
        <legend>Class & Subject</legend>
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Class <span class="text-danger">*</span></label>
            <select class="form-select form-select-lg" formControlName="classId" (change)="onClassChange()">
              <option value="">Select Class</option>
              <option *ngFor="let cls of classes" [value]="cls._id">{{ cls.name }}</option>
            </select>
            <div class="text-danger small mt-1" *ngIf="assignmentForm.get('classId')?.invalid && assignmentForm.get('classId')?.touched">
              Class is required
            </div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Subject <span class="text-danger">*</span></label>
            <select class="form-select form-select-lg" formControlName="subjectId">
              <option value="">Select Subject</option>
              <option *ngFor="let sub of selectedSubjects" [value]="sub._id">{{ sub.name }}</option>
            </select>
            <div class="text-danger small mt-1" *ngIf="assignmentForm.get('subjectId')?.invalid && assignmentForm.get('subjectId')?.touched">
              Subject is required
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Assign To -->
      <fieldset class="form-section">
        <legend>Assign To</legend>
        <div class="row g-3">
          <div class="col-12">
            <label class="form-label">Students (Optional)</label>
            <select class="form-select form-select-lg" formControlName="assignedTo" multiple size="6">
              <option *ngFor="let student of students" [value]="student._id">
                {{ student.name }} - {{ student.admissionNo }}
              </option>
            </select>
            <small class="text-muted">Leave empty to assign to all students in class</small>
          </div>
        </div>
      </fieldset>

      <!-- Attachments -->
      <fieldset class="form-section">
        <legend>Attachments (Optional)</legend>
        <div class="row g-3">
          <div class="col-12">
            <input type="file" #fileInput class="form-control form-control-lg" 
                   (change)="onFileChange($event)" multiple 
                   accept=".pdf,.doc,.docx,.png,.jpg,.jpeg">
            <div *ngIf="fileList.length > 0" class="mt-3">
              <div class="alert alert-info">
                <strong>Selected Files:</strong>
                <ul class="mb-0 mt-2">
                  <li *ngFor="let file of fileList; let i = index">
                    {{ file.name }} 
                    <button type="button" class="btn btn-sm btn-danger ms-2" (click)="removeFile(i)">Remove</button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </fieldset>

      <!-- Submit -->
      <div class="d-flex justify-content-end mt-4">
        <button type="submit" class="btn-material btn-primary btn-lg"
                [disabled]="assignmentForm.invalid || isLoading">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isLoading ? 'Creating Assignment...' : 'Create Assignment' }}
        </button>
      </div>
    </form>
  </div>
</div>