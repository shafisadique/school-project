<div class="container py-4">
  <div class="row">
    <div class="col-sm-12">
      <app-card>
        <div class="payment-container">
          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <!-- Error State -->
          <div *ngIf="errorMessage" class="alert alert-danger text-center">
            {{ errorMessage }}
          </div>

          <!-- Main Form -->
          <div *ngIf="!isLoading && !errorMessage">
            <form (ngSubmit)="processPayment()">
              <!-- Invoice Details -->
              <fieldset class="form-section">
                <legend>Invoice Details</legend>
                <div class="row g-4">
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Student Name:</label>
                      <input type="text" class="form-control form-control-sm shadow-sm" [value]="invoice?.studentId?.name || 'N/A'" readonly />
                    </div>
                  </div>
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Invoice Month:</label>
                      <input type="text" class="form-control form-control-sm shadow-sm" [value]="invoice?.month || 'N/A'" readonly />
                    </div>
                  </div>
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Total Amount:</label>
                      <input type="text" class="form-control form-control-sm shadow-sm" [value]="invoice?.totalAmount | currency:'INR'" readonly />
                    </div>
                  </div>
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Remaining Due:</label>
                      <input type="text" class="form-control form-control-sm shadow-sm" [value]="invoice?.remainingDue | currency:'INR'" readonly />
                    </div>
                  </div>
                </div>
              </fieldset>

              <!-- Payment Details -->
              <fieldset class="form-section">
                <legend>Payment Details (Paying for {{ invoice?.month || 'Selected Month' }})</legend>
                <div class="row g-4">
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Amount to Pay:</label>
                      <input type="number" class="form-control form-control-sm shadow-sm" [(ngModel)]="paymentData.amount" [ngModelOptions]="{standalone: true}" max="{{invoice?.remainingDue}}" min="1" required />
                      <small *ngIf="amountError" class="error">{{ amountError }}</small>
                    </div>
                  </div>
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Payment Method:</label>
                      <select class="form-control form-control-sm shadow-sm" [(ngModel)]="paymentData.method" (change)="onPaymentMethodChange()" [ngModelOptions]="{standalone: true}" required>
                        <option value="Cash">Cash</option>
                        <option value="Cheque">Cheque</option>
                        <option value="Online">Online (Razorpay)</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-md-6 col-12" *ngIf="paymentData.method === 'Cheque'">
                    <div class="form-group">
                      <label>Cheque Number:</label>
                      <input type="text" class="form-control form-control-sm shadow-sm" [(ngModel)]="paymentData.chequeNumber" [ngModelOptions]="{standalone: true}" required />
                      <small *ngIf="chequeError" class="error">{{ chequeError }}</small>
                    </div>
                  </div>
                  <div class="col-md-6 col-12">
                    <div class="form-group">
                      <label>Payment Date:</label>
                      <input type="date" class="form-control form-control-sm shadow-sm" [(ngModel)]="paymentData.date" [ngModelOptions]="{standalone: true}" required />
                    </div>
                  </div>
                </div>
              </fieldset>

              <!-- Submit Button -->
              <div class="text-center">
                <button type="submit" class="btn btn-primary payment-btn" [disabled]="isProcessing || !invoice">
                  <span *ngIf="!isProcessing && paymentData.method !== 'Online'">Process Payment</span>
                  <span *ngIf="!isProcessing && paymentData.method === 'Online'">Pay Online</span>
                  <span *ngIf="isProcessing" class="spinner-border spinner-border-sm me-2" role="status"></span>
                  <span *ngIf="isProcessing">Processing...</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </app-card>
    </div>
  </div>
</div>