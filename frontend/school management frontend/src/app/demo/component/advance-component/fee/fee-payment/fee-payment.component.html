<!-- fee-payment.component.html -->
<div class="container">
    <div class="card shadow-lg">
      <!-- Invoice Header -->
      
  
      <!-- Main Content -->
      <div class="card-body p-4">
        <!-- Student Search -->
        <div class="mb-4">
          <input type="text" 
                 class="form-control form-control-lg"
                 placeholder="Search student by name or admission number"
                 (input)="onSearchInput($event)">
          


          <div class="list-group mt-2" *ngIf="students.length > 0">
            <button type="button" 
                    class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                    *ngFor="let student of students"
                    (click)="selectStudent(student)">
              <div>
                <strong>{{ student.name }}</strong>
                <div class="text-muted small">
                  {{ student.admissionNo }} | Class {{ student.className }}
                </div>
              </div>
              <span class="badge bg-primary rounded-pill">
                Due: {{ student.totalDue | currency }}
              </span>
            </button>
          </div>
        </div>
  
        <!-- Selected Student Details -->
        <ng-container *ngIf="selectedStudent">
          <header class="card-header bg-primary text-white p-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h2 class="mb-1">{{ school?.name || 'School Name' }}</h2>
                <small class="d-block">{{ school?.address || 'School Address' }}</small>
                <small class="d-block">Invoice Date: {{ today | date:'mediumDate' }}</small>
              </div>
              <div class="text-end">
                <h3 class="mb-0">Fee Invoice</h3>
                <small class="d-block">Generated at {{ today | date:'shortTime' }}</small>
              </div>
            </div>
          </header>
          <!-- Student Information -->
          <div class="row mb-4 g-3">
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="mb-0">Student Details</h5>
                </div>
                <div class="card-body">
                  <dl class="row mb-0">
                    <dt class="col-sm-4">Name</dt>
                    <dd class="col-sm-8">{{ selectedStudent.name }}</dd>
  
                    <dt class="col-sm-4">Class</dt>
                    <dd class="col-sm-8">{{ selectedStudent.className }}</dd>
  
                    <dt class="col-sm-4">Admission No</dt>
                    <dd class="col-sm-8">{{ selectedStudent.admissionNo }}</dd>
                  </dl>
                </div>
              </div>
            </div>
  
            <!-- Payment Summary -->
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-header bg-light">
                  <h5 class="mb-0">Payment Summary</h5>
                </div>
                <div class="card-body">
                  <dl class="row mb-0">
                    <dt class="col-sm-6">Total Outstanding</dt>
                    <dd class="col-sm-6 text-end">{{ totalDue | currency }}</dd>
  
                    <dt class="col-sm-6">Payment Status</dt>
                    <dd class="col-sm-6 text-end">
                      <span class="badge" [ngClass]="paymentStatusClass">
                        {{ paymentStatus }}
                      </span>
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Fee Breakdown -->
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">Fee Breakdown</h5>
            </div>
            <div class="card-body p-0">
             <!-- Add this inside your component template -->
<div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Month</th>
          <th>Base Amount</th>
          <th>Tuition Fee</th>
          <th>Exam Fee</th>
          <th>Transport</th>
          <th>Hostel</th>
          <th>Misc</th>
          <th>Total</th>
          <th>Due</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let invoice of invoices" 
        (click)="selectInvoice(invoice)"
        [class.table-info]="invoice === selectedInvoice">
          <td>{{ invoice.month }}</td>
          <td>{{ invoice.baseAmount | currency }}</td>
          <td>{{ invoice.invoiceDetails?.tuitionFee | currency }}</td>
          <td>{{ invoice.invoiceDetails?.examFee | currency }}</td>
          <td>{{ invoice.invoiceDetails?.transportFee | currency }}</td>
          <td>{{ invoice.invoiceDetails?.hostelFee | currency }}</td>
          <td>{{ invoice.invoiceDetails?.miscFee | currency }}</td>
          <td class="fw-bold">{{ invoice.baseAmount + invoice.invoiceDetails.tuitionFee + 
            invoice.invoiceDetails.examFee + invoice.invoiceDetails.transportFee + 
            invoice.invoiceDetails.hostelFee + invoice.invoiceDetails.miscFee | currency }}
     </td>
          <td class="text-danger">{{ invoice.remainingDue | currency }}</td>
          <td>
            <span class="badge" [ngClass]="{
              'bg-success': invoice.status === 'Paid',
              'bg-warning': invoice.status === 'Partially Paid',
              'bg-danger': invoice.status === 'Pending'
            }">
              {{ invoice.status }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
            </div>
          </div>
  
          <!-- Payment Section -->
          <div class="card" *ngIf="selectedInvoice">
            <div class="card-header bg-light">
              <h5 class="mb-0">Payment for {{ selectedInvoice.month }}</h5>
            </div>
            <div class="card-body">
              <form [formGroup]="paymentForm" (ngSubmit)="onSubmitPayment()" class="row g-3 align-items-end">
                <div class="col-md-5">
                  <label class="form-label">Amount</label>
                  <input type="number" 
                         class="form-control"
                         formControlName="amount"
                         [max]="totalDue"
                         step="0.01">
                </div>
                
                <div class="col-md-4">
                  <label class="form-label">Payment Method</label>
                  <select class="form-select" formControlName="method">
                    <option *ngFor="let method of paymentMethods" [value]="method">{{ method }}</option>
                  </select>
                </div>
  
                <div class="col-md-3">
                  <button class="btn btn-success w-100" 
                          type="submit"
                          [disabled]="paymentForm.invalid || processingPayment">
                    <span *ngIf="!processingPayment">Process Payment</span>
                    <span *ngIf="processingPayment">
                      <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                      Processing...
                    </span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>