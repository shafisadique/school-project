<div class="container-fluid">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    
  </div>

  <!-- Fee Structures Table -->
  <div class="card shadow-sm" >
    <div class="card-body">
      <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="bi bi-plus-circle me-2"></i>Create New Fee Structure
    </button>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Class</th>
              <th>Frequency</th>
              <th>Base Fee</th>
              <th>Tuition Fee</th>
              <th>Exam Fee</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let structure of feeStructures">
              <td>{{ structure.className }}</td>
              <td>{{ structure.frequency }}</td>
              <td>₹{{ structure.baseFee | number }}</td>
              <td>₹{{ structure.feeBreakdown?.tuitionFee || 0 | number }}</td>
              <td>₹{{ structure.feeBreakdown?.examFee || 0 | number }}</td>
            </tr>
            <tr *ngIf="feeStructures.length === 0">
              <td colspan="5" class="text-center text-muted">No fee structures available.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal for Creating Fee Structure -->
  <ng-template #feeStructureModal let-modal>
    <div class="modal-header bg-primary text-white">
      <h5 class="modal-title">Create Fee Structure</h5>
      <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="feeForm">
        <!-- Step Indicator -->
        <div class="step-indicator mb-4">
          <div class="step" [class.active]="currentStep === 1">1. Select Class</div>
          <div class="step" [class.active]="currentStep === 2">2. Choose Frequency</div>
          <div class="step" [class.active]="currentStep === 3">3. Fee Details</div>
          <div class="step" [class.active]="currentStep === 4">4. Review & Save</div>
        </div>

        <!-- Step 1: Select Class -->
        <div *ngIf="currentStep === 1">
          <h6 class="mb-3">Step 1: Select a Class</h6>
          <div class="mb-3">
            <label class="form-label fw-bold">Class</label>
            <select class="form-select" formControlName="className">
              <option value="" disabled>Select a class</option>
              <option *ngFor="let cls of classList" [value]="cls">{{ cls }}</option>
            </select>
            <div *ngIf="feeForm.get('className')?.touched && feeForm.get('className')?.invalid" class="text-danger mt-1">
              Please select a class.
            </div>
          </div>
          <div class="d-flex justify-content-end">
            <button class="btn btn-primary" (click)="nextStep()">Next</button>
          </div>
        </div>

        <!-- Step 2: Choose Frequency -->
        <div *ngIf="currentStep === 2">
          <h6 class="mb-3">Step 2: Choose Payment Frequency</h6>
          <div class="mb-3">
            <label class="form-label fw-bold">Frequency</label>
            <select class="form-select" formControlName="frequency">
              <option *ngFor="let freq of frequencies" [value]="freq">{{ freq }}</option>
            </select>
            <div *ngIf="feeForm.get('frequency')?.touched && feeForm.get('frequency')?.invalid" class="text-danger mt-1">
              Please select a frequency.
            </div>
          </div>
          <div class="d-flex justify-content-between">
            <button class="btn btn-outline-secondary" (click)="prevStep()">Back</button>
            <button class="btn btn-primary" (click)="nextStep()">Next</button>
          </div>
        </div>

        <!-- Step 3: Fee Details -->
        <div *ngIf="currentStep === 3">
          <h6 class="mb-3">Step 3: Enter Fee Details</h6>
          <div class="mb-3">
            <label class="form-label fw-bold">Base Fee (Total)</label>
            <div class="input-group">
              <span class="input-group-text">₹</span>
              <input type="number" step="1" class="form-control" formControlName="baseFee" min="0">
            </div>
            <div *ngIf="feeForm.get('baseFee')?.touched && feeForm.get('baseFee')?.invalid" class="text-danger mt-1">
              Base fee is required and must be a non-negative number.
            </div>
          </div>
          <fieldset formGroupName="feeBreakdown" class="p-3 border rounded">
            <legend class="fw-bold text-primary">Fee Breakdown</legend>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Tuition Fee</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="number" step="1" class="form-control" formControlName="tuitionFee" min="0">
                </div>
                <div *ngIf="feeForm.get('feeBreakdown.tuitionFee')?.touched && feeForm.get('feeBreakdown.tuitionFee')?.invalid" class="text-danger mt-1">
                  Tuition fee is required and must be a non-negative number.
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Exam Fee</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="number" step="1" class="form-control" formControlName="examFee" min="0">
                </div>
                <div *ngIf="feeForm.get('feeBreakdown.examFee')?.touched && feeForm.get('feeBreakdown.examFee')?.invalid" class="text-danger mt-1">
                  Exam fee is required and must be a non-negative number.
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Transport Fee (Optional)</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="number" step="1" class="form-control" formControlName="transportFee" min="0">
                </div>
                <div *ngIf="feeForm.get('feeBreakdown.transportFee')?.touched && feeForm.get('feeBreakdown.transportFee')?.invalid" class="text-danger mt-1">
                  Transport fee must be a non-negative number.
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Hostel Fee (Optional)</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input type="number" step="1" class="form-control" formControlName="hostelFee" min="0">
                </div>
                <div *ngIf="feeForm.get('feeBreakdown.hostelFee')?.touched && feeForm.get('feeBreakdown.hostelFee')?.invalid" class="text-danger mt-1">
                  Hostel fee must be a non-negative number.
                </div>
              </div>
            </div>
          </fieldset>
          <div class="d-flex justify-content-between mt-3">
            <button class="btn btn-outline-secondary" (click)="prevStep()">Back</button>
            <button class="btn btn-primary" (click)="nextStep()">Next</button>
          </div>
        </div>

        <!-- Step 4: Review & Save -->
        <div *ngIf="currentStep === 4">
          <h6 class="mb-3">Step 4: Review & Save</h6>
          <div class="card p-3 mb-3">
            <h6>Fee Structure Details</h6>
            <p><strong>Class:</strong> {{ feeForm.get('className')?.value }}</p>
            <p><strong>Frequency:</strong> {{ feeForm.get('frequency')?.value }}</p>
            <p><strong>Base Fee:</strong> ₹{{ feeForm.get('baseFee')?.value | number }}</p>
            <p><strong>Tuition Fee:</strong> ₹{{ feeForm.get('feeBreakdown.tuitionFee')?.value | number }}</p>
            <p><strong>Exam Fee:</strong> ₹{{ feeForm.get('feeBreakdown.examFee')?.value | number }}</p>
            <p><strong>Transport Fee:</strong> ₹{{ feeForm.get('feeBreakdown.transportFee')?.value | number }}</p>
            <p><strong>Hostel Fee:</strong> ₹{{ feeForm.get('feeBreakdown.hostelFee')?.value | number }}</p>
          </div>
          <div class="d-flex justify-content-between">
            <button class="btn btn-outline-secondary" (click)="prevStep()">Back</button>
            <button class="btn btn-success" (click)="submitFeeStructure()">Save Fee Structure</button>
          </div>
        </div>
      </form>
    </div>
  </ng-template>
</div>