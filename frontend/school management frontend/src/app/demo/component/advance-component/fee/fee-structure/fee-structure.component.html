<div class="container-fluid">
  <div class="card shadow">
    <div class="card-header text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0" style="font-family: 'Poppins',sans-serif; color: white; font-size: 24px;">Fee Structures Management</h5>
      <button class="btn btn-light shadow" (click)="openCreateModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 8v8"></path>
          <path d="M8 12h8"></path>
        </svg>
        New Structure
      </button>
    </div>
    <div class="card-body">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>Class</th>
            <th>Base Fee</th>
            <th>Tuition Fee</th>
            <th>Transport Fee</th>
            <th>Hostel Fee</th>
            <th>Exam Fee</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let structure of feeStructures">
            <td>{{ structure.className }}</td>
            <td>₹{{ structure.baseFee | number }}</td>
            <td>₹{{ structure.feeBreakdown?.tuitionFee || 0 | number }}</td>
            <td>₹{{ structure.feeBreakdown?.transportFee || 0 | number }}</td>
            <td>₹{{ structure.feeBreakdown?.hostelFee || 0 | number }}</td>
            <td>₹{{ structure.feeBreakdown?.examFee || 0 | number }}</td>
            <td>
              <button class="btn btn-warning btn-sm shadow" style="border-radius: 5px; margin: 5px;" (click)="openEditModal(structure)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2">
                  <path d="M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"></path>
                  <path d="M16 7h4"></path>
                  <path d="M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3"></path>
                </svg>
              </button>
              <button class="btn btn-danger btn-sm" style="border-radius: 5px; margin: 5px;" (click)="deleteStructure(structure._id)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2">
                  <path d="M3 6h18"></path>
                  <path d="M8 6v-2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <path d="M10 11v6"></path>
                  <path d="M14 11v6"></path>
                  <path d="M5 6l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-14"></path>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <ng-template #feeStructureModal let-modal>
    <div class="modal-header bg-primary text-white">
      <h5 class="modal-title">{{ isEditMode ? 'Edit' : 'Create' }} Fee Structure</h5>
      <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="feeForm" (ngSubmit)="submitFeeStructure()" class="fee-form">
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <label class="form-label fw-bold">Select Class</label>
            <select class="form-select" formControlName="className">
              <option *ngFor="let cls of classList" [value]="cls">{{ cls }}</option>
            </select>
            <div *ngIf="feeForm.get('className')?.invalid && feeForm.get('className')?.touched"
                 class="text-danger small mt-1">
              Class name is required
            </div>
          </div>
        </div>
        <div class="mb-4">
          <label class="form-label fw-bold">Base Fee</label>
          <div class="input-group">
            <span class="input-group-text">₹</span>
            <input type="number" class="form-control" formControlName="baseFee" min="0">
            <div *ngIf="feeForm.get('baseFee')?.invalid && feeForm.get('baseFee')?.touched"
                 class="text-danger small mt-1">
              Minimum ₹0 required
            </div>
          </div>
        </div>
        <fieldset formGroupName="feeBreakdown" class="form-section p-4 mb-4">
          <legend class="fw-bold text-primary">Fee Breakdown</legend>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Tuition Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="tuitionFee" min="0">
              </div>
              <div *ngIf="feeForm.get('feeBreakdown.tuitionFee')?.invalid"
                   class="text-danger small mt-1">
                Required field
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Exam Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="examFee" min="0">
              </div>
              <div *ngIf="feeForm.get('feeBreakdown.examFee')?.invalid"
                   class="text-danger small mt-1">
                Required field
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Lab Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="labFee" min="0">
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Transport Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="transportFee" min="0">
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Hostel Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="hostelFee" min="0">
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Miscellaneous Fee</label>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" formControlName="miscFee" min="0">
              </div>
            </div>
          </div>
        </fieldset>
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="feeForm.invalid">
            <i class="bi bi-check-circle me-2"></i>
            {{ isEditMode ? 'Update' : 'Create' }} Structure
          </button>
        </div>
      </form>
    </div>
  </ng-template>
</div>